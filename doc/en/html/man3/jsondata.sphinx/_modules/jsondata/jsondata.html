<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>jsondata.jsondata &mdash; jsondata 0.2.22 documentation</title>
    
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.2.22',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="jsondata 0.2.22 documentation" href="../../index.html" />
    <link rel="up" title="jsondata" href="../jsondata.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">jsondata 0.2.22 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="../jsondata.html" accesskey="U">jsondata</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for jsondata.jsondata</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding:utf-8   -*-</span>
<span class="sd">&quot;&quot;&quot;Core features for the processing of JSON based structures of in-memory data.</span>
<span class="sd">Supports RFC4627 and RCF7159, addresses of in-memory-nodes and RFC6901, </span>
<span class="sd">relative pointer-draft.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">absolute_import</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">print_function</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">division</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="kn">import</span> <span class="nn">copy</span>

<span class="c1">#</span>
<span class="c1"># pylint: disable-msg=F0401</span>
<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ujson&#39;</span><span class="p">):</span>
    <span class="kn">import</span> <span class="nn">ujson</span> <span class="k">as</span> <span class="nn">myjson</span>  <span class="c1"># @UnusedImport @Reimport @UnresolvedImport</span>
<span class="k">else</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">json</span> <span class="k">as</span> <span class="nn">myjson</span>  <span class="c1"># @Reimport</span>
<span class="c1"># pylint: enable-msg=F0401</span>

<span class="c1"># for now the only one supported</span>
<span class="kn">import</span> <span class="nn">jsonschema</span>
<span class="kn">from</span> <span class="nn">jsonschema</span> <span class="k">import</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">JSONDataValidationError</span>
<span class="kn">from</span> <span class="nn">jsonschema</span> <span class="k">import</span> <span class="n">SchemaError</span> <span class="k">as</span> <span class="n">JSONDataSchemaError</span>

<span class="kn">from</span> <span class="nn">jsondata</span> <span class="k">import</span> <span class="n">V3K</span><span class="p">,</span> <span class="n">ISSTR</span>

<span class="kn">from</span> <span class="nn">jsondata</span> <span class="k">import</span> <span class="n">JSONDataParameterError</span><span class="p">,</span> <span class="n">JSONDataError</span><span class="p">,</span> \
    <span class="n">JSONDataValueError</span><span class="p">,</span> <span class="n">JSONDataIndexError</span><span class="p">,</span> <span class="n">JSONDataKeyError</span><span class="p">,</span> \
    <span class="n">JSONDataSourceFileError</span><span class="p">,</span> <span class="n">JSONDataTargetFileError</span><span class="p">,</span> \
    <span class="n">JSONDataNodeTypeError</span><span class="p">,</span> <span class="n">JSONPointerError</span><span class="p">,</span> <span class="n">JSONPointerTypeError</span><span class="p">,</span> \
    <span class="n">JSONDataPathError</span><span class="p">,</span> \
    <span class="n">MJ_RFC4627</span><span class="p">,</span> <span class="n">MJ_RFC7159</span><span class="p">,</span> <span class="n">MJ_RFC6901</span><span class="p">,</span> \
    <span class="n">MJ_RFC6902</span><span class="p">,</span> <span class="n">MS_OFF</span><span class="p">,</span> <span class="n">MS_DRAFT3</span><span class="p">,</span> <span class="n">MS_DRAFT4</span><span class="p">,</span> \
    <span class="n">C_REF</span><span class="p">,</span> <span class="n">C_DEEP</span><span class="p">,</span> <span class="n">C_SHALLOW</span><span class="p">,</span> \
    <span class="n">C_DEFAULT</span><span class="p">,</span> \
    <span class="n">PJ_TREE</span><span class="p">,</span> <span class="n">PJ_FLAT</span><span class="p">,</span> <span class="n">PJ_PYTREE</span><span class="p">,</span> <span class="n">PJ_PYFLAT</span><span class="p">,</span> <span class="n">PJ_REPR</span><span class="p">,</span> <span class="n">PJ_STR</span><span class="p">,</span> \
    <span class="n">JSYN_NATIVE</span><span class="p">,</span> <span class="n">JSYN_PYTHON</span><span class="p">,</span> \
    <span class="n">validator2ms</span><span class="p">,</span> <span class="n">copy2c</span><span class="p">,</span> <span class="n">mode2mj</span><span class="p">,</span> \
    <span class="n">B_AND</span><span class="p">,</span> <span class="n">B_OR</span><span class="p">,</span> <span class="n">B_XOR</span> <span class="c1"># B_MOD #B_SUB, B_MULT, B_DIV</span>

<span class="n">__author__</span> <span class="o">=</span> <span class="s1">&#39;Arno-Can Uestuensoez&#39;</span>
<span class="n">__maintainer__</span> <span class="o">=</span> <span class="s1">&#39;Arno-Can Uestuensoez&#39;</span>
<span class="n">__license__</span> <span class="o">=</span> <span class="s2">&quot;Artistic-License-2.0 + Forced-Fairplay-Constraints&quot;</span>
<span class="n">__copyright__</span> <span class="o">=</span> <span class="s2">&quot;Copyright (C) 2015-2016 Arno-Can Uestuensoez&quot;</span> \
                <span class="s2">&quot;@Ingenieurbuero Arno-Can Uestuensoez&quot;</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="s1">&#39;0.2.21&#39;</span>
<span class="n">__uuid__</span> <span class="o">=</span> <span class="s1">&#39;63b597d6-4ada-4880-9f99-f5e0961351fb&#39;</span>

<span class="k">if</span> <span class="n">V3K</span><span class="p">:</span>
    <span class="n">unicode</span> <span class="o">=</span> <span class="nb">str</span>


<span class="k">class</span> <span class="nc">JSONpl</span><span class="p">(</span><span class="nb">list</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A wrapper for a &#39;list&#39; representing a path pointer</span>
<span class="sd">    at the method interfaces. Required due to possible</span>
<span class="sd">    ambiguity with the other type of in-memory node.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>


<div class="viewcode-block" id="JSONData"><a class="viewcode-back" href="../../jsondata_jsondata_doc.html#jsondata.jsondata.JSONData">[docs]</a><span class="k">class</span> <span class="nc">JSONData</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Representation of a JSON based object data tree.</span>

<span class="sd">    The common node address parameters are defined as: ::</span>

<span class="sd">       sourcenode := &lt;commonnode&gt;|&lt;indata&gt; # depends on the interface</span>

<span class="sd">       targetnode := &lt;innode&gt;              # target within the represented</span>
<span class="sd">                                           # JSON structure</span>

<span class="sd">       commonnode := (anydata | indata)</span>

<span class="sd">       anydata  := (                       # any data hook - within</span>
<span class="sd">                                           # self.data or external</span>
<span class="sd">           JSONData                        # - adds to the contained data</span>
<span class="sd">                                           #   of the reference</span>
<span class="sd">         | &lt;json-array-list&gt;               # - adds to JSON array</span>
<span class="sd">         | &lt;json-object-dict&gt;              # - adds to JSON object</span>
<span class="sd">       )</span>

<span class="sd">       indata := (                         # within self.data</span>
<span class="sd">           JSONPointer                     # - adds to the node within</span>
<span class="sd">                                           #   self.data [RFC6901]_</span>
<span class="sd">         | &lt;rfc6901-string&gt;                # - pointer string within self.data [RFC6901]_</span>
<span class="sd">         | &lt;relative-pointer-string&gt;)      # - relative pointer within self.data [RELPOINTER]_</span>
<span class="sd">       )</span>

<span class="sd">    **REMARK**:</span>
<span class="sd">        The RFC7159 permits any JSON type as a node, while the RFC4627</span>
<span class="sd">        permits array and object as node reference only.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="JSONData.__init__"><a class="viewcode-back" href="../../jsondata_jsondata_doc.html#jsondata.jsondata.JSONData.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jdata</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates and validates a new object from the provided JSON data.</span>
<span class="sd">        Arbitrary additional JSON data could be added as branches.</span>

<span class="sd">        Args:</span>
<span class="sd">            **jdata**:</span>
<span class="sd">                The initial data of current instance. The accepted formats</span>
<span class="sd">                are in-memory representation of JSON data compatible with</span>
<span class="sd">                the standard library *json* [json]_. The permitted input</span>
<span class="sd">                types vary in accordance to the selected operations mode</span>
<span class="sd">                of either *RFC4627* or *RFC7159*. ::</span>

<span class="sd">                   type(jdata) := (</span>
<span class="sd">                        list,       # json-array</span>
<span class="sd">                      | dict,       # json-object</span>
<span class="sd">                      | JSONData    # copy constructor</span>
<span class="sd">                      | int         # RFC7159 only</span>
<span class="sd">                      | float       # RFC7159 only</span>
<span class="sd">                      | unicode     # RFC7159 only</span>
<span class="sd">                   )</span>

<span class="sd">                .. note::</span>

<span class="sd">                   Further branches could be added to json-objects,</span>
<span class="sd">                   and json-arrays only, while values in RFC7159 and RFC8259</span>
<span class="sd">                   mode permit replacement only. Objects support string indexes,</span>
<span class="sd">                   arrays integer indexes.</span>

<span class="sd">            kargs:</span>
<span class="sd">                For the complete set of call parameters refer to</span>
<span class="sd">                the method **JSONData.setkargs()**.</span>

<span class="sd">                **mode**:</span>
<span class="sd">                    The mode of JSON processing: ::</span>

<span class="sd">                       mode := (</span>
<span class="sd">                            MJ_RFC4627</span>
<span class="sd">                          | MJ_RFC7493  # currently not supported, mapped to RFC7159</span>
<span class="sd">                          | MJ_RFC7159</span>
<span class="sd">                          | MJ_RFC8259</span>
<span class="sd">                          | MJ_ECMA404  # same as RFC8259</span>
<span class="sd">                       )</span>

<span class="sd">                    default := MJ_RFC7159</span>

<span class="sd">                **schema**:</span>
<span class="sd">                    A valid in-memory JSONschema.</span>

<span class="sd">                    default:= None</span>

<span class="sd">                **validator**:</span>
<span class="sd">                    Sets schema validator for the data file.</span>
<span class="sd">                    Curren release relies on *jsonschema*, which</span>
<span class="sd">                    supports at the time of writing draft-03 and</span>
<span class="sd">                    draft-04.</span>

<span class="sd">                    The values are: ::</span>

<span class="sd">                        validator := (</span>
<span class="sd">                              MS_DRAFT3           | &#39;draft3&#39;</span>
<span class="sd">                            | MS_DRAFT4           | &#39;draft4&#39;</span>
<span class="sd">                            | MS_ON               | &#39;on&#39;</span>
<span class="sd">                            | MS_OFF              | &#39;off&#39;</span>
<span class="sd">                            | MODE_SCHEMA_DEFAULT | &#39;default&#39;</span>
<span class="sd">                        )</span>

<span class="sd">                    default:= MS_OFF</span>

<span class="sd">        Returns:</span>

<span class="sd">            Results in an initialized object.</span>

<span class="sd">        Raises:</span>

<span class="sd">            NameError</span>

<span class="sd">            JSONDataValueError</span>

<span class="sd">            jsonschema.ValidationError</span>

<span class="sd">            jsonschema.SchemaError</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># static final defaults</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">schemafile</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># JSON-Syntax modes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode_json</span> <span class="o">=</span> <span class="n">MJ_RFC7159</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode_schema</span> <span class="o">=</span> <span class="n">MS_DRAFT4</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode_pointer</span> <span class="o">=</span> <span class="n">MJ_RFC6901</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode_patch</span> <span class="o">=</span> <span class="n">MJ_RFC6902</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">saveContext</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">branch</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">schema</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indent</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sort_keys</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">validator</span> <span class="o">=</span> <span class="n">MS_OFF</span>  <span class="c1"># default validator</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">jsonsyn</span> <span class="o">=</span> <span class="n">JSYN_NATIVE</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">op_depth</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">op_ignore</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">op_use</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_pre</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">op_cp_pol</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;copy&#39;</span><span class="p">,</span> <span class="n">C_DEFAULT</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># fetch keyword parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setkargs</span><span class="p">(</span><span class="o">**</span><span class="n">kargs</span><span class="p">)</span>

        <span class="c1">#</span>
        <span class="c1"># fetch JSON document</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">jdata</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="p">):</span>  <span class="c1"># object or array</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">op_cp_pol</span> <span class="o">==</span> <span class="n">C_REF</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">jdata</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">op_cp_pol</span> <span class="o">==</span> <span class="n">C_SHALLOW</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">jdata</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">op_cp_pol</span> <span class="o">==</span> <span class="n">C_DEEP</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">jdata</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">jdata</span><span class="p">,</span> <span class="n">JSONData</span><span class="p">):</span>  <span class="c1"># copy constructor</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">jdata</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">schema</span> <span class="o">=</span> <span class="n">jdata</span><span class="o">.</span><span class="n">schema</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">schemafile</span> <span class="o">=</span> <span class="n">jdata</span><span class="o">.</span><span class="n">schemafile</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mode_json</span> <span class="o">=</span> <span class="n">jdata</span><span class="o">.</span><span class="n">mode_json</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mode_schema</span> <span class="o">=</span> <span class="n">jdata</span><span class="o">.</span><span class="n">mode_schema</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mode_pointer</span> <span class="o">=</span> <span class="n">jdata</span><span class="o">.</span><span class="n">mode_pointer</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mode_patch</span> <span class="o">=</span> <span class="n">jdata</span><span class="o">.</span><span class="n">mode_patch</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">saveContext</span> <span class="o">=</span> <span class="n">jdata</span><span class="o">.</span><span class="n">saveContext</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">indent</span> <span class="o">=</span> <span class="n">jdata</span><span class="o">.</span><span class="n">indent</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sort_keys</span> <span class="o">=</span> <span class="n">jdata</span><span class="o">.</span><span class="n">sort_keys</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">validator</span> <span class="o">=</span> <span class="n">jdata</span><span class="o">.</span><span class="n">validator</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">op_depth</span> <span class="o">=</span> <span class="n">jdata</span><span class="o">.</span><span class="n">op_depth</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">op_ignore</span> <span class="o">=</span> <span class="n">jdata</span><span class="o">.</span><span class="n">op_ignore</span><span class="p">[:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">op_use</span> <span class="o">=</span> <span class="n">jdata</span><span class="o">.</span><span class="n">op_use</span><span class="p">[:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state_pre</span> <span class="o">=</span> <span class="n">jdata</span><span class="o">.</span><span class="n">state_pre</span><span class="p">[:]</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">op_cp_pol</span> <span class="o">==</span> <span class="n">C_REF</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">jdata</span><span class="p">()</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">op_cp_pol</span> <span class="o">==</span> <span class="n">C_SHALLOW</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">jdata</span><span class="p">())</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">op_cp_pol</span> <span class="o">==</span> <span class="n">C_DEEP</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">jdata</span><span class="p">())</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">JSONDataError</span><span class="p">(</span><span class="s2">&quot;Non-valid JSON data:&quot;</span> <span class="o">+</span>
                                        <span class="nb">str</span><span class="p">(</span><span class="n">jdata</span><span class="p">))</span>

        <span class="k">else</span><span class="p">:</span>  <span class="c1"># values for RFC7159/RFC8259</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode_json</span> <span class="o">==</span> <span class="n">MJ_RFC4627</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">JSONDataError</span><span class="p">(</span>
                    <span class="s2">&quot;Mode RFC4627 - Non-valid JSON data, requires object or array: </span><span class="si">%s</span><span class="s2"> - </span><span class="si">%s</span><span class="s2">&quot;</span>
                    <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">jdata</span><span class="p">)),</span> <span class="nb">str</span><span class="p">(</span><span class="n">jdata</span><span class="p">)))</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">op_cp_pol</span> <span class="o">==</span> <span class="n">C_REF</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">jdata</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">op_cp_pol</span> <span class="o">==</span> <span class="n">C_SHALLOW</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">jdata</span><span class="p">)</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">op_cp_pol</span> <span class="o">==</span> <span class="n">C_DEEP</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">jdata</span><span class="p">)</span>

            <span class="k">except</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">JSONDataError</span><span class="p">(</span>
                    <span class="s2">&quot;Non-valid JSON data:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">jdata</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DBG:JSON=           &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                    <span class="n">myjson</span><span class="o">.</span><span class="n">__name__</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; / &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">myjson</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>
                    <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">DBG:self.data=    #[&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;]#&quot;</span>
                    <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">DBG:self.schema=  #[&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;]#</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;VERB:JSON=          &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">myjson</span><span class="o">.</span><span class="n">__name__</span><span class="p">)</span>
                  <span class="o">+</span> <span class="s2">&quot; / &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">myjson</span><span class="o">.</span><span class="n">__version__</span><span class="p">))</span>

        <span class="c1"># Validate.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">validator</span> <span class="o">!=</span> <span class="n">MS_OFF</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">JSONDataParameterError</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="s2">&quot;schema&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="p">))</span>

        <span class="c1"># INPUT-BRANCH: validate data</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">validator</span> <span class="o">!=</span> <span class="n">MS_OFF</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">validator</span><span class="p">)</span></div>

<div class="viewcode-block" id="JSONData.setkargs"><a class="viewcode-back" href="../../jsondata_jsondata_doc.html#jsondata.jsondata.JSONData.setkargs">[docs]</a>    <span class="k">def</span> <span class="nf">setkargs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets key arguments.</span>

<span class="sd">        Args:</span>

<span class="sd">            kargs:</span>

<span class="sd">                **copydata**:</span>
<span class="sd">                    Controls the assignment policy for JSON data.</span>
<span class="sd">                    The schema is copied by reference only, once</span>
<span class="sd">                    read. ::</span>

<span class="sd">                       copydata := (</span>
<span class="sd">                            C_REF       # by reference</span>
<span class="sd">                          | C_DEEP      # by copy.deepcopy()</span>
<span class="sd">                          | C_SHALLOW   # by copy.copy()</span>
<span class="sd">                       )</span>

<span class="sd">                **debug**:</span>
<span class="sd">                    Displays extended state data for developers.</span>
<span class="sd">                    Requires __debug__==True.</span>

<span class="sd">                **depth**:</span>
<span class="sd">                    Sets the default behavior for the operators.</span>
<span class="sd">                    Controls, whether the hook only or the complete</span>
<span class="sd">                    branch is processed in depth node-by-node. ::</span>

<span class="sd">                       0:  the hook of the branch</span>
<span class="sd">                       #n: the level of the branch as integer, the</span>
<span class="sd">                           remaining sub-branch is treated by it&#39;s hook</span>
<span class="sd">                       -1: the complete branch</span>

<span class="sd">                    default:= 0</span>

<span class="sd">                **indent_str**:</span>
<span class="sd">                    Defied the indentation of &#39;str&#39;.</span>

<span class="sd">                    default:= 4</span>

<span class="sd">                **jsonsyntax**:</span>
<span class="sd">                    The display syntax for JSON data with</span>
<span class="sd">                    *__str__*. ::</span>

<span class="sd">                       jsonsyntax := (</span>
<span class="sd">                            JSYN_NATIVE | &#39;json&#39;</span>
<span class="sd">                          | JSYN_PYTHON | &#39;python&#39;</span>
<span class="sd">                       )</span>

<span class="sd">                       JSYN_NATIVE: Native standards syntax.</span>
<span class="sd">                       JSYN_PYTHON: Python in-memory syntax.</span>

<span class="sd">                **mode**:</span>
<span class="sd">                    The mode of JSON processing: ::</span>

<span class="sd">                       mode := (</span>
<span class="sd">                            MJ_RFC4627 | &#39;rfc4627&#39;</span>
<span class="sd">                          | MJ_RFC7493 | &#39;rfc7493&#39;  # currently not supported, mapped to RFC7159</span>
<span class="sd">                          | MJ_RFC7159 | &#39;rfc7159&#39;</span>
<span class="sd">                          | MJ_RFC8259 | &#39;rfc8259&#39;</span>
<span class="sd">                          | MJ_ECMA404 | &#39;ecma404&#39;  # same as RFC8259</span>
<span class="sd">                       )</span>

<span class="sd">                    default := MJ_RFC7159</span>

<span class="sd">                **rtype**:</span>
<span class="sd">                    Sets the data type of the returned result. ::</span>

<span class="sd">                       rtype := (</span>
<span class="sd">                            data    # returns the data record only - self.data</span>
<span class="sd">                          | jdata   # returns an object of class JSONData</span>
<span class="sd">                          | obj     # returns an object of own class</span>
<span class="sd">                       )</span>

<span class="sd">                    default := obj</span>

<span class="sd">                **saveContext**:</span>
<span class="sd">                    Saves and restores the defined context</span>
<span class="sd">                    parameters when entering a context call.</span>

<span class="sd">                    default:= True</span>

<span class="sd">                **schema**:</span>
<span class="sd">                    A valid in-memory JSONschema.</span>

<span class="sd">                    default:= None</span>

<span class="sd">                **sortstr**:</span>
<span class="sd">                    Sort display of &#39;str()&#39; by key. ::</span>

<span class="sd">                        sortstr := (True | False)</span>

<span class="sd">                    default := True</span>

<span class="sd">                **validator**:</span>
<span class="sd">                    Sets schema validator for the data file.</span>
<span class="sd">                    Curren release relies on *jsonschema*, which</span>
<span class="sd">                    supports at the time of writing draft-03 and</span>
<span class="sd">                    draft-04.</span>

<span class="sd">                    The values are: ::</span>

<span class="sd">                        validator := (</span>
<span class="sd">                              MS_DRAFT3           | &#39;draft3&#39;</span>
<span class="sd">                            | MS_DRAFT4           | &#39;draft4&#39;</span>
<span class="sd">                            | MS_ON               | &#39;on&#39;</span>
<span class="sd">                            | MS_OFF              | &#39;off&#39;</span>
<span class="sd">                            | MODE_SCHEMA_DEFAULT | &#39;default&#39;</span>
<span class="sd">                        )</span>

<span class="sd">                    default:= MS_OFF</span>

<span class="sd">                **verbose**:</span>
<span class="sd">                    Extends the amount of the display of</span>
<span class="sd">                    processing data.</span>

<span class="sd">        Returns:</span>
<span class="sd">            instance/None</span>

<span class="sd">        Raises:</span>

<span class="sd">            NameError:</span>

<span class="sd">            JSONDataValueError</span>

<span class="sd">            jsonschema.ValidationError:</span>

<span class="sd">            jsonschema.SchemaError:</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;debug&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;verbose&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>


        <span class="c1">#</span>
        <span class="c1">#self.op_cp_pol = kargs.get(&#39;copydata&#39;, C_DEFAULT)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">op_cp_pol</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;copydata&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">op_cp_pol</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">op_cp_pol</span> <span class="o">=</span> <span class="n">copy2c</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">op_cp_pol</span><span class="p">]</span>
        <span class="k">except</span> <span class="n">JSONDataKeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">JSONDataValueError</span><span class="p">(</span><span class="s1">&#39;copydata&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">op_cp_pol</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">indent_str</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;indent_str&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1">#: for __str__</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sort_keys</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;sortstr&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>  <span class="c1">#: for __str__</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">jsonsyntax</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;jsonsyntax&#39;</span><span class="p">,</span> <span class="n">JSYN_NATIVE</span><span class="p">)</span>  <span class="c1">#: controls context parameter restoration</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">jsonsyntax</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="n">JSYN_NATIVE</span><span class="p">,</span> <span class="s1">&#39;json&#39;</span><span class="p">,</span> <span class="n">JSYN_PYTHON</span><span class="p">,</span> <span class="s1">&#39;python&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">JSONDataError</span><span class="p">(</span><span class="s2">&quot;Unknown syntax variant: jsonsyntax=&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jsonsyntax</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">saveContext</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;saveContext&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1">#: controls context parameter restoration</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">schema</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;schema&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>  <span class="c1">#: The internal object schema for the framework - a fixed set of files as final MS_DRAFT4.</span>

        <span class="c1">#</span>
        <span class="n">validator</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;validator&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">validator</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">validator</span> <span class="o">=</span> <span class="n">validator2ms</span><span class="p">[</span><span class="n">validator</span><span class="p">]</span>
        <span class="k">except</span> <span class="n">JSONDataKeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">JSONDataValueError</span><span class="p">(</span><span class="s1">&#39;validator&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">validator</span><span class="p">))</span>

        <span class="c1"># INPUT-BRANCH: schema for validation</span>
        <span class="k">if</span> <span class="n">validator</span> <span class="o">!=</span> <span class="n">MS_OFF</span><span class="p">:</span>  <span class="c1"># validation requested, requires schema</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="p">:</span>  <span class="c1"># no schema data present</span>
                <span class="k">raise</span> <span class="n">JSONDataError</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="s2">&quot;schema&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="p">)</span>

        <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode_json</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;mode&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode_json</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mode_json</span> <span class="o">=</span> <span class="n">mode2mj</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">mode_json</span><span class="p">]</span>
        <span class="k">except</span> <span class="n">JSONDataKeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">JSONDataParameterError</span><span class="p">(</span><span class="s2">&quot;Unknown mode:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mode_json</span><span class="p">))</span>

        <span class="c1">#</span>
        <span class="n">_d</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;depth&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">_d</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">_d</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">op_depth</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">elif</span> <span class="n">_d</span><span class="o">.</span><span class="n">isnumeric</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">op_depth</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">_d</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">JSONDataValueError</span><span class="p">(</span><span class="s2">&quot;Not supported&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">_d</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;VERB:JSON=          &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">myjson</span><span class="o">.</span><span class="n">__name__</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; / &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                <span class="n">myjson</span><span class="o">.</span><span class="n">__version__</span><span class="p">))</span>

        <span class="c1"># Check data.</span>
        <span class="k">if</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>  <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">JSONDataParameterError</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>

        <span class="c1"># Validate.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">validator</span> <span class="o">!=</span> <span class="n">MS_OFF</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">JSONDataParameterError</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="s2">&quot;schema&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="p">))</span>

        <span class="c1"># INPUT-BRANCH: validate data</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">validator</span> <span class="o">!=</span> <span class="n">MS_OFF</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">validator</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

<div class="viewcode-block" id="JSONData.__delitem__"><a class="viewcode-back" href="../../jsondata_jsondata_doc.html#jsondata.jsondata.JSONData.__delitem__">[docs]</a>    <span class="k">def</span> <span class="nf">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Deletes an item of *self.data*.</span>

<span class="sd">        Args:</span>
<span class="sd">            k:</span>
<span class="sd">                Key or index of *self.data*.</span>
<span class="sd">                If *None* the *self.data* is assigned *None*.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        Raises:</span>
<span class="sd">            JSONDataKeyError</span>

<span class="sd">            IndexError</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>  <span class="c1"># for now want the exeption</span>
        <span class="k">raise</span> <span class="n">JSONDataKeyError</span><span class="p">(</span><span class="s2">&quot;requires object(dict) of array(list)&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="JSONData.get_data_items"><a class="viewcode-back" href="../../jsondata_jsondata_doc.html#jsondata.jsondata.JSONData.get_data_items">[docs]</a>    <span class="k">def</span> <span class="nf">get_data_items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a dictionary for objects as well as arrays.</span>
<span class="sd">        Arrays are returned as a *dict* with interger indexes as keys,</span>
<span class="sd">        while objects - *dict* - are returned by the native *items()*</span>
<span class="sd">        call.</span>

<span class="sd">        If required else use the attributes directly.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)):</span>
                <span class="n">ret</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">ret</span><span class="o">.</span><span class="n">items</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">get_data_keys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a list of keys for objects, or a list of indexes</span>
<span class="sd">        for arrays, thus enabling common access.</span>

<span class="sd">        Args:</span>
<span class="sd">            None</span>

<span class="sd">        Returns:</span>
<span class="sd">            For objects - dict - a list of keys,</span>
<span class="sd">            for arrays - list - a list of integer indexes.</span>

<span class="sd">        Raises:</span>
<span class="sd">            pass-through</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)):</span>
                <span class="n">ret</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">ret</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>


<div class="viewcode-block" id="JSONData.__setitem__"><a class="viewcode-back" href="../../jsondata_jsondata_doc.html#jsondata.jsondata.JSONData.__setitem__">[docs]</a>    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Assigns a value to an item of *self.data*.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">JSONDataKeyError</span><span class="p">(</span><span class="s2">&quot;requires object(dict) of array(list)&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="JSONData.__enter__"><a class="viewcode-back" href="../../jsondata_jsondata_doc.html#jsondata.jsondata.JSONData.__enter__">[docs]</a>    <span class="k">def</span> <span class="nf">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Context for processing of specific parameter setups.</span>

<span class="sd">        Args:</span>

<span class="sd">            Context Parameters:</span>
<span class="sd">                See setargs. ::</span>

<span class="sd">                   copy, rtype, saveContext</span>


<span class="sd">        Returns:</span>

<span class="sd">        Raises:</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">saveContext</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state_pre</span><span class="o">.</span><span class="n">append</span><span class="p">([</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mode_json</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mode_schema</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mode_pointer</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">mode_patch</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">indent</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">sort_keys</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">validator</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">op_depth</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">op_ignore</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">op_use</span><span class="p">,</span>
            <span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">()</span></div>

<div class="viewcode-block" id="JSONData.__exit__"><a class="viewcode-back" href="../../jsondata_jsondata_doc.html#jsondata.jsondata.JSONData.__exit__">[docs]</a>    <span class="k">def</span> <span class="nf">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Resets the context to the parameter setup before the last call of &#39;enter&#39;.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">saveContext</span><span class="p">:</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mode_json</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode_schema</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode_pointer</span><span class="p">,</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">mode_patch</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">indent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sort_keys</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">validator</span><span class="p">,</span>
             <span class="bp">self</span><span class="o">.</span><span class="n">op_depth</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">op_ignore</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">op_use</span><span class="p">,</span>
            <span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_pre</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">__bool__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The boolean value of the contained data status *JSONData*.</span>

<span class="sd">        Args:</span>
<span class="sd">            None</span>

<span class="sd">        Returns:</span>
<span class="sd">            True:  has any data</span>
<span class="sd">            False: no data contained, this is also the case for empty *list* and *dict*</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="p">{},</span> <span class="p">[])</span>

    <span class="k">def</span> <span class="nf">__nonzero__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;The boolean value of the contained data status *JSONData*.</span>

<span class="sd">        Args:</span>
<span class="sd">            None</span>

<span class="sd">        Returns:</span>
<span class="sd">            True:  has any data</span>
<span class="sd">            False: no data contained, this is also the case for empty *list* and *dict*</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="p">{},</span> <span class="p">[])</span>

<div class="viewcode-block" id="JSONData.__call__"><a class="viewcode-back" href="../../jsondata_jsondata_doc.html#jsondata.jsondata.JSONData.__call__">[docs]</a>    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Evaluates the pointed value from the document.</span>

<span class="sd">        The operation::</span>

<span class="sd">           z = S(x)</span>

<span class="sd">        Returns the top node referenced by the JSON-Pointer &#39;x&#39; in accordance to RFC6901::</span>

<span class="sd">           z = ( S =&gt; x )</span>

<span class="sd">        Args:</span>
<span class="sd">            *args:</span>

<span class="sd">                args[0]:</span>
<span class="sd">                    An optional valid JSONPointer.</span>

<span class="sd">                    default:=&#39;&#39; =&gt; top, see [RFC6901]_</span>

<span class="sd">            **kargs:</span>

<span class="sd">                **copydata**:</span>
<span class="sd">                    Use of input parameters for processing. ::</span>

<span class="sd">                       copydata := (</span>
<span class="sd">                            C_DEEP     | &#39;deep&#39;</span>
<span class="sd">                          | C_REF      | &#39;ref&#39;</span>
<span class="sd">                          | C_SHALLOW  | &#39;shallow&#39;)</span>

<span class="sd">                    default := C_REF</span>

<span class="sd">        Returns:</span>
<span class="sd">            The pointed value, or None.</span>

<span class="sd">        Raises:</span>
<span class="sd">            JSONPointerError</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;copydata&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">c</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;deep&#39;</span><span class="p">,</span> <span class="n">C_DEEP</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">JSONPointer</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">get_node_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
                <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span>
                    <span class="n">JSONPointer</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">get_node_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;shallow&#39;</span><span class="p">,</span> <span class="n">C_SHALLOW</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">JSONPointer</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">get_node_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
                <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">JSONPointer</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">get_node_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;ref&#39;</span><span class="p">,</span> <span class="n">C_REF</span><span class="p">):</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">JSONDataError</span><span class="p">(</span><span class="s2">&quot;Unknown copy type:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">JSONPointer</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">get_node_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">JSONPointer</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">get_node_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span></div>

<div class="viewcode-block" id="JSONData.__eq__"><a class="viewcode-back" href="../../jsondata_jsondata_doc.html#jsondata.jsondata.JSONData.__eq__">[docs]</a>    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compares this JSONData.data with x.</span>

<span class="sd">        The operations: ::</span>

<span class="sd">           S == x</span>

<span class="sd">        Returns the result of comparison: ::</span>

<span class="sd">           z = ( S == x )</span>

<span class="sd">        Args:</span>

<span class="sd">            x: A valid JSONData.</span>

<span class="sd">        Context Parameters:</span>

<span class="sd">            See setargs.</span>

<span class="sd">        Returns:</span>

<span class="sd">            True or False</span>

<span class="sd">        Raises:</span>

<span class="sd">            JSONDataError</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">x</span><span class="p">:</span>  <span class="c1"># all None is equal,...</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>  <span class="c1"># ...one only is not</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="p">):</span>  <span class="c1"># is a tree...</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="n">x</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">JSONData</span><span class="p">):</span>  <span class="c1"># is a container</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="n">x</span><span class="o">.</span><span class="n">data</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="n">x</span>  <span class="c1"># is any atom</span></div>

<div class="viewcode-block" id="JSONData.__repr__"><a class="viewcode-back" href="../../jsondata_jsondata_doc.html#jsondata.jsondata.JSONData.__repr__">[docs]</a>    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Dump data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span></div>

<div class="viewcode-block" id="JSONData.__str__"><a class="viewcode-back" href="../../jsondata_jsondata_doc.html#jsondata.jsondata.JSONData.__str__">[docs]</a>    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Dumps data by pretty print.</span>

<span class="sd">        The data representation is controlled by the</span>
<span class="sd">        variable &#39;self.jsonsyn&#39; ::</span>

<span class="sd">           JSONData.jsonscope := (JSYN_NATIVE | JSYN_PYTHON)</span>

<span class="sd">           JSYN_NATIVE: &quot;Literally in accordance to standards.&quot;</span>
<span class="sd">           JSYN_PYTHON: &quot;Python in-memory syntax representation.&quot;</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">jsonsyn</span> <span class="o">==</span> <span class="n">JSYN_NATIVE</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">myjson</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">indent</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sort_keys</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">jsonsyn</span> <span class="o">==</span> <span class="n">JSYN_PYTHON</span><span class="p">:</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">myjson</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">indent</span><span class="p">,</span> <span class="n">sort_keys</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">sort_keys</span><span class="p">)</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;true&quot;</span><span class="p">,</span> <span class="s2">&quot;True&quot;</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;false&quot;</span><span class="p">,</span> <span class="s2">&quot;False&quot;</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;null&quot;</span><span class="p">,</span> <span class="s2">&quot;None&quot;</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">s</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">JSONDataError</span><span class="p">(</span><span class="s2">&quot;JSON syntax variant not supported.&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">jsonsyn</span><span class="p">))</span></div>

<div class="viewcode-block" id="JSONData.__getitem__"><a class="viewcode-back" href="../../jsondata_jsondata_doc.html#jsondata.jsondata.JSONData.__getitem__">[docs]</a>    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sel</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets an  entry of *self.data*.</span>

<span class="sd">        Args:</span>
<span class="sd">            sel:</span>
<span class="sd">                Selector, either a key, or an index.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The entry at the location,</span>
<span class="sd">            or raises en exception.</span>

<span class="sd">        Raises:</span>
<span class="sd">            JSONDataKeyError(KeyError)</span>

<span class="sd">            JSONDataIndexError(IndexError)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">sel</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">JSONDataKeyError</span><span class="p">(</span><span class="s2">&quot;object requires member name as key, got: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">sel</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">JSONDataIndexError</span><span class="p">(</span><span class="s2">&quot;array requires index, got: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">sel</span><span class="p">))</span></div>

<div class="viewcode-block" id="JSONData.__iter__"><a class="viewcode-back" href="../../jsondata_jsondata_doc.html#jsondata.jsondata.JSONData.__iter__">[docs]</a>    <span class="k">def</span> <span class="nf">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Provides an iterator for contained native data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span></div>

<div class="viewcode-block" id="JSONData.__ne__"><a class="viewcode-back" href="../../jsondata_jsondata_doc.html#jsondata.jsondata.JSONData.__ne__">[docs]</a>    <span class="k">def</span> <span class="nf">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compares this JSONData with x.</span>

<span class="sd">        Args:</span>
<span class="sd">            x:</span>
<span class="sd">                Valid JSONData.</span>

<span class="sd">        Returns:</span>
<span class="sd">            True or False</span>

<span class="sd">        Raises:</span>
<span class="sd">            JSONDataError</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__eq__</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></div>

<div class="viewcode-block" id="JSONData.branch_add"><a class="viewcode-back" href="../../jsondata_jsondata_doc.html#jsondata.jsondata.JSONData.branch_add">[docs]</a>    <span class="k">def</span> <span class="nf">branch_add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sourcenode</span><span class="p">,</span> <span class="n">targetnode</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add a complete branch into a target structure of type object.</span>
<span class="sd">        Present branches are replaced, non-existent branches are</span>
<span class="sd">        added.</span>

<span class="sd">        The parent of the insertion point has to exist by default,</span>
<span class="sd">        see [RFC6902]_. If the target is an array, the source is either</span>
<span class="sd">        appended, or inserted [RFC6902]_.</span>

<span class="sd">        Args:</span>
<span class="sd">            **sourcenode**:</span>
<span class="sd">                Source branch to be inserted into the target tree.</span>
<span class="sd">                Either from within self-data, or an external source: ::</span>

<span class="sd">                  sourcenode := &lt;commonnode&gt;       # see class header</span>

<span class="sd">            **targetnode**:</span>
<span class="sd">                Target node within self-data, where the branch is to be inserted. ::</span>

<span class="sd">                  targetnode := &lt;innode&gt;           # see class header</span>

<span class="sd">                default := &#39;&#39;                      # the top of the &#39;whole document&#39;</span>

<span class="sd">            **key**:</span>
<span class="sd">                Hook for the insertion within the target node. If not</span>
<span class="sd">                provided the contents of the target node itself are</span>
<span class="sd">                replaced by the source node.</span>

<span class="sd">                default := None</span>

<span class="sd">            kargs:</span>
<span class="sd">                **copydata**:</span>
<span class="sd">                    The type of creation of the added branch. ::</span>

<span class="sd">                        copydata := (</span>
<span class="sd">                              C_REF        # copy the reference only</span>
<span class="sd">                            | C_DEEP       # call copy.deepcopy()</span>
<span class="sd">                            | C_SHALLOW    # call copy.copy()</span>
<span class="sd">                        )</span>

<span class="sd">                    default := C_DEEP</span>

<span class="sd">        Returns:</span>
<span class="sd">            When successful returns *True*, else returns</span>
<span class="sd">            either *False*, or raises an exception.</span>

<span class="sd">        Raises:</span>
<span class="sd">            JSONDataNodeError:</span>
<span class="sd">                The target node is not contained in current object.</span>

<span class="sd">            JSONDataNodeTypeError:</span>
<span class="sd">                The types mismatch.</span>

<span class="sd">            JSONDataKeyError:</span>
<span class="sd">                Key mismatch.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">_copy</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;copydata&#39;</span><span class="p">,</span> <span class="n">C_DEEP</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">_cp</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">_copy</span> <span class="o">==</span> <span class="n">C_DEEP</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">_copy</span> <span class="o">==</span> <span class="n">C_SHALLOW</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">_copy</span> <span class="o">==</span> <span class="n">C_REF</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">v</span>
            <span class="k">else</span><span class="p">:</span>  <span class="c1"># default</span>
                <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sourcenode</span><span class="p">,</span> <span class="n">JSONPointer</span><span class="p">):</span>
            <span class="n">sourcenode</span> <span class="o">=</span> <span class="n">sourcenode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">sourcenode</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ISSTR</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">sourcenode</span> <span class="o">=</span> <span class="n">JSONPointer</span><span class="p">(</span><span class="n">sourcenode</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">JSONPointerTypeError</span><span class="p">:</span>
                <span class="c1"># when not a pointer, than is assumed to be a value</span>
                <span class="k">if</span> <span class="n">sourcenode</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span>
                    <span class="c1"># it was a valid absolute pointer, so it is actually an error</span>
                    <span class="k">raise</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">sourcenode</span><span class="p">,</span> <span class="n">JSONData</span><span class="p">):</span>
            <span class="n">sourcenode</span> <span class="o">=</span> <span class="n">sourcenode</span><span class="o">.</span><span class="n">data</span>


        <span class="k">if</span> <span class="n">targetnode</span> <span class="ow">is</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">targetnode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">targetnode</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ISSTR</span><span class="p">:</span>
            <span class="n">targetnode</span> <span class="o">=</span> <span class="n">JSONPointer</span><span class="p">(</span><span class="n">targetnode</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">targetnode</span><span class="p">,</span> <span class="n">JSONData</span><span class="p">):</span>
            <span class="n">targetnode</span> <span class="o">=</span> <span class="n">targetnode</span><span class="o">.</span><span class="n">data</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">targetnode</span><span class="p">,</span> <span class="n">JSONPointer</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span><span class="p">:</span>
                    <span class="n">targetnode</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="n">targetnode</span><span class="o">.</span><span class="n">get_node_and_key</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">targetnode</span> <span class="o">=</span> <span class="n">targetnode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">JSONDataKeyError</span><span class="p">:</span>
                <span class="k">raise</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="c1"># requires some more of a new path than for the node-only</span>
                <span class="k">if</span> <span class="n">key</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">branch_create</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">targetnode</span><span class="p">,</span> <span class="p">[])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">branch_create</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">targetnode</span><span class="p">,</span> <span class="p">{})</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span><span class="p">:</span>
                    <span class="n">targetnode</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="n">targetnode</span><span class="o">.</span><span class="n">get_node_and_child</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">targetnode</span> <span class="o">=</span> <span class="n">targetnode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">targetnode</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span><span class="p">:</span>
                <span class="n">targetnode</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">_cp</span><span class="p">(</span><span class="n">sourcenode</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">sourcenode</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">dict</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">JSONDataNodeTypeError</span><span class="p">(</span>
                        <span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;dict-target requires a key:targetnode/sourcenode&quot;</span><span class="p">,</span>
                        <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">targetnode</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">sourcenode</span><span class="p">)))</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">sourcenode</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">targetnode</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">_cp</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">targetnode</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span>  <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

                <span class="c1"># source list items extend contents of the target list</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">sourcenode</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
                    <span class="n">targetnode</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">_cp</span><span class="p">(</span><span class="n">sourcenode</span><span class="p">))</span>

                <span class="c1"># source dictionaries replace the list</span>
                <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">sourcenode</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
                    <span class="n">targetnode</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sourcenode</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;-&#39;</span> <span class="ow">or</span> <span class="n">key</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">targetnode</span><span class="p">):</span>
                <span class="n">targetnode</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_cp</span><span class="p">(</span><span class="n">sourcenode</span><span class="p">))</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">elif</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">key</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">targetnode</span><span class="p">):</span>
                <span class="n">targetnode</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">_cp</span><span class="p">(</span><span class="n">sourcenode</span><span class="p">))</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">JSONDataKeyError</span><span class="p">(</span>
                    <span class="s2">&quot;mismatch:node:type&quot;</span><span class="p">,</span> <span class="s1">&#39;key&#39;</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="s1">&#39;key-type&#39;</span><span class="p">,</span>
                    <span class="nb">type</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="s1">&#39;node-type&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="n">targetnode</span><span class="p">))</span>

            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">JSONDataNodeTypeError</span><span class="p">(</span>
                <span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;requires array or object for targetnode: targetnode/sourcenode&quot;</span><span class="p">,</span>
                <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">targetnode</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">sourcenode</span><span class="p">)))</span>

        <span class="k">return</span> <span class="n">ret</span></div>

<div class="viewcode-block" id="JSONData.branch_copy"><a class="viewcode-back" href="../../jsondata_jsondata_doc.html#jsondata.jsondata.JSONData.branch_copy">[docs]</a>    <span class="k">def</span> <span class="nf">branch_copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sourcenode</span><span class="p">,</span> <span class="n">targetnode</span><span class="o">=</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Copies the source branch to the target node.</span>
<span class="sd">        The *branch_copy* is internally mapped to the call *branch_add*,</span>
<span class="sd">        thus shares basically the same parameters and behavior.</span>

<span class="sd">        Args:</span>

<span class="sd">            **sourcenode**:</span>
<span class="sd">                Source branch to be copied into target tree.</span>
<span class="sd">                Either from within self-data, or an external source: ::</span>

<span class="sd">                  sourcenode := &lt;commonnode&gt;       # see class header</span>

<span class="sd">            **targetnode**:</span>
<span class="sd">                Target node for the branch. Either from within self-data,</span>
<span class="sd">                or an external source: ::</span>

<span class="sd">                  targetnode := &lt;innode&gt;           # see class header</span>

<span class="sd">                default := &#39;/&#39;</span>

<span class="sd">            **key**:</span>
<span class="sd">                Optional key for the insertion point within target</span>
<span class="sd">                node, if not provided the target node itself.</span>

<span class="sd">            **force**:</span>
<span class="sd">                If true present are replaced, else only non-present</span>
<span class="sd">                targets are copied.</span>

<span class="sd">                default := True</span>

<span class="sd">        Returns:</span>
<span class="sd">            When successful returns *True*, else returns either *False*,</span>
<span class="sd">            or raises an exception.</span>

<span class="sd">        Raises:</span>
<span class="sd">            JSONDataError</span>

<span class="sd">            pass-through</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">force</span><span class="p">:</span>  <span class="c1"># force replace of existing</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">branch_add</span><span class="p">(</span><span class="n">sourcenode</span><span class="p">,</span> <span class="n">targetnode</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">targetnode</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;-&#39;</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">key</span>  <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">key</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">targetnode</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">targetnode</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
                        <span class="k">raise</span> <span class="n">JSONDataError</span><span class="p">(</span><span class="s2">&quot;Node exists.&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">targetnode</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">sourcenode</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="n">JSONDataError</span><span class="p">(</span><span class="s2">&quot;Node exists.&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">sourcenode</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">targetnode</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">JSONDataError</span><span class="p">(</span><span class="s2">&quot;Node exists.&quot;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">targetnode</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">targetnode</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="n">JSONDataError</span><span class="p">(</span><span class="s2">&quot;Node exists.&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">sourcenode</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">targetnode</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="n">JSONDataError</span><span class="p">(</span><span class="s2">&quot;Node exists.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">branch_add</span><span class="p">(</span><span class="n">sourcenode</span><span class="p">,</span> <span class="n">targetnode</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span></div>

<div class="viewcode-block" id="JSONData.branch_create"><a class="viewcode-back" href="../../jsondata_jsondata_doc.html#jsondata.jsondata.JSONData.branch_create">[docs]</a>    <span class="k">def</span> <span class="nf">branch_create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">branchpath</span><span class="p">,</span> <span class="n">targetnode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">padding_value</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates an abitrary relative branch from a path description</span>
<span class="sd">        located at *targetnode*. Intermediate nodes are created automatically</span>
<span class="sd">        when missing.</span>

<span class="sd">        The requested branch is created as the relative child branch</span>
<span class="sd">        of the provided *targetnode*. The *targetnode* must exist,</span>
<span class="sd">        while the child node - *branchpath[0]* - must not.</span>

<span class="sd">        Args:</span>

<span class="sd">            **branchpath**:</span>
<span class="sd">                New branch to be created in the target node.</span>
<span class="sd">                A Pointer address path relative to the *targetnode*. ::</span>

<span class="sd">                  branchpath := &lt;commonnode&gt;           # see class header</span>

<span class="sd">            **targetnode**:</span>
<span class="sd">                Base node for the created branch, must exist</span>
<span class="sd">                and located within the data tree of current object. ::</span>

<span class="sd">                  targetnode := &lt;innode&gt;           # see class header</span>

<span class="sd">                default := &quot;/&quot;</span>

<span class="sd">            **padding_value**:</span>
<span class="sd">                Optional default value, either an atomic type or a sub-branch</span>
<span class="sd">                itself. This value is only used for a new leaf, in case of</span>
<span class="sd">                an existent node the value is ignored.</span>

<span class="sd">                default := &quot;null&quot; / *None*</span>

<span class="sd">        Returns:</span>
<span class="sd">            When successful returns the created node, else returns</span>
<span class="sd">            either *None*, or raises an exception.</span>

<span class="sd">        Raises:</span>
<span class="sd">            JSONDataError</span>

<span class="sd">            JSONDataKeyError</span>

<span class="sd">            JSONDataNodeTypeError</span>

<span class="sd">            JSONDataParameterError</span>

<span class="sd">            JSONDataPathError</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">def</span> <span class="nf">get_newnode_of_type</span><span class="p">(</span><span class="n">bkeytype</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Fetch the required type for the new container.&quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">bkeytype</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">bkeytype</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">bkeytype</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;-&#39;</span><span class="p">:</span>  <span class="c1"># RFC6902</span>
                    <span class="k">return</span> <span class="p">[]</span>
                <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">bkeytype</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>  <span class="c1"># array</span>
                    <span class="k">return</span> <span class="p">[]</span>
                <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">bkeytype</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">in</span> <span class="p">(</span>
                        <span class="nb">str</span><span class="p">,</span>
                        <span class="n">unicode</span><span class="p">,</span> <span class="p">):</span>  <span class="c1"># object</span>
                    <span class="k">return</span> <span class="p">{}</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">bkeytype</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;-&#39;</span><span class="p">:</span>  <span class="c1"># RFC6902</span>
                    <span class="k">return</span> <span class="p">[]</span>
                <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">bkeytype</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>  <span class="c1"># array</span>
                    <span class="k">return</span> <span class="p">[]</span>
                <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">bkeytype</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">in</span> <span class="p">(</span>
                        <span class="nb">str</span><span class="p">,</span>
                        <span class="n">unicode</span><span class="p">,</span> <span class="p">):</span>  <span class="c1"># object</span>
                    <span class="k">return</span> <span class="p">{}</span>

            <span class="k">raise</span> <span class="n">JSONDataKeyError</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s1">&#39;keytype&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">bkeytype</span><span class="p">))</span>

        <span class="c1">#</span>
        <span class="c1"># prepare branchpath</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">branchpath</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ISSTR</span><span class="p">:</span>
            <span class="n">branchpath</span> <span class="o">=</span> <span class="n">JSONPointer</span><span class="p">(</span><span class="n">branchpath</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">branchpath</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>  <span class="c1"># basic behaviour rfc6902</span>
            <span class="k">raise</span> <span class="n">JSONDataPathError</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;branchpath&quot;</span><span class="p">,</span> <span class="n">branchpath</span><span class="p">)</span>

        <span class="c1">#</span>
        <span class="c1"># prepare target node</span>
        <span class="k">if</span> <span class="n">targetnode</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tnode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">targetnode</span><span class="p">,</span> <span class="n">JSONPointer</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">tnode</span> <span class="o">=</span> <span class="n">targetnode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">JSONDataNodeTypeError</span><span class="p">(</span>
                    <span class="s2">&quot;Requires container, got type=&#39;</span><span class="si">%s</span><span class="s2">&#39; in target node:&#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span>
                    <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">tnode</span><span class="p">)),</span> <span class="nb">str</span><span class="p">(</span><span class="n">targetnode</span><span class="o">.</span><span class="n">get_raw</span><span class="p">())</span> <span class="p">))</span>

            <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="n">JSONPointerError</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">JSONDataKeyError</span><span class="p">(</span>
                    <span class="s2">&quot;Requires present node, missing target node:&#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span>
                    <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">targetnode</span><span class="o">.</span><span class="n">get_raw</span><span class="p">())</span> <span class="p">))</span>

        <span class="k">elif</span> <span class="n">targetnode</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>  <span class="c1"># RFC6901 - whole document</span>
            <span class="n">tnode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">tnode</span> <span class="o">=</span> <span class="n">targetnode</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">tnode</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="c1"># target is an object</span>

            <span class="c1"># Be aware, the special &#39;-&#39; could be a valid key, thus cannot be prohibited!!!</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">branchpath</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ISSTR</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">JSONDataPathError</span><span class="p">(</span>
                    <span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;branchpath&quot;</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">tnode</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">branchpath</span><span class="p">))</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">branchpath</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1"># actual branch items</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">tnode</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">unicode</span><span class="p">(</span><span class="n">branchpath</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="kc">False</span><span class="p">):</span>
                    <span class="n">tnode</span><span class="p">[</span><span class="n">unicode</span><span class="p">(</span><span class="n">branchpath</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span> <span class="o">=</span> <span class="n">get_newnode_of_type</span><span class="p">(</span><span class="n">branchpath</span><span class="p">)</span>

                <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">branch_create</span><span class="p">(</span>
                    <span class="n">branchpath</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">tnode</span><span class="p">[</span><span class="n">branchpath</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">padding_value</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># the leaf item - putting this onto an existing will</span>
                <span class="c1"># remove the previous value</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">tnode</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">branchpath</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="kc">False</span><span class="p">):</span>
                    <span class="n">ret</span> <span class="o">=</span> <span class="n">tnode</span><span class="p">[</span><span class="n">unicode</span><span class="p">(</span><span class="n">branchpath</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_canonical_value</span><span class="p">(</span><span class="n">padding_value</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ret</span> <span class="o">=</span> <span class="n">tnode</span><span class="p">[</span><span class="n">unicode</span><span class="p">(</span><span class="n">branchpath</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>

        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">tnode</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
            <span class="c1"># target is an array</span>

            <span class="c1"># see RFC6902 for &#39;-&#39;/append</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">branchpath</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="p">)</span> <span class="ow">and</span> <span class="n">branchpath</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tnode</span><span class="p">):</span>
                <span class="k">pass</span>
            <span class="k">elif</span> <span class="n">unicode</span><span class="p">(</span><span class="n">branchpath</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="s1">u&#39;-&#39;</span><span class="p">:</span>  <span class="c1"># see RFC6902 for &#39;-&#39;/append</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">JSONDataNodeTypeError</span><span class="p">(</span>
                    <span class="s2">&quot;index-value&quot;</span><span class="p">,</span> <span class="s2">&quot;targetnode/branch:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">tnode</span><span class="p">))</span>
                    <span class="o">+</span> <span class="s2">&quot; list-index requires int(i &lt;= len()) or &#39;-&#39;, got &quot;</span>
                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">branchpath</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">+</span> <span class="s2">&quot; &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">branchpath</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&#39;&quot;</span>
                    <span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">branchpath</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">branchpath</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;-&#39;</span><span class="p">:</span>
                    <span class="n">branchpath</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tnode</span><span class="p">)</span>
                    <span class="n">tnode</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_canonical_value</span><span class="p">(</span><span class="n">padding_value</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">tnode</span><span class="p">[</span><span class="n">branchpath</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_canonical_value</span><span class="p">(</span><span class="n">padding_value</span><span class="p">)</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="n">tnode</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">branchpath</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;-&#39;</span><span class="p">:</span>
                    <span class="n">tnode</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_newnode_of_type</span><span class="p">(</span><span class="n">branchpath</span><span class="p">))</span>
                    <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">branch_create</span><span class="p">(</span>
                        <span class="n">branchpath</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">tnode</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">padding_value</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">tnode</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">branchpath</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">tnode</span><span class="p">):</span>
                    <span class="n">tnode</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_newnode_of_type</span><span class="p">(</span><span class="n">branchpath</span><span class="p">))</span>
                    <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">branch_create</span><span class="p">(</span>
                        <span class="n">branchpath</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">tnode</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">padding_value</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">JSONDataNodeTypeError</span><span class="p">(</span>
                <span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;existing targetnode&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">targetnode</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; = &quot;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">tnode</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; requires: list or dict&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ret</span></div>

<div class="viewcode-block" id="JSONData.branch_move"><a class="viewcode-back" href="../../jsondata_jsondata_doc.html#jsondata.jsondata.JSONData.branch_move">[docs]</a>    <span class="k">def</span> <span class="nf">branch_move</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                    <span class="n">sourcenode</span><span class="p">,</span>
                    <span class="n">targetnode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                    <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

        <span class="sd">&quot;&quot;&quot;Moves a branch to the target node.</span>

<span class="sd">        Args:</span>

<span class="sd">            **sourcenode**:</span>
<span class="sd">                Source branch to be moved into the target node.</span>
<span class="sd">                Must be member of the self-data structure, else use</span>
<span class="sd">                either *branch_add* or *branch_copy*.</span>
<span class="sd">                Either from within self-data, or an external source: ::</span>

<span class="sd">                  sourcenode := &lt;innode&gt;       # see class header</span>

<span class="sd">            **targetnode**:</span>
<span class="sd">                Target node for the branch. ::</span>

<span class="sd">                  targetnode := &lt;innode&gt;       # see class header</span>

<span class="sd">                default := &#39;/&#39;</span>

<span class="sd">            **key**:</span>
<span class="sd">                Optional key for the insertion point within target</span>
<span class="sd">                node, if not provided the target node itself.</span>

<span class="sd">            **force**:</span>
<span class="sd">                If true present are replaced, else only non-present</span>
<span class="sd">                are copied.</span>

<span class="sd">                default := True</span>

<span class="sd">        Returns:</span>
<span class="sd">            When successful returns *True*, else returns either</span>
<span class="sd">            *None*, or raises an exception.</span>

<span class="sd">        Raises:</span>
<span class="sd">            JSONDataError</span>

<span class="sd">            JSONDataKeyError</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">branch_copy</span><span class="p">(</span><span class="n">sourcenode</span><span class="p">,</span> <span class="n">targetnode</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">force</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ret</span><span class="p">:</span>
            <span class="n">ret1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">branch_remove</span><span class="p">(</span><span class="n">sourcenode</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">ret</span> <span class="o">&amp;</span> <span class="n">ret1</span>
        <span class="k">return</span> <span class="n">ret</span></div>

<div class="viewcode-block" id="JSONData.branch_remove"><a class="viewcode-back" href="../../jsondata_jsondata_doc.html#jsondata.jsondata.JSONData.branch_remove">[docs]</a>    <span class="k">def</span> <span class="nf">branch_remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">targetnode</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rfc6902</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Removes a branch from a contained data in self.</span>

<span class="sd">        Args:</span>

<span class="sd">            **targetnode**:</span>
<span class="sd">                Container with item to be removed. ::</span>

<span class="sd">                  targetnode := &lt;innode&gt;       # see class header</span>

<span class="sd">            **key**:</span>
<span class="sd">                Key of insertion point within target node, if not</span>
<span class="sd">                provided the target node itself.</span>

<span class="sd">            **rfc6902**:</span>
<span class="sd">                If *True* the removed element has to be present,</span>
<span class="sd">                else non-present is simply ignored.</span>

<span class="sd">        Returns:</span>
<span class="sd">            When successful returns *True*, else returns</span>
<span class="sd">            either *False*, or raises an exception.</span>

<span class="sd">        Raises:</span>
<span class="sd">            JSONDataKeyError</span>

<span class="sd">            JSONDataNodeTypeError</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">targetnode</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ISSTR</span><span class="p">:</span>
            <span class="n">_targetnode</span> <span class="o">=</span> <span class="n">JSONPointer</span><span class="p">(</span><span class="n">targetnode</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">targetnode</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
            <span class="n">_targetnode</span> <span class="o">=</span> <span class="n">JSONPointer</span><span class="p">(</span><span class="n">targetnode</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">targetnode</span><span class="p">,</span> <span class="n">JSONPointer</span><span class="p">):</span>
            <span class="n">_targetnode</span> <span class="o">=</span> <span class="n">targetnode</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">JSONDataNodeTypeError</span><span class="p">(</span><span class="s2">&quot;Requires path within self:got:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">targetnode</span><span class="p">)))</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span><span class="p">:</span>
                <span class="n">_targetnode</span> <span class="o">=</span> <span class="n">targetnode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
                <span class="n">key</span> <span class="o">=</span> <span class="n">targetnode</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_targetnode</span> <span class="o">=</span> <span class="n">targetnode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">JSONDataKeyError</span><span class="p">(</span><span class="s2">&quot;Key not found:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>

        <span class="k">except</span> <span class="n">JSONPointerError</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">rfc6902</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">JSONDataKeyError</span><span class="p">(</span><span class="s2">&quot;Requires present node&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">targetnode</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">_targetnode</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">IndexError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">rfc6902</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">JSONDataKeyError</span><span class="p">(</span><span class="s2">&quot;Missing node within self: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">targetnode</span><span class="p">))</span>
            <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="JSONData.branch_replace"><a class="viewcode-back" href="../../jsondata_jsondata_doc.html#jsondata.jsondata.JSONData.branch_replace">[docs]</a>    <span class="k">def</span> <span class="nf">branch_replace</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sourcenode</span><span class="p">,</span> <span class="n">targetnode</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rfc6902</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Replaces the value of the target node by the copy</span>
<span class="sd">        of the source branch.</span>

<span class="sd">        Requires in order to RFC6902, all items to be replaced</span>
<span class="sd">        has to be present. Thus fails by default if at least one</span>
<span class="sd">        is missing.</span>

<span class="sd">        Internally the &#39;branch_add()&#39; call is used with a deep copy.</span>
<span class="sd">        When a swallow copy is required the &#39;branch_move()&#39; has to be used.</span>

<span class="sd">        Args:</span>
<span class="sd">            **sourcenode**:</span>
<span class="sd">                Source branch to be inserted into target tree.</span>
<span class="sd">                Either from within self-data, or an external source: ::</span>

<span class="sd">                  sourcenode := &lt;commonnode&gt;   # see class header</span>

<span class="sd">            **targetnode**:</span>
<span class="sd">                Target where the branch is inserted. ::</span>

<span class="sd">                  targetnode := &lt;innode&gt;       # see class header</span>

<span class="sd">            **key**:</span>
<span class="sd">                Key of insertion point within target node, if not</span>
<span class="sd">                provided the target node itself.</span>

<span class="sd">            **rfc6902**:</span>
<span class="sd">                If *True* the removed element has to be present,</span>
<span class="sd">                else non-present is simply ignored.</span>

<span class="sd">        Returns:</span>
<span class="sd">            When successful returns *True*, else returns</span>
<span class="sd">            either *False*, or raises an exception.</span>

<span class="sd">        Raises:</span>
<span class="sd">            JSONDataError</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">targetnode</span><span class="p">,</span> <span class="n">JSONPointer</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span><span class="p">:</span>
                    <span class="n">tnode</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="n">targetnode</span><span class="o">.</span><span class="n">get_node_and_key</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">tnode</span> <span class="o">=</span> <span class="n">targetnode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">JSONDataNodeTypeError</span><span class="p">(</span>
                    <span class="s2">&quot;Requires container, got type=&#39;</span><span class="si">%s</span><span class="s2">&#39; in target node:&#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span>
                    <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">tnode</span><span class="p">)),</span> <span class="nb">str</span><span class="p">(</span><span class="n">targetnode</span><span class="o">.</span><span class="n">get_raw</span><span class="p">())</span> <span class="p">))</span>

            <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="n">JSONPointerError</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">rfc6902</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">JSONDataKeyError</span><span class="p">(</span>
                        <span class="s2">&quot;Requires present node, missing key=&#39;</span><span class="si">%s</span><span class="s2">&#39; in target node:&#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span>
                        <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">targetnode</span><span class="o">.</span><span class="n">get_raw</span><span class="p">())</span> <span class="p">))</span>

        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">targetnode</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">list</span><span class="p">,):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span><span class="p">:</span>
                    <span class="n">tnode</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="n">JSONPointer</span><span class="p">(</span><span class="n">targetnode</span><span class="p">)</span><span class="o">.</span><span class="n">get_node_and_key</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">tnode</span> <span class="o">=</span> <span class="n">JSONPointer</span><span class="p">(</span><span class="n">targetnode</span><span class="p">)(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

            <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="n">JSONPointerError</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">rfc6902</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">targetnode</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">30</span><span class="p">:</span>
                        <span class="n">targetnode</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">targetnode</span><span class="p">)[:</span><span class="mi">30</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;...&#39;</span>
                    <span class="k">raise</span> <span class="n">JSONDataKeyError</span><span class="p">(</span>
                        <span class="s2">&quot;Requires present node, missing key=&#39;</span><span class="si">%s</span><span class="s2">&#39; in target node:&#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span>
                        <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">targetnode</span><span class="p">)</span> <span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">targetnode</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">30</span><span class="p">:</span>
                <span class="n">targetnode</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">targetnode</span><span class="p">)[:</span><span class="mi">30</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;...&#39;</span>
            <span class="k">raise</span> <span class="n">JSONDataNodeTypeError</span><span class="p">(</span>
                <span class="s2">&quot;Requires parent container-node, got target node:&#39;</span><span class="si">%s</span><span class="s2">: </span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span>
                <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">targetnode</span><span class="p">)),</span> <span class="nb">str</span><span class="p">(</span><span class="n">targetnode</span><span class="p">)))</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">branch_add</span><span class="p">(</span><span class="n">sourcenode</span><span class="p">,</span> <span class="n">tnode</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span></div>

<div class="viewcode-block" id="JSONData.branch_superpose"><a class="viewcode-back" href="../../jsondata_jsondata_doc.html#jsondata.jsondata.JSONData.branch_superpose">[docs]</a>    <span class="k">def</span> <span class="nf">branch_superpose</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sourcenode</span><span class="p">,</span> <span class="n">targetnode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Superposes a branch recursively on to the current data tree </span>
<span class="sd">        *self.data* with defined constraints. Provides partial mapping </span>
<span class="sd">        in dependence of parameters and data entries of source and/or </span>
<span class="sd">        target.</span>

<span class="sd">        The processing is controlled by logic operations on node </span>
<span class="sd">        structures, which maps a logical tree of JSON nodes from the</span>
<span class="sd">        source node onto the subtree of JSON nodes defined by the target</span>
<span class="sd">        target node. The provided logic operators are related to structure,</span>
<span class="sd">        though the types of nodes, not the contents.</span>
<span class="sd">        </span>
<span class="sd">        For the provided logic operators refer to parameter *map*.</span>

<span class="sd">        Args:</span>

<span class="sd">            **sourcenode**:</span>
<span class="sd">                Value struct to be inserted.</span>

<span class="sd">                default := None</span>

<span class="sd">            **targetnode**:</span>
<span class="sd">                Data node within current document to be superposed.</span>

<span class="sd">                default := None  # whole document *self.data*</span>

<span class="sd">            **key**:</span>
<span class="sd">                Hook selector within the data tree spanned by the targetnode .</span>

<span class="sd">                default := None  # top of the targetnode</span>

<span class="sd">            kargs:</span>
<span class="sd">                **copy**:</span>
<span class="sd">                    Create a copy of the sourcenode. ::</span>

<span class="sd">                       copy := (</span>
<span class="sd">                            C_DEEP      # insert from copy.deepcopy() </span>
<span class="sd">                          | C_SHALLOW   # insert from copy.copy()</span>
<span class="sd">                          | C_REF       # insert from the provided parameter</span>
<span class="sd">                          )</span>

<span class="sd">                    default := C_REF  # no copy, work on input</span>

<span class="sd">                **depth**: </span>
<span class="sd">                    Sets the default behavior for the operators</span>
<span class="sd">                    on the data branches. Controls, whether the hook</span>
<span class="sd">                    only or the complete branch is processed in </span>
<span class="sd">                    depth node-by-node. ::</span>

<span class="sd">                      0:  the hook of the branch</span>
<span class="sd">                      #n: the level of the branch as integer, the </span>
<span class="sd">                          remaining sub-branch is treated by it&#39;s hook</span>
<span class="sd">                      -1: the complete branch</span>

<span class="sd">                    default:= 0</span>

<span class="sd">                **ignore**:</span>
<span class="sd">                    Ignores attributes including subtrees contained </span>
<span class="sd">                    in the list. ::</span>

<span class="sd">                       ignore := [&lt;list-of-rfc6901-path-items&gt;]</span>

<span class="sd">                **map**:</span>
<span class="sd">                    Sets the default behavior for the mapping of</span>
<span class="sd">                    branches by operators. This is also influenced </span>
<span class="sd">                    by the parameter &#39;op_depth&#39;. ::</span>

<span class="sd">                      B_AND:  replace corresponding leafs only when any target node is present</span>
<span class="sd">                      B_OR:   replace corresponding items of source leafs</span>
<span class="sd">                      B_XOR:  insert only when no target node is present</span>

<span class="sd">                    default:= B_OR</span>

<span class="sd">                **use**:</span>
<span class="sd">                    Considers the listed attributes only as white list. ::</span>

<span class="sd">                       use := [&lt;list-of-rfc6901-path-items&gt;]</span>

<span class="sd">        Returns:</span>
<span class="sd">            *True* for success, else *False* or raises exception.</span>

<span class="sd">        Raises:</span>
<span class="sd">            JSONDataError</span>

<span class="sd">            JSONDataIndexError</span>
<span class="sd">            </span>
<span class="sd">            pass-through</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># defaults</span>
        <span class="n">_cp</span> <span class="o">=</span> <span class="n">C_REF</span>
        <span class="n">_ign</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op_ignore</span>
        <span class="n">_use</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op_use</span>
        <span class="n">_dep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op_depth</span>

        <span class="n">_mp</span> <span class="o">=</span> <span class="n">B_OR</span>

        <span class="k">def</span> <span class="nf">_map</span><span class="p">(</span><span class="n">d0</span><span class="p">,</span> <span class="n">s0</span><span class="p">,</span> <span class="n">v0</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;The core algorithm for the mapping of branches of Python</span>
<span class="sd">            structures by constraints. Includes resulting logic operations</span>
<span class="sd">            from constraints.</span>
<span class="sd">        </span>
<span class="sd">            The code tends to be monolithic, but saves memory and performance.</span>
<span class="sd">        </span>
<span class="sd">            Args:</span>
<span class="sd">                d0:</span>
<span class="sd">                    Data root.</span>
<span class="sd">        </span>
<span class="sd">                s0:</span>
<span class="sd">                    Key or index for hook.</span>
<span class="sd">        </span>
<span class="sd">                v0:</span>
<span class="sd">                    Value/branch to be hooked.</span>
<span class="sd">        </span>
<span class="sd">            Environment:</span>
<span class="sd">                Uses inherited variables from parent</span>
<span class="sd">                name spaces.</span>
<span class="sd">        </span>
<span class="sd">            Returns:</span>
<span class="sd">        </span>
<span class="sd">            Raises:</span>
<span class="sd">        </span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">op_ignore</span> <span class="ow">and</span> <span class="n">s0</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">op_ignore</span><span class="p">:</span>  <span class="c1"># blacklist</span>
                <span class="k">return</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">op_use</span> <span class="ow">and</span> <span class="n">s0</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">op_use</span><span class="p">:</span>  <span class="c1"># white list</span>
                <span class="k">return</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">op_depth</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">n</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">op_depth</span><span class="p">:</span>  <span class="c1"># depth</span>
                <span class="k">return</span>
            <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
            
            <span class="k">if</span> <span class="n">s0</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">dx</span> <span class="o">=</span> <span class="n">d0</span>
                    <span class="n">d0</span> <span class="o">=</span> <span class="n">d0</span><span class="p">[</span><span class="n">s0</span><span class="p">]</span>
                <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">s0</span> <span class="o">==</span> <span class="s1">&#39;-&#39;</span><span class="p">:</span>
                        <span class="n">d0</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v0</span><span class="p">)</span>
                        <span class="k">return</span> <span class="kc">True</span>
                    <span class="k">raise</span>
                <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                    <span class="n">d0</span><span class="p">[</span><span class="n">s0</span><span class="p">]</span> <span class="o">=</span> <span class="n">v0</span>
                    <span class="k">return</span> <span class="kc">True</span>
                <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">d0</span><span class="p">)</span> <span class="o">==</span> <span class="n">s0</span><span class="p">:</span>
                        <span class="n">d0</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v0</span><span class="p">)</span>
                        <span class="k">return</span> <span class="kc">True</span>
                    <span class="k">raise</span> <span class="n">JSONDataIndexError</span><span class="p">(</span><span class="s2">&quot;out of range(&gt;</span><span class="si">%s</span><span class="s2">): </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">d0</span><span class="p">)),</span> <span class="nb">str</span><span class="p">(</span><span class="n">s0</span><span class="p">)))</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">dx</span> <span class="o">=</span> <span class="n">d0</span>

            <span class="k">if</span> <span class="n">_mp</span> <span class="ow">in</span> <span class="p">(</span><span class="n">B_OR</span><span class="p">,):</span>  <span class="c1"># add all items</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">d0</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">v0</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">v0</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                            <span class="n">_map</span><span class="p">(</span><span class="n">d0</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">s0</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">dx</span><span class="p">[</span><span class="n">s0</span><span class="p">]</span> <span class="o">=</span> <span class="n">v0</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">dx</span> <span class="o">=</span> <span class="n">v0</span>

                <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">d0</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">v0</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">v0</span><span class="p">)):</span>
                            <span class="n">_map</span><span class="p">(</span><span class="n">d0</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v0</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">s0</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">s0</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">dx</span><span class="p">):</span>
                                <span class="n">dx</span><span class="p">[</span><span class="n">s0</span><span class="p">]</span> <span class="o">=</span> <span class="n">v0</span>
                            <span class="k">elif</span> <span class="n">s0</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">dx</span><span class="p">):</span>
                                <span class="n">dx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v0</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="k">raise</span> <span class="n">JSONDataIndexError</span><span class="p">(</span><span class="s2">&quot;out of range(&gt;</span><span class="si">%s</span><span class="s2">): </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dx</span><span class="p">)),</span> <span class="nb">str</span><span class="p">(</span><span class="n">s0</span><span class="p">)))</span>
                        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">s0</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ISSTR</span><span class="p">:</span>
                            <span class="n">dx</span><span class="p">[</span><span class="n">s0</span><span class="p">]</span> <span class="o">=</span> <span class="n">v0</span>
                        <span class="k">return</span> <span class="kc">True</span>
    
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">dx</span><span class="p">[</span><span class="n">s0</span><span class="p">]</span> <span class="o">=</span> <span class="n">v0</span>

            <span class="k">elif</span> <span class="n">_mp</span> <span class="ow">in</span> <span class="p">(</span><span class="n">B_XOR</span><span class="p">,</span> <span class="p">):</span>  <span class="c1"># add non-present items</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">d0</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">d0</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">s0</span><span class="p">):</span>
                        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">v0</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">v0</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                                <span class="n">_map</span><span class="p">(</span><span class="n">d0</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                        <span class="k">elif</span> <span class="n">s0</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                            <span class="k">pass</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">d0</span><span class="p">[</span><span class="n">s0</span><span class="p">]</span> <span class="o">=</span> <span class="n">v0</span>

                <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">d0</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">v0</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">v0</span><span class="p">)):</span>
                            <span class="n">_map</span><span class="p">(</span><span class="n">d0</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v0</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">dx</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">dx</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">s0</span><span class="p">):</span>
                                <span class="n">dx</span><span class="p">[</span><span class="n">s0</span><span class="p">]</span> <span class="o">=</span> <span class="n">v0</span>
                        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">dx</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dx</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">s0</span><span class="p">:</span>
                                <span class="n">dx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v0</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="c1"># cannot return a result assigned to a non-container</span>
                            <span class="k">raise</span> <span class="n">JSONDataError</span><span class="p">(</span><span class="s2">&quot;internal error&quot;</span><span class="p">)</span>
                        <span class="k">return</span> <span class="kc">True</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">dx</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">dx</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">s0</span><span class="p">):</span>
                            <span class="n">dx</span><span class="p">[</span><span class="n">s0</span><span class="p">]</span> <span class="o">=</span> <span class="n">v0</span>
                    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">dx</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dx</span><span class="p">)</span> <span class="o">==</span> <span class="n">s0</span><span class="p">:</span>
                            <span class="n">dx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v0</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># cannot return a result assigned to a non-container</span>
                        <span class="k">raise</span> <span class="n">JSONDataError</span><span class="p">(</span><span class="s2">&quot;internal error&quot;</span><span class="p">)</span>

            <span class="k">elif</span> <span class="n">_mp</span> <span class="ow">in</span> <span class="p">(</span><span class="n">B_AND</span><span class="p">,</span> <span class="p">):</span>  <span class="c1"># add present items</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">d0</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">d0</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">s0</span><span class="p">):</span>
                        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">v0</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                            <span class="k">if</span> <span class="n">d0</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">k</span><span class="p">):</span>
                                <span class="n">_map</span><span class="p">(</span><span class="n">d0</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

                <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">d0</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>

                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">v0</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">v0</span><span class="p">)):</span>
                            <span class="k">if</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">d0</span><span class="p">):</span>
                                <span class="n">_map</span><span class="p">(</span><span class="n">d0</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v0</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">dx</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">dx</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">s0</span><span class="p">):</span>
                                <span class="n">dx</span><span class="p">[</span><span class="n">s0</span><span class="p">]</span> <span class="o">=</span> <span class="n">v0</span>
                        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">dx</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">dx</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">s0</span><span class="p">:</span>
                                <span class="n">dx</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v0</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="c1"># cannot return a result assigned to a non-container</span>
                            <span class="k">raise</span> <span class="n">JSONDataError</span><span class="p">(</span><span class="s2">&quot;internal error&quot;</span><span class="p">)</span>
                        <span class="k">return</span> <span class="kc">True</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">dx</span><span class="p">[</span><span class="n">s0</span><span class="p">]</span> <span class="o">=</span> <span class="n">v0</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">return</span> <span class="kc">True</span>


        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;copy&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">(</span>
                        <span class="s1">&#39;deep&#39;</span><span class="p">,</span>
                        <span class="n">C_DEEP</span><span class="p">,</span> <span class="p">):</span>
                    <span class="n">_cp</span> <span class="o">=</span> <span class="n">C_DEEP</span>

                <span class="k">elif</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">(</span>
                        <span class="s1">&#39;shallow&#39;</span><span class="p">,</span>
                        <span class="n">C_SHALLOW</span><span class="p">,</span> <span class="p">):</span>
                    <span class="n">_cp</span> <span class="o">=</span> <span class="n">C_SHALLOW</span>

                <span class="k">elif</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">(</span>
                        <span class="s1">&#39;ref&#39;</span><span class="p">,</span>
                        <span class="n">C_REF</span><span class="p">,</span> <span class="p">):</span>
                    <span class="n">_cp</span> <span class="o">=</span> <span class="n">C_REF</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">JSONDataError</span><span class="p">(</span><span class="s2">&quot;Unknown copy-type:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>

            <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;ignore&#39;</span><span class="p">:</span>
                <span class="n">_ign</span> <span class="o">=</span> <span class="n">v</span>

            <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;use&#39;</span><span class="p">:</span>
                <span class="n">_use</span> <span class="o">=</span> <span class="n">v</span>

            <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;depth&#39;</span><span class="p">:</span>
                <span class="n">_dep</span> <span class="o">=</span> <span class="n">v</span>

            <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;map&#39;</span><span class="p">:</span>

                <span class="k">if</span> <span class="n">v</span> <span class="ow">in</span> <span class="p">(</span>
                        <span class="n">B_AND</span><span class="p">,</span>
                        <span class="n">B_OR</span><span class="p">,</span>
                        <span class="n">B_XOR</span><span class="p">,</span>
                        <span class="p">):</span>
                    <span class="n">_mp</span> <span class="o">=</span> <span class="n">v</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">JSONDataError</span><span class="p">(</span><span class="s2">&quot;Unknown map:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">targetnode</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># use default</span>
            <span class="n">targetnode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span>

        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">targetnode</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span> <span class="ow">and</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">key</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,))</span>
            <span class="ow">and</span> <span class="n">key</span> <span class="o">!=</span> <span class="s1">&#39;-&#39;</span>  <span class="c1"># see RFC6901</span>
            <span class="p">):</span>
            <span class="c1"># incompatible index type</span>
            <span class="k">raise</span> <span class="n">JSONDataError</span><span class="p">(</span><span class="s2">&quot;list index mismatch&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">))</span>

        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">targetnode</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="c1"># almost anything permitted</span>
            <span class="k">pass</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">targetnode</span><span class="p">,</span> <span class="n">JSONPointer</span><span class="p">):</span>
            <span class="c1"># pointer object, tranfrom to a node</span>
            <span class="n">targetnode</span> <span class="o">=</span> <span class="n">targetnode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">targetnode</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ISSTR</span><span class="p">:</span>
            <span class="c1"># assume a pointer string, tranfrom to a node</span>
            <span class="n">targetnode</span> <span class="o">=</span> <span class="n">JSONPointer</span><span class="p">(</span><span class="n">targetnode</span><span class="p">)(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

        <span class="c1">#</span>
        <span class="c1"># special: document root-changes by non-container for RFC7159</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span>
                <span class="nb">type</span><span class="p">(</span><span class="n">sourcenode</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span>
                <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">sourcenode</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">type</span><span class="p">(</span><span class="n">targetnode</span><span class="p">)</span>
            <span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode_json</span> <span class="o">&amp;</span> <span class="n">MJ_RFC7159</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">sourcenode</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">JSONDataError</span><span class="p">(</span><span class="s2">&quot;basic document types require mode RFC7159: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">sourcenode</span><span class="p">))</span>
                
            <span class="k">if</span> <span class="n">_mp</span> <span class="ow">in</span> <span class="p">(</span>
                    <span class="n">B_OR</span><span class="p">,</span>
                <span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">sourcenode</span>
            <span class="k">elif</span> <span class="n">_mp</span> <span class="ow">in</span> <span class="p">(</span>
                    <span class="n">B_AND</span><span class="p">,</span>
                <span class="p">)</span> <span class="ow">and</span> <span class="p">(</span>
                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="ow">and</span> <span class="n">sourcenode</span><span class="p">)</span>
                    <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">sourcenode</span> <span class="o">==</span> <span class="kc">None</span><span class="p">)</span>
                    <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">sourcenode</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">)</span>
                <span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">sourcenode</span>
            <span class="k">elif</span> <span class="n">_mp</span> <span class="ow">in</span> <span class="p">(</span>
                    <span class="n">B_XOR</span><span class="p">,</span>
                <span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span>
                    <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="ow">and</span> <span class="n">sourcenode</span><span class="p">)</span>
                    <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">==</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">sourcenode</span> <span class="o">==</span> <span class="kc">None</span><span class="p">)</span>
                    <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">!=</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">sourcenode</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">)</span>
                <span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">sourcenode</span>

            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="n">_cp</span> <span class="ow">is</span> <span class="n">C_DEEP</span><span class="p">:</span>
            <span class="n">_dat</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">targetnode</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">_cp</span> <span class="ow">is</span> <span class="n">C_REF</span><span class="p">:</span>
            <span class="n">_dat</span> <span class="o">=</span> <span class="n">targetnode</span>

        <span class="k">elif</span> <span class="n">_cp</span> <span class="ow">is</span> <span class="n">C_SHALLOW</span><span class="p">:</span>
            <span class="n">_dat</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">targetnode</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">_mp</span> <span class="ow">in</span> <span class="p">(</span>
                <span class="n">B_OR</span><span class="p">,</span>
                <span class="n">B_XOR</span><span class="p">,</span>
                <span class="n">B_AND</span><span class="p">,</span> <span class="p">):</span>
            <span class="n">_map</span><span class="p">(</span><span class="n">_dat</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">sourcenode</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="JSONData.branch_test"><a class="viewcode-back" href="../../jsondata_jsondata_doc.html#jsondata.jsondata.JSONData.branch_test">[docs]</a>    <span class="k">def</span> <span class="nf">branch_test</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">targetnode</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Tests match in accordance to RFC6902.</span>

<span class="sd">        Args:</span>
<span class="sd">            **targetnode**:</span>
<span class="sd">                Node to be compared with the value. Due to</span>
<span class="sd">                ambiguity the automated conversion is not</span>
<span class="sd">                reliable, thus it has to be valid. ::</span>

<span class="sd">                  targetnode := &lt;innode&gt;       # see class header</span>

<span class="sd">            **value**:</span>
<span class="sd">                Expected value for the given node.</span>

<span class="sd">        Returns:</span>
<span class="sd">            When successful returns &#39;True&#39;, else returns &#39;False&#39;.</span>

<span class="sd">        Raises:</span>
<span class="sd">            JSONDataError</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">targetnode</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">value</span><span class="p">:</span>  <span class="c1"># all None is equal,</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">targetnode</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ISSTR</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">JSONPointer</span><span class="p">(</span><span class="n">targetnode</span><span class="p">)</span><span class="o">.</span><span class="n">get_node_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="n">value</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">targetnode</span><span class="p">,</span> <span class="n">JSONPointer</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">targetnode</span><span class="o">.</span><span class="n">get_node_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="n">value</span></div>

<div class="viewcode-block" id="JSONData.get_data"><a class="viewcode-back" href="../../jsondata_jsondata_doc.html#jsondata.jsondata.JSONData.get_data">[docs]</a>    <span class="k">def</span> <span class="nf">get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the reference to data.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span></div>

<div class="viewcode-block" id="JSONData.get_schema"><a class="viewcode-back" href="../../jsondata_jsondata_doc.html#jsondata.jsondata.JSONData.get_schema">[docs]</a>    <span class="k">def</span> <span class="nf">get_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the reference to schema.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span></div>

<div class="viewcode-block" id="JSONData.clear"><a class="viewcode-back" href="../../jsondata_jsondata_doc.html#jsondata.jsondata.JSONData.clear">[docs]</a>    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Clears the contained data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="JSONData.copy"><a class="viewcode-back" href="../../jsondata_jsondata_doc.html#jsondata.jsondata.JSONData.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates a shallow copy of self.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">JSONData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">copydata</span><span class="o">=</span><span class="n">C_SHALLOW</span><span class="p">)</span></div>

<div class="viewcode-block" id="JSONData.deepcopy"><a class="viewcode-back" href="../../jsondata_jsondata_doc.html#jsondata.jsondata.JSONData.deepcopy">[docs]</a>    <span class="k">def</span> <span class="nf">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates a deep copy of self, including referenced data.</span>
<span class="sd">        The schema is kept as a shared reference.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">JSONData</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">copydata</span><span class="o">=</span><span class="n">C_DEEP</span><span class="p">)</span></div>

<div class="viewcode-block" id="JSONData.get"><a class="viewcode-back" href="../../jsondata_jsondata_doc.html#jsondata.jsondata.JSONData.get">[docs]</a>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Transparently passes the &#39;get()&#39; call to &#39;self.data&#39;.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">default</span><span class="p">)</span></div>

<div class="viewcode-block" id="JSONData.get_canonical_value"><a class="viewcode-back" href="../../jsondata_jsondata_doc.html#jsondata.jsondata.JSONData.get_canonical_value">[docs]</a>    <span class="k">def</span> <span class="nf">get_canonical_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Fetches a copy of the canonical value represented by</span>
<span class="sd">        the node. The actual value could be either an atomic value,</span>
<span class="sd">        a node representing a branch, or a reference to</span>
<span class="sd">        an atomic value.</span>
<span class="sd">        Creates a deep copy, thus references are no longer</span>
<span class="sd">        valid.</span>

<span class="sd">        Args:</span>
<span class="sd">            **value**:</span>
<span class="sd">                Value pointer to be evaluated to the actual</span>
<span class="sd">                value. Valid input types are:</span>

<span class="sd">                    int,str,unicode:</span>
<span class="sd">                        Integer, kept as an atomic integer</span>
<span class="sd">                        value.</span>

<span class="sd">                    dict,list:</span>
<span class="sd">                        Assumed to be a valid node for &#39;json&#39;</span>
<span class="sd">                        package, used by reference.</span>

<span class="sd">                    JSONPointer:</span>
<span class="sd">                        A JSON pointer in accordance to</span>
<span class="sd">                        RFC6901.</span>

<span class="sd">        Returns:</span>
<span class="sd">            When successful returns the value, else returns</span>
<span class="sd">            either &#39;False&#39;, or raises an exception.</span>

<span class="sd">        Raises:</span>
<span class="sd">            JSONDataError</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>  <span class="c1"># assumes a &#39;json&#39; package type node</span>
            <span class="k">return</span> <span class="n">node</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span>
                <span class="nb">int</span><span class="p">,</span>
                <span class="nb">float</span><span class="p">,</span> <span class="p">):</span>  <span class="c1"># assume a &#39;JSON&#39; RFC7159 int, float</span>
            <span class="k">return</span> <span class="n">node</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span>
                <span class="nb">str</span><span class="p">,</span>
                <span class="n">unicode</span><span class="p">,</span> <span class="p">):</span>  <span class="c1"># assume a &#39;JSON&#39; RFC7159 string</span>
            <span class="k">return</span> <span class="n">unicode</span><span class="p">(</span><span class="n">node</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">JSONPointer</span><span class="p">):</span>  <span class="c1"># assume the pointed value</span>
            <span class="k">return</span> <span class="n">node</span><span class="o">.</span><span class="n">get_node_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">C_DEEP</span><span class="p">)</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">node</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">JSONDataError</span><span class="p">(</span><span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">node</span><span class="p">))</span></div>

<div class="viewcode-block" id="JSONData.pop"><a class="viewcode-back" href="../../jsondata_jsondata_doc.html#jsondata.jsondata.JSONData.pop">[docs]</a>    <span class="k">def</span> <span class="nf">pop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Transparently passes the &#39;pop()&#39; call to &#39;self.data&#39;.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">key</span><span class="p">)</span></div>

<div class="viewcode-block" id="JSONData.dump_data"><a class="viewcode-back" href="../../jsondata_jsondata_doc.html#jsondata.jsondata.JSONData.dump_data">[docs]</a>    <span class="k">def</span> <span class="nf">dump_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pretty</span><span class="o">=</span><span class="n">PJ_TREE</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Prints structured data.</span>

<span class="sd">        Args:</span>

<span class="sd">            **pretty**:</span>
<span class="sd">                Activates pretty printer, else flat. ::</span>

<span class="sd">                   format := (</span>
<span class="sd">                        PJ_TREE    # tree view JSON syntax</span>
<span class="sd">                      | PJ_FLAT    # flat print JSON syntax</span>
<span class="sd">                      | PJ_PYTREE  # tree view Python syntax</span>
<span class="sd">                      | PJ_PYFLAT  # flat print Python syntax</span>
<span class="sd">                      | PJ_REPR    # repr() - raw string, Python syntax</span>
<span class="sd">                      | PJ_STR     # str() - formatted string, Python syntax</span>
<span class="sd">                   )</span>

<span class="sd">            kargs:</span>
<span class="sd">                **source**:</span>
<span class="sd">                    Prints data within &#39;source&#39;.</span>

<span class="sd">                    default:=self.data</span>

<span class="sd">        Returns:</span>
<span class="sd">            When successful returns &#39;True&#39;, else returns either</span>
<span class="sd">            &#39;False&#39;, or raises an exception.</span>

<span class="sd">        Raises:</span>
<span class="sd">            pass-through</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">source</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;source&#39;</span><span class="p">,</span> <span class="n">source</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">pretty</span> <span class="o">==</span> <span class="n">PJ_TREE</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">myjson</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">indent</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">pretty</span> <span class="o">==</span> <span class="n">PJ_FLAT</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">myjson</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">source</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">pretty</span> <span class="o">==</span> <span class="n">PJ_PYTREE</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">myjson</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">indent</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">pretty</span> <span class="o">==</span> <span class="n">PJ_PYFLAT</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">source</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">pretty</span> <span class="o">==</span> <span class="n">PJ_REPR</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">source</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">pretty</span> <span class="o">==</span> <span class="n">PJ_STR</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">source</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">myjson</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">indent</span><span class="p">))</span></div>


<div class="viewcode-block" id="JSONData.dump_schema"><a class="viewcode-back" href="../../jsondata_jsondata_doc.html#jsondata.jsondata.JSONData.dump_schema">[docs]</a>    <span class="k">def</span> <span class="nf">dump_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pretty</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Prints structured schema.</span>

<span class="sd">        Args:</span>

<span class="sd">            **pretty**:</span>
<span class="sd">                Activates pretty printer for treeview,</span>
<span class="sd">                else flat.</span>

<span class="sd">            kargs:</span>
<span class="sd">                **source**:</span>
<span class="sd">                    Prints schema within &#39;source&#39;.</span>

<span class="sd">                    default:=self.schema</span>

<span class="sd">        Returns:</span>
<span class="sd">            When successful returns &#39;True&#39;, else returns</span>
<span class="sd">            either &#39;False&#39;, or raises an exception.</span>

<span class="sd">        Raises:</span>
<span class="sd">            pass-through</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">source</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;source&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">pretty</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">myjson</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">indent</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">myjson</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">source</span><span class="p">))</span></div>

<div class="viewcode-block" id="JSONData.set_schema"><a class="viewcode-back" href="../../jsondata_jsondata_doc.html#jsondata.jsondata.JSONData.set_schema">[docs]</a>    <span class="k">def</span> <span class="nf">set_schema</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">schemafile</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">targetnode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets schema or inserts a new branch into the current</span>
<span class="sd">        assigned schema.</span>

<span class="sd">        The main schema(targetnode==None) is the schema related</span>
<span class="sd">        to the current instance. Additional branches could be added</span>
<span class="sd">        by importing the specific schema definitions into the main</span>
<span class="sd">        schema. These could either kept volatile as a temporary</span>
<span class="sd">        runtime extension, or stored into a new schema file in order</span>
<span class="sd">        as extension of the original for later combined reuse.</span>

<span class="sd">        Args:</span>
<span class="sd">            **schemafile**:</span>
<span class="sd">                JSON-Schema filename for validation of the</span>
<span class="sd">                subtree/branch. See also **kargs[&#39;schema&#39;].</span>

<span class="sd">            **targetnode**:</span>
<span class="sd">                Target container hook for the inclusion of</span>
<span class="sd">                the loaded branch.</span>

<span class="sd">            kargs:</span>
<span class="sd">                **schema**:</span>
<span class="sd">                    In-memory JSON-Schema as an alternative</span>
<span class="sd">                    to schemafile. When provided the &#39;schemafile&#39;</span>
<span class="sd">                    is ignored.</span>

<span class="sd">                    default:=None</span>

<span class="sd">                **validator**:</span>
<span class="sd">                    Sets schema validator for the data file.</span>
<span class="sd">                    The values are: ::</span>

<span class="sd">                       validator := (</span>
<span class="sd">                            default = validate,</span>
<span class="sd">                          | draft3  = Draft3Validator,</span>
<span class="sd">                          | off     = None.</span>
<span class="sd">                       )</span>

<span class="sd">                    default:= validate</span>

<span class="sd">                **persistent**:</span>
<span class="sd">                    Stores the &#39;schema&#39; persistently into &#39;schemafile&#39;</span>
<span class="sd">                    after completion of update including addition of</span>
<span class="sd">                    branches. Requires valid &#39;schemafile&#39;.</span>

<span class="sd">                    default:=False</span>

<span class="sd">        Returns:</span>
<span class="sd">            When successful returns &#39;True&#39;, else returns either</span>
<span class="sd">            &#39;False&#39;, or raises an exception.</span>

<span class="sd">        Raises:</span>

<span class="sd">            JSONDataError</span>

<span class="sd">            JSONDataSourceFileError</span>

<span class="sd">            JSONDataValueError</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DBG:set_schema:schemafile=&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">schemafile</span><span class="p">))</span>

        <span class="c1">#</span>
        <span class="c1">#*** Fetch parameters</span>
        <span class="c1">#</span>
        <span class="n">persistent</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">schema</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">kargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;validator&#39;</span><span class="p">:</span>  <span class="c1"># controls validation by JSONschema</span>
                <span class="k">if</span> <span class="n">v</span> <span class="o">==</span> <span class="s1">&#39;default&#39;</span> <span class="ow">or</span> <span class="n">v</span> <span class="o">==</span> <span class="n">MS_DRAFT4</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">validator</span> <span class="o">=</span> <span class="n">MS_DRAFT4</span>
                <span class="k">elif</span> <span class="n">v</span> <span class="o">==</span> <span class="s1">&#39;draft3&#39;</span> <span class="ow">or</span> <span class="n">v</span> <span class="o">==</span> <span class="n">MS_DRAFT3</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">validator</span> <span class="o">=</span> <span class="n">MS_DRAFT3</span>
                <span class="k">elif</span> <span class="n">v</span> <span class="o">==</span> <span class="s1">&#39;off&#39;</span> <span class="ow">or</span> <span class="n">v</span> <span class="o">==</span> <span class="n">MS_OFF</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">validator</span> <span class="o">=</span> <span class="n">MS_OFF</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">JSONDataValueError</span><span class="p">(</span><span class="s2">&quot;unknown&quot;</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;schema&#39;</span><span class="p">:</span>
                <span class="n">schema</span> <span class="o">=</span> <span class="n">v</span>
            <span class="k">elif</span> <span class="n">k</span> <span class="o">==</span> <span class="s1">&#39;persistent&#39;</span><span class="p">:</span>
                <span class="n">persistent</span> <span class="o">=</span> <span class="n">v</span>

        <span class="k">if</span> <span class="n">schemafile</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># change filename</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">schemafile</span> <span class="o">=</span> <span class="n">schemafile</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">schemafile</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># use present</span>
            <span class="n">schemafile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">schemafile</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">schemafile</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">persistent</span><span class="p">:</span>  <span class="c1"># persistence requires storage</span>
                <span class="k">raise</span> <span class="n">JSONDataTargetFileError</span><span class="p">(</span><span class="s2">&quot;open&quot;</span><span class="p">,</span> <span class="s2">&quot;JSONSchemaFilename&quot;</span><span class="p">,</span>
                                         <span class="n">schemafile</span><span class="p">)</span>

        <span class="c1"># schema for validation</span>
        <span class="k">if</span> <span class="n">schema</span><span class="p">:</span>  <span class="c1"># use loaded</span>
            <span class="k">pass</span>

        <span class="k">elif</span> <span class="n">schemafile</span><span class="p">:</span>  <span class="c1"># load from file</span>
            <span class="n">schemafile</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">schemafile</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">schemafile</span> <span class="o">=</span> <span class="n">schemafile</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">schemafile</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">JSONDataSourceFileError</span><span class="p">(</span><span class="s2">&quot;open&quot;</span><span class="p">,</span> <span class="s2">&quot;schemafile&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">schemafile</span><span class="p">))</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">schemafile</span><span class="p">)</span> <span class="k">as</span> <span class="n">schema_file</span><span class="p">:</span>
                <span class="n">schema</span> <span class="o">=</span> <span class="n">myjson</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">schema_file</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">schema</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">JSONDataSourceFileError</span><span class="p">(</span><span class="s2">&quot;read&quot;</span><span class="p">,</span> <span class="s2">&quot;schemafile&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">schemafile</span><span class="p">))</span>

        <span class="k">else</span><span class="p">:</span>  <span class="c1"># missing at all</span>
            <span class="k">raise</span> <span class="n">JSONDataSourceFileError</span><span class="p">(</span><span class="s2">&quot;open&quot;</span><span class="p">,</span> <span class="s2">&quot;schemafile&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">schemafile</span><span class="p">))</span>

        <span class="c1">#</span>
        <span class="c1"># manage new branch data</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">targetnode</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">schema</span> <span class="o">=</span> <span class="n">schema</span>

        <span class="k">else</span><span class="p">:</span>  <span class="c1"># data history present, so decide how to handle</span>

            <span class="c1"># the container hook has to match for insertion-</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">targetnode</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">type</span><span class="p">(</span><span class="n">schema</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">JSONDataError</span><span class="p">(</span>
                    <span class="s2">&quot;type&quot;</span><span class="p">,</span> <span class="s2">&quot;target!=branch&quot;</span><span class="p">,</span>
                    <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">targetnode</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;!=&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">schema</span><span class="p">)))</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">branch_add</span><span class="p">(</span><span class="n">targetnode</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">schema</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">schema</span> <span class="o">!=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="JSONData.validate"><a class="viewcode-back" href="../../jsondata_jsondata_doc.html#jsondata.jsondata.JSONData.validate">[docs]</a>    <span class="k">def</span> <span class="nf">validate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">schema</span><span class="p">,</span> <span class="n">validator</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Validate data with schema by selected validator.</span>

<span class="sd">        Args:</span>

<span class="sd">            **data**:</span>
<span class="sd">                JSON-Data.</span>

<span class="sd">            **schema**:</span>
<span class="sd">                JSON-Schema for validation.</span>

<span class="sd">            **validator**:</span>
<span class="sd">                Validator to be applied, current supported:</span>

<span class="sd">                    schema:</span>

<span class="sd">                        In-memory JSON-Schema as an alternative</span>
<span class="sd">                        to schemafile. When provided the &#39;schemafile&#39;</span>
<span class="sd">                        is ignored.</span>

<span class="sd">                        default:=None</span>

<span class="sd">                **validator**: [default, draft3, draft4, off, on, ]</span>
<span class="sd">                    Sets schema validator for the data file.</span>

<span class="sd">                        default|MS_ON:</span>
<span class="sd">                            The current default.</span>

<span class="sd">                        draft3|MS_DRAFT3:</span>
<span class="sd">                            The first supported JSONSchema IETF-Draft.</span>

<span class="sd">                        draft4|MS_DRAFT4:</span>
<span class="sd">                            The current supported JSONSchema IETF-Draft.</span>

<span class="sd">                        off|MS_OFF:</span>
<span class="sd">                            No validation.</span>

<span class="sd">                    default:= MS_DRAFT4</span>

<span class="sd">        Returns:</span>
<span class="sd">            When successful returns &#39;True&#39;, else returns</span>
<span class="sd">            either &#39;False&#39;, or raises an exception.</span>

<span class="sd">        Raises:</span>

<span class="sd">            JSONDataValidationError</span>

<span class="sd">            JSONDataSchemaError</span>

<span class="sd">            JSONDataValueError</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">validator</span><span class="p">:</span>
            <span class="n">validator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode_schema</span>

        <span class="k">if</span> <span class="n">validator</span> <span class="o">==</span> <span class="n">MS_DRAFT4</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;VERB:Validate: draft4&quot;</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">jsonschema</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">schema</span><span class="p">)</span>

            <span class="k">except</span> <span class="n">JSONDataValidationError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ValidationError&quot;</span>
                      <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                      <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">#---&quot;</span>
                      <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">dir</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                      <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">#---&quot;</span>
                      <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                      <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">#---&quot;</span>
                      <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                      <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">#---&quot;</span>
                      <span class="p">)</span>
                <span class="k">raise</span>

            <span class="k">except</span> <span class="n">JSONDataSchemaError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;SchemaError&quot;</span>
                      <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                      <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">#---&quot;</span>
                      <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">dir</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                      <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">#---&quot;</span>
                      <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                      <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">#---&quot;</span>
                      <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                      <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">#---&quot;</span>
                      <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;path:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
                      <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;schema_path:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">schema_path</span><span class="p">)</span>
                      <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">#---&quot;</span>
                      <span class="p">)</span>
                <span class="k">raise</span>

        <span class="k">elif</span> <span class="n">validator</span> <span class="o">==</span> <span class="n">MS_DRAFT3</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;VERB:Validate: draft3&quot;</span><span class="p">)</span>
            <span class="n">jsonschema</span><span class="o">.</span><span class="n">Draft3Validator</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">schema</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">validator</span> <span class="o">!=</span> <span class="n">MS_OFF</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">JSONDataValueError</span><span class="p">(</span><span class="s2">&quot;unknown&quot;</span><span class="p">,</span> <span class="s2">&quot;validator&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">validator</span><span class="p">))</span></div></div>


<span class="kn">from</span> <span class="nn">jsondata.jsonpointer</span> <span class="k">import</span> <span class="n">JSONPointer</span>
<span class="c1"># avoid nested recursion problems</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/jsondata-64x64.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">jsondata 0.2.22 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="../jsondata.html" >jsondata</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2018, Arno-Can Uestuensoez.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.5.
    </div>
  </body>
</html>