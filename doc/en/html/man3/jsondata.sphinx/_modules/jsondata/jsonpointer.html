<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>jsondata.jsonpointer &mdash; jsondata 0.2.22 documentation</title>
    
    <link rel="stylesheet" href="../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.2.22',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="jsondata 0.2.22 documentation" href="../../index.html" />
    <link rel="up" title="jsondata" href="../jsondata.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">jsondata 0.2.22 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="../jsondata.html" accesskey="U">jsondata</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for jsondata.jsonpointer</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding:utf-8   -*-</span>
<span class="sd">&quot;&quot;&quot;Provides classes for the JSONPointer definition in</span>
<span class="sd">accordance to RFC6901 and relative pointers draft-1/2018.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">absolute_import</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">print_function</span>

<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">copy</span>

<span class="kn">from</span> <span class="nn">jsondata</span> <span class="k">import</span> <span class="n">V3K</span><span class="p">,</span> <span class="n">ISSTR</span><span class="p">,</span> <span class="n">JSONPointerError</span><span class="p">,</span> <span class="n">JSONPointerTypeError</span><span class="p">,</span> \
    <span class="n">C_SHALLOW</span><span class="p">,</span> <span class="n">C_DEEP</span><span class="p">,</span> \
    <span class="n">M_FIRST</span><span class="p">,</span> <span class="n">M_LAST</span><span class="p">,</span> \
    <span class="n">rtypes2num</span><span class="p">,</span> <span class="n">RT_LST</span><span class="p">,</span> <span class="n">RT_JSONPOINTER</span><span class="p">,</span> \
    <span class="n">verify2num</span><span class="p">,</span> <span class="n">V_FINAL</span><span class="p">,</span> <span class="n">V_STEPS</span>


<span class="n">__author__</span> <span class="o">=</span> <span class="s1">&#39;Arno-Can Uestuensoez&#39;</span>
<span class="n">__maintainer__</span> <span class="o">=</span> <span class="s1">&#39;Arno-Can Uestuensoez&#39;</span>
<span class="n">__license__</span> <span class="o">=</span> <span class="s2">&quot;Artistic-License-2.0 + Forced-Fairplay-Constraints&quot;</span>
<span class="n">__copyright__</span> <span class="o">=</span> <span class="s2">&quot;Copyright (C) 2015-2016 Arno-Can Uestuensoez&quot;</span> \
                <span class="s2">&quot; @Ingenieurbuero Arno-Can Uestuensoez&quot;</span>
<span class="n">__version__</span> <span class="o">=</span> <span class="s1">&#39;0.2.21&#39;</span>
<span class="n">__uuid__</span> <span class="o">=</span> <span class="s1">&#39;63b597d6-4ada-4880-9f99-f5e0961351fb&#39;</span>

<span class="k">if</span> <span class="n">V3K</span><span class="p">:</span>
    <span class="n">unicode</span> <span class="o">=</span> <span class="nb">str</span>
    <span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="k">import</span> <span class="n">unquote</span> <span class="k">as</span> <span class="n">url_unquote</span>  <span class="c1"># @UnresolvedImport @UnusedImport pylint: disable=import-error</span>
<span class="k">else</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">urllib</span> <span class="k">import</span> <span class="n">unquote</span> <span class="k">as</span> <span class="n">url_unquote</span>  <span class="c1"># @UnresolvedImport  @Reimport pylint: disable=import-error</span>

<span class="c1"># Sets display for inetractive JSON/JSONschema design.</span>
<span class="n">_interactive</span> <span class="o">=</span> <span class="kc">False</span>

<span class="kn">from</span> <span class="nn">jsondata</span> <span class="k">import</span> <span class="n">NOTATION_JSON</span><span class="p">,</span> <span class="n">NOTATION_JSON_REL</span><span class="p">,</span> <span class="n">NOTATION_HTTP_FRAGMENT</span>

<span class="n">VALID_NODE_TYPE</span> <span class="o">=</span> <span class="p">(</span>
    <span class="nb">dict</span><span class="p">,</span>
    <span class="nb">list</span><span class="p">,</span>
    <span class="nb">str</span><span class="p">,</span>
    <span class="n">unicode</span><span class="p">,</span>
    <span class="nb">int</span><span class="p">,</span>
    <span class="nb">float</span><span class="p">,</span>
    <span class="nb">bool</span><span class="p">,</span>
    <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span>  <span class="c1">#: Valid types of in-memory JSON node types.</span>

<span class="n">CHARSET_UTF</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1">#: Unicode.</span>
<span class="n">CHARSET_STR</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1">#: Python string.</span>

<span class="c1">#</span>
<span class="c1"># relative JSON Pointer - [RELPOINTER] draft-handrews-relative-json-pointer-01</span>
<span class="c1">#</span>
<span class="c1"># 1: integer offset</span>
<span class="c1">#    and 3:  fetch key</span>
<span class="c1">#    and 4:  fetch node @relpath</span>
<span class="c1">#    and 5:  offset only - top document</span>
<span class="c1">#</span>
<span class="c1"># else: error</span>
<span class="c1">#</span>
<span class="k">if</span> <span class="n">V3K</span><span class="p">:</span>
    <span class="n">_RELPOINTER</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s2">r&quot;(0|[1-9][0-9]*)(([#]$)|(/.*$)|($))&quot;</span><span class="p">)</span>  <span class="c1"># 1 +(3 | 4 | 5)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">_RELPOINTER</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">unicode</span><span class="p">(</span><span class="s2">r&quot;(0|[1-9][0-9]*)(([#]$)|(/.*$)|($))&quot;</span><span class="p">))</span>  <span class="c1"># 1 +(3 | 4 | 5)</span>

<span class="c1">#: Unescaped character in reference-token [RFC6901]_</span>
<span class="n">_unescaped</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">r&#39;/|~[^01]&#39;</span><span class="p">)</span>


<span class="n">_privattr</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;isfragment&#39;</span><span class="p">:</span> <span class="s1">&#39;__isfragment&#39;</span><span class="p">,</span>
    <span class="s1">&#39;isrel&#39;</span><span class="p">:</span> <span class="s1">&#39;__isrel&#39;</span><span class="p">,</span>
    <span class="s1">&#39;raw&#39;</span><span class="p">:</span> <span class="s1">&#39;__raw&#39;</span><span class="p">,</span>
    <span class="s1">&#39;relupidx&#39;</span><span class="p">:</span> <span class="s1">&#39;__relupidx&#39;</span><span class="p">,</span>
    <span class="s1">&#39;start&#39;</span><span class="p">:</span> <span class="s1">&#39;__start&#39;</span><span class="p">,</span>
    <span class="s1">&#39;startrel&#39;</span><span class="p">:</span> <span class="s1">&#39;__startrel&#39;</span><span class="p">,</span>
<span class="p">}</span> <span class="c1">#: private attributes accessible by __steattr__ and __getattr__ only</span>


<div class="viewcode-block" id="fetch_pointerpath"><a class="viewcode-back" href="../../jsondata_jsonpointer_doc.html#jsondata.jsonpointer.fetch_pointerpath">[docs]</a><span class="k">def</span> <span class="nf">fetch_pointerpath</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">base</span><span class="p">,</span> <span class="n">restype</span><span class="o">=</span><span class="n">M_FIRST</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Converts the address of *node* within the data structure</span>
<span class="sd">    *base* into a corresponding pointer path.</span>
<span class="sd">    The current implementation is search based, thus</span>
<span class="sd">    may cause performance issues when frequently applied,</span>
<span class="sd">    or processing very large structures.</span>

<span class="sd">    For example: ::</span>

<span class="sd">       nodex = {&#39;a&#39;: &#39;pattern&#39;}</span>
<span class="sd">       data = {0: nodex, 1: [{&#39;x&#39;:[nodex}]]}</span>

<span class="sd">       res = fetch_pointerpath(nodex, data)</span>

<span class="sd">       res = [</span>
<span class="sd">          [0],</span>
<span class="sd">          [1, 0, &#39;x&#39;, 0]</span>
<span class="sd">       ]</span>

<span class="sd">    Args:</span>

<span class="sd">        **node**:</span>
<span class="sd">            Address of Node to be searched for.</span>

<span class="sd">        **base**:</span>
<span class="sd">            A tree top node to search the subtree for node.</span>

<span class="sd">        **restype**:</span>
<span class="sd">            Type of search. ::</span>

<span class="sd">               M_FIRST: The first match only.</span>
<span class="sd">               M_LAST: The first match only.</span>
<span class="sd">               M_ALL: All matches.</span>

<span class="sd">    Returns:</span>

<span class="sd">        Returns a list of lists, where the contained</span>
<span class="sd">        lists are pointer pathlists for matched elements.</span>

<span class="sd">        * restype:=M_FIRST: &#39;[[&lt;first-match&gt;]]&#39;,</span>

<span class="sd">        * restype:=M_LAST: &#39;[[&lt;last-match&gt;]]&#39;,</span>

<span class="sd">        * restype:=M_ALL: &#39;[[&lt;first-match&gt;],[&lt;second-match&gt;],...]&#39;</span>

<span class="sd">    Raises:</span>

<span class="sd">        JSONDataError</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">node</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">base</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">base</span><span class="p">,</span> <span class="n">JSONData</span><span class="p">):</span>
        <span class="n">base</span> <span class="o">=</span> <span class="n">base</span><span class="o">.</span><span class="n">data</span>

    <span class="n">spath</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">kl</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">base</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>  <span class="c1"># first layer - list of elements</span>
        <span class="n">kl</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="nb">id</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="o">==</span> <span class="nb">id</span><span class="p">(</span><span class="n">base</span><span class="p">):</span>  <span class="c1"># top node</span>
            <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">kl</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">sx</span> <span class="ow">in</span> <span class="n">base</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">id</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="o">==</span> <span class="nb">id</span><span class="p">(</span><span class="n">sx</span><span class="p">):</span>
                    <span class="n">s</span> <span class="o">=</span> <span class="n">spath</span><span class="p">[:]</span>
                    <span class="n">s</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kl</span><span class="p">)</span>
                    <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

                <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">sx</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                    <span class="n">sublst</span> <span class="o">=</span> <span class="n">fetch_pointerpath</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">sx</span><span class="p">,</span> <span class="n">restype</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">sublst</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">slx</span> <span class="ow">in</span> <span class="n">sublst</span><span class="p">:</span>
                            <span class="c1"># TODO: update the documentation-scanner: res.append([kl, *slx])</span>
                            <span class="n">_l</span> <span class="o">=</span> <span class="p">[</span><span class="n">kl</span><span class="p">]</span>
                            <span class="n">_l</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">slx</span><span class="p">)</span>
                            <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_l</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">sx</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">set</span><span class="p">,):</span>
                    <span class="k">raise</span> <span class="n">JSONPointerError</span><span class="p">(</span><span class="n">sx</span><span class="p">)</span>
                <span class="n">kl</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">base</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>  <span class="c1"># first layer - dict of elements</span>
        <span class="k">if</span> <span class="nb">id</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="o">==</span> <span class="nb">id</span><span class="p">(</span><span class="n">base</span><span class="p">):</span>  <span class="c1"># top node</span>
            <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="s1">&#39;&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">base</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">id</span><span class="p">(</span><span class="n">node</span><span class="p">)</span> <span class="o">==</span> <span class="nb">id</span><span class="p">(</span><span class="n">v</span><span class="p">):</span>
                    <span class="n">spath</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                    <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spath</span><span class="p">)</span>
                    <span class="k">continue</span>
                <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                    <span class="n">sublst</span> <span class="o">=</span> <span class="n">fetch_pointerpath</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">restype</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">sublst</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">slx</span> <span class="ow">in</span> <span class="n">sublst</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">slx</span><span class="p">:</span>
                                <span class="c1"># TODO: update the documentation-scanner: res.append([k, *slx])</span>
                                <span class="n">_l</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span><span class="p">]</span>
                                <span class="n">_l</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">slx</span><span class="p">)</span>
                                <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_l</span><span class="p">)</span>
                <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">set</span><span class="p">,):</span>
                    <span class="k">raise</span> <span class="n">JSONPointerError</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">base</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">set</span><span class="p">,):</span>
        <span class="k">raise</span> <span class="n">JSONPointerError</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">res</span> <span class="ow">and</span> <span class="n">restype</span> <span class="o">==</span> <span class="n">M_FIRST</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="k">elif</span> <span class="n">res</span> <span class="ow">and</span> <span class="n">restype</span> <span class="o">==</span> <span class="n">M_LAST</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">res</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
    <span class="k">return</span> <span class="n">res</span></div>


<div class="viewcode-block" id="JSONPointer"><a class="viewcode-back" href="../../jsondata_jsonpointer_doc.html#jsondata.jsonpointer.JSONPointer">[docs]</a><span class="k">class</span> <span class="nc">JSONPointer</span><span class="p">(</span><span class="nb">list</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Represents exactly one JSONPointer in compliance with</span>
<span class="sd">    IETF RFC6901 and relative-pointer/draft-1/2018</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">VALID_INDEX</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s1">&#39;0|[1-9][0-9]*$&#39;</span><span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;Regular expression for valid numerical index.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="JSONPointer.__init__"><a class="viewcode-back" href="../../jsondata_jsonpointer_doc.html#jsondata.jsonpointer.JSONPointer.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ptr</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Normalizes and stores a JSONPointer. The internal</span>
<span class="sd">        representation depends on the type.</span>

<span class="sd">        * absolute path:</span>

<span class="sd">          A list of ordered items representing</span>
<span class="sd">          the path items.</span>

<span class="sd">        * relative path:</span>

<span class="sd">          Relative paths in addition provide</span>
<span class="sd">          a positive numeric offset of outer</span>
<span class="sd">          containers [RELPOINTER]_.</span>

<span class="sd">        Processes the ABNF of a JSON Pointer from RFC6901</span>
<span class="sd">        and/or a relative JSON Pointer(draft 2018).</span>

<span class="sd">        Attributes:</span>
<span class="sd">            For details see manuals.</span>

<span class="sd">            * *isfragment*</span>
<span class="sd">            * *isrel*</span>
<span class="sd">            * *raw*</span>
<span class="sd">            * *start*</span>
<span class="sd">            * *startrel*</span>

<span class="sd">        Args:</span>
<span class="sd">            **ptr**:</span>
<span class="sd">                A JSONPointer to be represented by this object. The</span>
<span class="sd">                supported formats are:</span>

<span class="sd">                .. parsed-literal::</span>

<span class="sd">                   ptr := (</span>
<span class="sd">                       JSONPointer                  # [RFC6901]_ or [RELPOINTER]_</span>
<span class="sd">                       | &lt;rfc6901-string&gt;           # [RFC6901]_</span>
<span class="sd">                       | &lt;relative-pointer-string&gt;  # [RELPOINTER]_</span>
<span class="sd">                       | &lt;pointer-items-list&gt;       # non-URI-fragment pointer path items of [RFC6901]_</span>
<span class="sd">                       )</span>

<span class="sd">                JSONPointer:</span>
<span class="sd">                    A valid object, is copied into this object,</span>
<span class="sd">                    see &#39;deep&#39;. Supports *rfc6901* [RFC6901]_</span>
<span class="sd">                    and *relative* pointers [RELPOINTER]_.</span>

<span class="sd">                *rfc6901-string*:</span>
<span class="sd">                    A string i accordance to RFC6901 [RFC6901]_.</span>

<span class="sd">                *relative-pointer-string*:</span>
<span class="sd">                    Draft standard, currently</span>
<span class="sd">                    experimental [RELPOINTER]_.</span>

<span class="sd">                *pointer-items-list*:</span>
<span class="sd">                    Expects a path list, where each item</span>
<span class="sd">                    is processed for escape and unquote.</span>
<span class="sd">                    Supports *rfc6901* pointers [RFC6901]_.</span>

<span class="sd">                Containing:</span>

<span class="sd">                * absolute JSON Pointer</span>
<span class="sd">                * relative JSON Pointer, requires the</span>
<span class="sd">                  keyword argument *startrel*</span>

<span class="sd">            kargs:</span>

<span class="sd">                **debug**:</span>
<span class="sd">                    Enable debugging.</span>

<span class="sd">                **deep**:</span>
<span class="sd">                    Applies for copy operations on structured data</span>
<span class="sd">                    &#39;deep&#39; when &#39;True&#39;, else &#39;shallow&#39; only.</span>
<span class="sd">                    Flat data types are copied by value in any case.</span>

<span class="sd">                **node**:</span>
<span class="sd">                    Force to set the pointed node in the internal cache.</span>

<span class="sd">                **replace**:</span>
<span class="sd">                    Replace masked characters, is applied onto the *ptr*</span>
<span class="sd">                    parameter only. For the replacement of *startrel*</span>
<span class="sd">                    create and pass an object *JSONPointer*. ::</span>

<span class="sd">                       replace := (</span>
<span class="sd">                            True    # replaces rfc6901 escape sequences: ~0 and ~1</span>
<span class="sd">                          | False   # omit unescaping</span>
<span class="sd">                       )</span>

<span class="sd">                    .. note::</span>

<span class="sd">                       Match operations on address strings are proceeded literally,</span>
<span class="sd">                       thus the escaped characters should be consistent,</span>
<span class="sd">                       see rfc6901, Section 3.</span>

<span class="sd">                    default := False</span>

<span class="sd">                **startrel**:</span>
<span class="sd">                    Start node for relative JSON Pointers. Is evaluated</span>
<span class="sd">                    only in combination with a relative path, else</span>
<span class="sd">                    ignored. ::</span>

<span class="sd">                       startrel := (</span>
<span class="sd">                            JSONPointer           # supports [RFC6901]_ and [RELPOINTER]_</span>
<span class="sd">                          | &lt;rfc6901-string&gt;      # supports [RFC6901]_</span>
<span class="sd">                          | &lt;rel-pointer-string&gt;  # supports only relative to whole-document &#39;0/...&#39;</span>
<span class="sd">                       )</span>

<span class="sd">                    default := &quot;&quot;  # whole document</span>

<span class="sd">        Returns:</span>
<span class="sd">            When successful returns *True*, else returns either *False*, or</span>
<span class="sd">            raises an exception.</span>
<span class="sd">            Success is the complete addition only, thus one failure returns</span>
<span class="sd">            *False*.</span>

<span class="sd">        Raises:</span>
<span class="sd">            JSONPointerError:</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">debug</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;debug&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deep</span> <span class="o">=</span> <span class="n">deep</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;deep&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;node&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>  <span class="c1"># cache for reuse</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__startrel</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;startrel&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>  <span class="c1"># default whole document</span>
        <span class="n">replace</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;replace&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">JSONPointer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">()</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">ptr</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>  <span class="c1"># pointer are unicode only</span>
            <span class="n">ptr</span> <span class="o">=</span> <span class="n">unicode</span><span class="p">(</span><span class="n">ptr</span><span class="p">)</span>  <span class="c1"># is relative pointer</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__raw</span> <span class="o">=</span> <span class="n">ptr</span>

        <span class="k">elif</span> <span class="n">deep</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">ptr</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ISSTR</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__raw</span> <span class="o">=</span> <span class="n">ptr</span><span class="p">[:]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__raw</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">ptr</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">ptr</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ISSTR</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__raw</span> <span class="o">=</span> <span class="n">ptr</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ptr</span><span class="p">,</span> <span class="n">JSONPointer</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__raw</span> <span class="o">=</span> <span class="n">JSONPointer</span><span class="p">(</span><span class="n">ptr</span><span class="o">.</span><span class="n">get_raw</span><span class="p">(),</span> <span class="n">startrel</span><span class="o">=</span><span class="n">ptr</span><span class="o">.</span><span class="n">get_startrel</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__raw</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">ptr</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__isrel</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1">#: marks a relative pointer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__start</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__isfragment</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1">#: marks a uri fragment</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">ptr</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>  <span class="c1"># no-fragment rfc6901</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ptr</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">ptr</span> <span class="ow">in</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;#&#39;</span><span class="p">):</span>  <span class="c1"># shortcut for whole document, see RFC6901</span>
            <span class="c1"># &#39;#&#39; is URI fragments RFC6901 section 6</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">elif</span> <span class="n">ptr</span> <span class="o">==</span> <span class="s1">&#39;/&#39;</span><span class="p">:</span>  <span class="c1"># shortcut for empty tag at top-level, see RFC6901</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ptr</span><span class="p">,</span> <span class="n">ISSTR</span><span class="p">):</span>  <span class="c1"># string in accordance to RFC6901</span>
            <span class="k">if</span> <span class="n">ptr</span> <span class="o">==</span> <span class="s1">&#39;#/&#39;</span><span class="p">:</span>  <span class="c1"># URI fragments RFC6901 section 6</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__isfragment</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>

            <span class="k">elif</span> <span class="n">ptr</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">):</span>  <span class="c1"># URI fragments RFC6901 section 6</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__isfragment</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">ptr</span> <span class="o">=</span> <span class="n">url_unquote</span><span class="p">(</span><span class="n">ptr</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>

            <span class="k">elif</span> <span class="n">ptr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>  <span class="c1"># relative pointer - 2018/draft1 see doc [RELPOINTER]</span>

                <span class="c1">#</span>
                <span class="c1"># 1: integer offset</span>
                <span class="c1"># 3: fetch key</span>
                <span class="c1"># 4: fetch node @relpath</span>
                <span class="c1"># 5: int</span>
                <span class="c1">#</span>
                <span class="n">_m</span> <span class="o">=</span> <span class="n">_RELPOINTER</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">ptr</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">_m</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">JSONPointerError</span><span class="p">(</span><span class="s2">&quot;Syntax:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ptr</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__isrel</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__startrel</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="n">JSONPointer</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">unicode</span><span class="p">):</span>
                    <span class="n">_sr</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__startrel</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; / &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__startrel</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">_sr</span><span class="p">)</span> <span class="o">&gt;</span><span class="mi">200</span><span class="p">:</span>
                        <span class="n">_sr</span> <span class="o">=</span> <span class="n">_sr</span><span class="p">[:</span><span class="mi">200</span><span class="p">]</span>
                    <span class="k">raise</span> <span class="n">JSONPointerError</span><span class="p">(</span><span class="s2">&quot;type not supported startrel=&quot;</span> <span class="o">+</span> <span class="n">_sr</span><span class="p">)</span>

                <span class="c1">#</span>
                <span class="c1"># &lt;int&gt;&lt;jsonpointer&gt; or &lt;int&gt;#</span>
                <span class="c1">#</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__relupidx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">_m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>  <span class="c1"># &lt;int&gt; - upward increment</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__relupidx</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">JSONPointerError</span><span class="p">(</span><span class="s2">&quot;Cannot scan:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ptr</span><span class="p">))</span>

                <span class="k">if</span> <span class="n">_m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>  <span class="c1"># &lt;int&gt;&lt;jsonpointer&gt;</span>
                    <span class="n">ptr</span> <span class="o">=</span> <span class="n">_m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>  <span class="c1"># downward path</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__isrelpathrequest</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="k">elif</span> <span class="n">_m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>  <span class="c1"># fetch-key/fetch-index</span>
                    <span class="n">ptr</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__isrelpathrequest</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="k">elif</span> <span class="n">_m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># &lt;int&gt; - whole rel-sub-document</span>
                    <span class="n">ptr</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__isrelpathrequest</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">JSONPointerError</span><span class="p">(</span><span class="s2">&quot;Cannot scan:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ptr</span><span class="p">))</span>

                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__startrel</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ISSTR</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__startrel</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__startrel</span> <span class="o">=</span> <span class="n">JSONPointer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__startrel</span><span class="p">)</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__startrel</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">__relupidx</span><span class="p">:</span> <span class="c1"># integer prefix-overflow</span>
                    <span class="k">raise</span> <span class="n">JSONPointerError</span><span class="p">(</span>
                        <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">integer prefix overflow:&quot;</span>
                        <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> prefix        = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__relupidx</span><span class="p">)</span>
                        <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> len(startrel) = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__startrel</span><span class="p">))</span>
                        <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> startrel      = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__startrel</span><span class="p">)</span>
                        <span class="p">)</span>

                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__startrel</span><span class="p">)</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">__relupidx</span><span class="p">:</span>  <span class="c1"># integer-prefix equel to offset</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__isrelpathrequest</span><span class="p">:</span>  <span class="c1"># anchor for a relative path</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__start</span> <span class="o">=</span>  <span class="n">JSONPointer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__startrel</span><span class="p">[:(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__startrel</span><span class="p">)</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">__relupidx</span><span class="p">)])</span>
                    <span class="k">else</span><span class="p">:</span>  <span class="c1"># request for key/index</span>
                        <span class="k">raise</span> <span class="n">JSONPointerError</span><span class="p">(</span>
                            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">key/index request for &lt;whole-document&gt; prohibited by specification [RELPOINTER], see manuals:&quot;</span>
                            <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> prefix        = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__relupidx</span><span class="p">)</span>
                            <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> len(startrel) = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__startrel</span><span class="p">))</span>
                            <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> startrel      = &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__startrel</span><span class="p">)</span>
                            <span class="p">)</span>


                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__startrel</span><span class="p">)</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">__relupidx</span><span class="p">:</span>  <span class="c1"># integer-prefix within offset</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__start</span> <span class="o">=</span>  <span class="n">JSONPointer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__startrel</span><span class="p">[:(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__startrel</span><span class="p">)</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">__relupidx</span><span class="p">)])</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__start</span> <span class="o">=</span>  <span class="n">JSONPointer</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">ptr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ptr</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">))</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">JSONPointerTypeError</span><span class="p">(</span><span class="s2">&quot;requires a valid JSON pointer: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ptr</span><span class="p">))</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ptr</span><span class="p">,</span> <span class="n">JSONPointer</span><span class="p">):</span>  <span class="c1"># copy constructor</span>
            <span class="k">if</span> <span class="n">ptr</span><span class="o">.</span><span class="n">isrel</span><span class="p">():</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__isrel</span> <span class="o">=</span> <span class="n">ptr</span><span class="o">.</span><span class="n">isrel</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__relupidx</span> <span class="o">=</span> <span class="n">ptr</span><span class="o">.</span><span class="n">get_relupidx</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__isrelpathrequest</span> <span class="o">=</span> <span class="n">ptr</span><span class="o">.</span><span class="n">isrelpathrequest</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">deep</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__raw</span> <span class="o">=</span> <span class="n">ptr</span><span class="o">.</span><span class="n">get_raw</span><span class="p">()[:]</span>
                <span class="k">if</span> <span class="n">ptr</span><span class="o">.</span><span class="n">isrel</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__start</span> <span class="o">=</span> <span class="n">ptr</span><span class="o">.</span><span class="n">get_start</span><span class="p">()</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__startrel</span> <span class="o">=</span> <span class="n">ptr</span><span class="o">.</span><span class="n">get_startrel</span><span class="p">()</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ptr</span><span class="o">.</span><span class="n">copy_path</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__raw</span> <span class="o">=</span> <span class="n">ptr</span><span class="o">.</span><span class="n">get_raw</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">ptr</span><span class="o">.</span><span class="n">isrel</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__start</span> <span class="o">=</span> <span class="n">ptr</span><span class="o">.</span><span class="n">get_start</span><span class="p">()</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__startrel</span> <span class="o">=</span> <span class="n">ptr</span><span class="o">.</span><span class="n">get_startrel</span><span class="p">()</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ptr</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">ptr</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
            <span class="c1"># list of entries in accordance to RFC6901, and JSONPointer</span>

            <span class="k">def</span> <span class="nf">presolv</span><span class="p">(</span><span class="n">p0</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p0</span><span class="p">,</span> <span class="n">JSONPointer</span><span class="p">):</span>  <span class="c1"># copy constructor</span>
                    <span class="k">return</span> <span class="n">p0</span><span class="o">.</span><span class="n">ptr</span>
                <span class="k">elif</span> <span class="n">p0</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">p0</span>
                <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">p0</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">unicode</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">p0</span>
                <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">p0</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
                    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">p0</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">JSONPointerError</span><span class="p">(</span><span class="s2">&quot;Invalid nodepart:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">p0</span><span class="p">))</span>
                <span class="k">return</span> <span class="n">p0</span>

            <span class="k">if</span> <span class="n">deep</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="p">[:],</span> <span class="n">ptr</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">presolv</span><span class="p">,</span> <span class="n">ptr</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__raw</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">ptr</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__raw</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="k">raise</span> <span class="n">JSONPointerError</span><span class="p">(</span><span class="s2">&quot;Pointer type not supported:&quot;</span><span class="p">,</span>
                                       <span class="nb">type</span><span class="p">(</span><span class="n">ptr</span><span class="p">))</span>

        <span class="k">def</span> <span class="nf">_rep0</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">unicode</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
                    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">url_unquote</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;~1&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;~0&#39;</span><span class="p">,</span> <span class="s1">&#39;~&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">x</span>

        <span class="k">def</span> <span class="nf">_rep1</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">unicode</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
                    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">x</span>

        <span class="k">if</span> <span class="n">replace</span><span class="p">:</span>
            <span class="n">sx</span> <span class="o">=</span> <span class="p">[</span><span class="n">_rep0</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sx</span> <span class="o">=</span> <span class="p">[</span><span class="n">_rep1</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">]</span>

        <span class="k">del</span> <span class="bp">self</span><span class="p">[:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">sx</span><span class="p">)</span></div>

<div class="viewcode-block" id="JSONPointer.__add__"><a class="viewcode-back" href="../../jsondata_jsonpointer_doc.html#jsondata.jsonpointer.JSONPointer.__add__">[docs]</a>    <span class="k">def</span> <span class="nf">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Appends a Pointer to self.</span>

<span class="sd">        Args:</span>
<span class="sd">            **x**:</span>
<span class="sd">                A valid JSONPointer of type: ::</span>

<span class="sd">                   x := (</span>
<span class="sd">                      JSONPointer - fragment</span>
<span class="sd">                      | JSONPointer - relative-pointer</span>
<span class="sd">                      | relative pointer</span>
<span class="sd">                      )</span>

<span class="sd">        Returns:</span>
<span class="sd">            A new object of JSONPointer</span>

<span class="sd">        Raises:</span>
<span class="sd">            JSONPointerError:</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">JSONPointer</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="c1"># pointer are unicode only, RFC6901/RFC3829</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">unicode</span><span class="p">)</span> <span class="ow">and</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="s1">&#39;#&#39;</span><span class="p">:</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>  <span class="c1"># whole document, RFC6901</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">x</span> <span class="o">==</span> <span class="s1">u&#39;/&#39;</span><span class="p">:</span>  <span class="c1"># empty tag</span>
            <span class="n">ret</span><span class="o">.</span><span class="n">__raw</span> <span class="o">+=</span> <span class="n">x</span>
            <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">JSONPointer</span><span class="p">):</span>
            <span class="n">ret</span><span class="o">.</span><span class="n">__raw</span> <span class="o">+=</span> <span class="n">x</span><span class="o">.</span><span class="n">raw</span>
            <span class="n">ret</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,):</span>
            <span class="n">ret</span><span class="o">.</span><span class="n">__raw</span> <span class="o">+=</span> <span class="s1">u&#39;/&#39;</span> <span class="o">+</span> <span class="s1">u&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">ret</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">unicode</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">u&#39;/&#39;</span><span class="p">:</span>
                <span class="n">ret</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">))</span>
                <span class="n">ret</span><span class="o">.</span><span class="n">__raw</span> <span class="o">+=</span> <span class="n">x</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ret</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">))</span>
                <span class="n">ret</span><span class="o">.</span><span class="n">__raw</span> <span class="o">+=</span> <span class="s1">u&#39;/&#39;</span> <span class="o">+</span> <span class="n">x</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
            <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">ret</span><span class="o">.</span><span class="n">__raw</span> <span class="o">+=</span> <span class="s1">u&#39;/&#39;</span> <span class="o">+</span> <span class="n">unicode</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">x</span>  <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">ret</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">JSONPointerError</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">ret</span></div>

<div class="viewcode-block" id="JSONPointer.__call__"><a class="viewcode-back" href="../../jsondata_jsonpointer_doc.html#jsondata.jsonpointer.JSONPointer.__call__">[docs]</a>    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Evaluates the pointer value on the document.</span>

<span class="sd">        Args:</span>
<span class="sd">            **x**:</span>
<span class="sd">                A valid JSON document.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The resulting pointer value.</span>

<span class="sd">        Raises:</span>
<span class="sd">            JSONPointerError</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">__delattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;delete: &quot;</span> <span class="o">+</span> <span class="n">name</span><span class="p">)</span>

<div class="viewcode-block" id="JSONPointer.__eq__"><a class="viewcode-back" href="../../jsondata_jsonpointer_doc.html#jsondata.jsonpointer.JSONPointer.__eq__">[docs]</a>    <span class="k">def</span> <span class="nf">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compares this pointer with x.</span>

<span class="sd">        Args:</span>
<span class="sd">            **x**:</span>
<span class="sd">                A JSONPointer object.</span>

<span class="sd">        Returns:</span>
<span class="sd">            True or False</span>

<span class="sd">        Raises:</span>
<span class="sd">            JSONPointerError</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">JSONPointer</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_pointer_str</span><span class="p">(</span><span class="n">NOTATION_JSON</span><span class="p">)</span> <span class="o">==</span> <span class="n">x</span><span class="o">.</span><span class="n">get_pointer_str</span><span class="p">(</span><span class="n">NOTATION_JSON</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">x</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_pointer_str</span><span class="p">(</span><span class="n">NOTATION_JSON</span><span class="p">)</span> <span class="o">==</span> <span class="s1">u&#39;&#39;</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_pointer_str</span><span class="p">(</span><span class="n">NOTATION_JSON</span><span class="p">)</span> <span class="o">==</span> <span class="s1">u&#39;/&#39;</span> <span class="o">+</span> <span class="s1">u&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">unicode</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">unicode</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_pointer_str</span><span class="p">(</span><span class="n">forcenotation</span><span class="o">=</span><span class="n">NOTATION_JSON</span><span class="p">)</span> <span class="o">==</span> <span class="n">x</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_pointer_str</span><span class="p">(</span><span class="n">forcenotation</span><span class="o">=</span><span class="n">NOTATION_JSON</span><span class="p">)</span> <span class="o">==</span> <span class="s1">u&#39;/&#39;</span> <span class="o">+</span> <span class="n">unicode</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">x</span>  <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">JSONPointerError</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="JSONPointer.__ge__"><a class="viewcode-back" href="../../jsondata_jsonpointer_doc.html#jsondata.jsonpointer.JSONPointer.__ge__">[docs]</a>    <span class="k">def</span> <span class="nf">__ge__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Checks containment(&gt;=) of another pointer within this.</span>

<span class="sd">        The weight of contained entries is the criteria, though</span>
<span class="sd">        the shorter is the bigger. This is true only in case of</span>
<span class="sd">        a containment relation.</span>

<span class="sd">        The number of equal path pointer items is compared.</span>

<span class="sd">        Args:</span>
<span class="sd">            **x**:</span>
<span class="sd">                A valid Pointer.</span>

<span class="sd">        Returns:</span>
<span class="sd">            True or False</span>

<span class="sd">        Raises:</span>
<span class="sd">            JSONPointerError:</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">JSONPointer</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">JSONPointer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__le__</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ISSTR</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">JSONPointer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__le__</span><span class="p">(</span><span class="n">JSONPointer</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">JSONPointerError</span><span class="p">()</span></div>

<div class="viewcode-block" id="JSONPointer.__gt__"><a class="viewcode-back" href="../../jsondata_jsonpointer_doc.html#jsondata.jsonpointer.JSONPointer.__gt__">[docs]</a>    <span class="k">def</span> <span class="nf">__gt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Checks containment(&gt;) of another pointer or object within this.</span>

<span class="sd">        The number of equal items is compared.</span>

<span class="sd">        Args:</span>
<span class="sd">            **x**:</span>
<span class="sd">                A valid Pointer.</span>

<span class="sd">        Returns:</span>
<span class="sd">            True or False</span>

<span class="sd">        Raises:</span>
<span class="sd">            JSONPointerError:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">JSONPointer</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">JSONPointer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__gt__</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ISSTR</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">JSONPointer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__lt__</span><span class="p">(</span><span class="n">JSONPointer</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">JSONPointerError</span><span class="p">()</span></div>

<div class="viewcode-block" id="JSONPointer.__iadd__"><a class="viewcode-back" href="../../jsondata_jsonpointer_doc.html#jsondata.jsonpointer.JSONPointer.__iadd__">[docs]</a>    <span class="k">def</span> <span class="nf">__iadd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add in place x to self, appends a path.</span>

<span class="sd">        Args:</span>
<span class="sd">            **x**:</span>
<span class="sd">                A valid Pointer.</span>

<span class="sd">        Returns:</span>
<span class="sd">            &#39;self&#39; with updated pointer attributes</span>

<span class="sd">        Raises:</span>
<span class="sd">            JSONPointerError:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__raw</span> <span class="o">+=</span> <span class="n">unicode</span><span class="p">(</span><span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">JSONPointer</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">raw</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">u&#39;/&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__raw</span> <span class="o">+=</span> <span class="s1">u&#39;/&#39;</span> <span class="o">+</span> <span class="n">x</span><span class="o">.</span><span class="n">raw</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__raw</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">raw</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">unicode</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__raw</span> <span class="o">+=</span> <span class="s1">u&#39;/&#39;</span> <span class="o">+</span> <span class="n">unicode</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">x</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>  <span class="c1"># whole document, RFC6901</span>
            <span class="k">raise</span> <span class="n">JSONPointerError</span><span class="p">(</span><span class="s2">&quot;Cannot add the whole document&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">x</span> <span class="o">==</span> <span class="s1">u&#39;/&#39;</span><span class="p">:</span>  <span class="c1"># empty tag</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__raw</span> <span class="o">+=</span> <span class="n">x</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">unicode</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">u&#39;/&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__raw</span> <span class="o">+=</span> <span class="n">x</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__raw</span> <span class="o">+=</span> <span class="s1">u&#39;/&#39;</span> <span class="o">+</span> <span class="n">x</span>
        <span class="k">elif</span> <span class="n">x</span>  <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">JSONPointerError</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span></div>

<div class="viewcode-block" id="JSONPointer.__le__"><a class="viewcode-back" href="../../jsondata_jsonpointer_doc.html#jsondata.jsonpointer.JSONPointer.__le__">[docs]</a>    <span class="k">def</span> <span class="nf">__le__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Checks containment(&lt;=) of this pointer within another.</span>

<span class="sd">        The number of equal items is compared.</span>

<span class="sd">        Args:</span>
<span class="sd">            **x**:</span>
<span class="sd">                A valid Pointer.</span>

<span class="sd">        Returns:</span>
<span class="sd">            True or False</span>

<span class="sd">        Raises:</span>
<span class="sd">            JSONPointerError:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">JSONPointer</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">JSONPointer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__ge__</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ISSTR</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">JSONPointer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__ge__</span><span class="p">(</span><span class="n">JSONPointer</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">JSONPointerError</span><span class="p">()</span></div>

<div class="viewcode-block" id="JSONPointer.__lt__"><a class="viewcode-back" href="../../jsondata_jsonpointer_doc.html#jsondata.jsonpointer.JSONPointer.__lt__">[docs]</a>    <span class="k">def</span> <span class="nf">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Checks containment(&lt;) of this pointer within another.</span>

<span class="sd">        The number of equal items is compared.</span>

<span class="sd">        Args:</span>
<span class="sd">            **x**:</span>
<span class="sd">                A valid Pointer.</span>

<span class="sd">        Returns:</span>
<span class="sd">            True or False</span>

<span class="sd">        Raises:</span>
<span class="sd">            JSONPointerError:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">JSONPointer</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">JSONPointer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__gt__</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ISSTR</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">JSONPointer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__gt__</span><span class="p">(</span><span class="n">JSONPointer</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">JSONPointerError</span><span class="p">()</span></div>

<div class="viewcode-block" id="JSONPointer.__ne__"><a class="viewcode-back" href="../../jsondata_jsonpointer_doc.html#jsondata.jsonpointer.JSONPointer.__ne__">[docs]</a>    <span class="k">def</span> <span class="nf">__ne__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compares this pointer with x.</span>

<span class="sd">        Args:</span>
<span class="sd">            **x**:</span>
<span class="sd">                A valid Pointer.</span>

<span class="sd">        Returns:</span>
<span class="sd">            True or False</span>

<span class="sd">        Raises:</span>
<span class="sd">            JSONPointerError</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__eq__</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></div>

<div class="viewcode-block" id="JSONPointer.__radd__"><a class="viewcode-back" href="../../jsondata_jsonpointer_doc.html#jsondata.jsonpointer.JSONPointer.__radd__">[docs]</a>    <span class="k">def</span> <span class="nf">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Adds itself as the right-side-argument to the left.</span>

<span class="sd">        This method appends &#39;self&#39; to a path fragment on the left.</span>
<span class="sd">        Therefore it adds the path separator on it&#39;s left side only.</span>
<span class="sd">        The left side path fragment has to maintain to be in</span>
<span class="sd">        accordance to RFC6901 by itself.</span>

<span class="sd">        Once &#39;self&#39; is added to the left side, it terminates it&#39;s</span>
<span class="sd">        life cycle. Thus another simultaneous add operation is</span>
<span class="sd">        handled by the resulting other element.</span>

<span class="sd">        Args:</span>
<span class="sd">            **x**:</span>
<span class="sd">                A valid Pointer.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The updated input of type &#39;x&#39; as &#39;x+S(x)&#39;</span>

<span class="sd">        Raises:</span>
<span class="sd">            JSONPointerError:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>  <span class="c1"># whole document, RFC6901</span>
            <span class="k">return</span> <span class="s1">u&#39;/&#39;</span> <span class="o">+</span> <span class="s1">u&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">unicode</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">x</span> <span class="o">==</span> <span class="s1">u&#39;/&#39;</span><span class="p">:</span>  <span class="c1"># empty tag</span>
            <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="s1">u&#39;/&#39;</span> <span class="o">+</span> <span class="s1">u&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">unicode</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
            <span class="k">return</span> <span class="s1">u&#39;/&#39;</span> <span class="o">+</span> <span class="n">unicode</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="s1">u&#39;/&#39;</span> <span class="o">+</span> <span class="s1">u&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">unicode</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">unicode</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="s1">u&#39;/&#39;</span> <span class="o">+</span> <span class="s1">u&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">unicode</span><span class="p">,</span> <span class="bp">self</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">JSONPointerError</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">x</span></div>

<div class="viewcode-block" id="JSONPointer.__repr__"><a class="viewcode-back" href="../../jsondata_jsonpointer_doc.html#jsondata.jsonpointer.JSONPointer.__repr__">[docs]</a>    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the attribute self.__raw, which is the raw input JSONPointer.</span>

<span class="sd">        Args:</span>
<span class="sd">            None</span>

<span class="sd">        Attributes:</span>
<span class="sd">            Evaluates *self.__isrel*</span>

<span class="sd">        Returns:</span>
<span class="sd">            For relative paths: ::</span>
<span class="sd">               (&lt;start-offset&gt;, &lt;pointer&gt;)</span>

<span class="sd">               start-offset := [&lt;self.startrel&gt;]</span>
<span class="sd">               pointer := [&lt;self&gt;]</span>

<span class="sd">            For RFC6901 paths: ::</span>

<span class="sd">               &lt;pointer&gt;</span>

<span class="sd">               pointer := [&lt;self&gt;]</span>

<span class="sd">        Raises:</span>
<span class="sd">            pass-through</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__isrel</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="s1">&#39;(</span><span class="si">%s</span><span class="s1">, </span><span class="si">%s</span><span class="s1">)&#39;</span> <span class="o">%</span> <span class="p">(</span>
                <span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__start</span><span class="p">),</span>
                <span class="n">unicode</span><span class="p">(</span><span class="nb">super</span><span class="p">(</span><span class="n">JSONPointer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__repr__</span><span class="p">()),</span>
                <span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">JSONPointer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__repr__</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">ret</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;&#39;&#39;&quot;</span>
        <span class="k">return</span> <span class="n">ret</span></div>

    <span class="k">def</span> <span class="nf">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="n">_privattr</span><span class="p">[</span><span class="n">name</span><span class="p">]]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

<div class="viewcode-block" id="JSONPointer.__str__"><a class="viewcode-back" href="../../jsondata_jsonpointer_doc.html#jsondata.jsonpointer.JSONPointer.__str__">[docs]</a>    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the string for the processed path.</span>

<span class="sd">        Args:</span>
<span class="sd">            None</span>

<span class="sd">        Attributes:</span>
<span class="sd">            Evaluates *self.__isrel*</span>

<span class="sd">        Returns:</span>
<span class="sd">            For relative paths: ::</span>
<span class="sd">               (&lt;start-offset&gt;, &lt;pointer&gt;)</span>

<span class="sd">               start-offset := [&lt;self.startrel&gt;]</span>
<span class="sd">               pointer := [&lt;self&gt;]</span>

<span class="sd">            For RFC6901 paths: ::</span>

<span class="sd">               &lt;pointer&gt;</span>

<span class="sd">               pointer := [&lt;self&gt;]</span>

<span class="sd">        Raises:</span>
<span class="sd">            pass-through</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__isrel</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__start</span><span class="p">:</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__start</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">))</span>
                    <span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="p">:</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">)))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="s1">&#39;&quot;&quot;&#39;</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="p">:</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">)))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="s1">&#39;&quot;&quot;&#39;</span>

        <span class="k">if</span> <span class="n">ret</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;&#39;&#39;&quot;</span>
        <span class="k">return</span> <span class="n">ret</span></div>

<div class="viewcode-block" id="JSONPointer.check_node_or_value"><a class="viewcode-back" href="../../jsondata_jsonpointer_doc.html#jsondata.jsonpointer.JSONPointer.check_node_or_value">[docs]</a>    <span class="k">def</span> <span class="nf">check_node_or_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jsondata</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Checks the existence of the corresponding node</span>
<span class="sd">        within the JSON document.</span>

<span class="sd">        Args:</span>
<span class="sd">            **jsondata**:</span>
<span class="sd">                A valid JSON data node.</span>

<span class="sd">            **parent**:</span>
<span class="sd">                If *True* returns the parent node of the pointed value.</span>

<span class="sd">        Returns:</span>
<span class="sd">            True or False</span>

<span class="sd">        Raises:</span>
<span class="sd">            JSONPointerError:</span>

<span class="sd">            pass-through</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span> <span class="o">==</span> <span class="p">[]:</span>  <span class="c1"># special RFC6901, whole document</span>
            <span class="k">return</span> <span class="ow">not</span> <span class="p">(</span><span class="ow">not</span> <span class="n">jsondata</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]:</span>  <span class="c1"># special RFC6901, &#39;/&#39; empty top-tag</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="ow">not</span> <span class="p">(</span> <span class="ow">not</span> <span class="n">jsondata</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isvalid_nodetype</span><span class="p">(</span><span class="n">jsondata</span><span class="p">):</span>
            <span class="c1"># concrete info for debugging for type mismatch</span>
            <span class="k">raise</span> <span class="n">JSONPointerError</span><span class="p">(</span><span class="s2">&quot;Invalid nodetype parameter:&quot;</span> <span class="o">+</span>
                                       <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">jsondata</span><span class="p">)))</span>

        <span class="k">if</span> <span class="n">parent</span><span class="p">:</span>
            <span class="n">_s</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_s</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">_s</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">jsondata</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
                <span class="n">jsondata</span> <span class="o">=</span> <span class="n">jsondata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">jsondata</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">False</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">jsondata</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">jsondata</span> <span class="o">=</span> <span class="n">jsondata</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">jsondata</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isvalid_nodetype</span><span class="p">(</span><span class="n">jsondata</span><span class="p">):</span>
            <span class="c1"># concrete info for debugging for type mismatch</span>
            <span class="k">raise</span> <span class="n">JSONPointerError</span><span class="p">(</span><span class="s2">&quot;Invalid path nodetype:&quot;</span> <span class="o">+</span>
                                       <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">jsondata</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node</span> <span class="o">=</span> <span class="n">jsondata</span>  <span class="c1"># cache for reuse</span>
        <span class="k">return</span> <span class="kc">True</span></div>

    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates a copy of self.</span>

<span class="sd">        Args:</span>
<span class="sd">            None</span>

<span class="sd">            kargs:</span>
<span class="sd">                **deep**:</span>
<span class="sd">                    When *True* creates a deep copy,</span>
<span class="sd">                    else shallow.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A copy of self.</span>

<span class="sd">        Raises:</span>
<span class="sd">            pass-through</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">JSONPointer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">copydata</span><span class="o">=</span><span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;deep&#39;</span><span class="p">,</span> <span class="n">C_DEEP</span><span class="p">))</span>

<div class="viewcode-block" id="JSONPointer.copy_path_list"><a class="viewcode-back" href="../../jsondata_jsonpointer_doc.html#jsondata.jsonpointer.JSONPointer.copy_path_list">[docs]</a>    <span class="k">def</span> <span class="nf">copy_path_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a deep copy of the objects pointer path list.</span>

<span class="sd">        Args:</span>
<span class="sd">            **parent**:</span>
<span class="sd">                The parent node of the pointer path.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A copy of the path list.</span>

<span class="sd">        Raises:</span>
<span class="sd">            none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span> <span class="o">==</span> <span class="p">[]:</span>  <span class="c1"># special RFC6901, whole document</span>
            <span class="k">return</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="bp">self</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]:</span>  <span class="c1"># special RFC6901, &#39;/&#39; empty top-tag</span>
            <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">parent</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span> <span class="n">s</span><span class="p">[:]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span> <span class="n">s</span><span class="p">[:]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[:]]</span></div>

<span class="c1">#         if parent:</span>
<span class="c1">#             return map(lambda s: s[:], self[:-1])</span>
<span class="c1">#         else:</span>
<span class="c1">#             return map(lambda s: s[:], self[:])</span>

    <span class="k">def</span> <span class="nf">__deepcopy__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">memo</span><span class="p">):</span>
        <span class="c1"># return JSONPointer(self[:], copydata=C_DEEP)</span>
        <span class="k">return</span> <span class="n">JSONPointer</span><span class="p">(</span><span class="bp">self</span><span class="p">[:])</span>
    
    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">V3K</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">JSONPointerError</span><span class="p">(</span>
                    <span class="s2">&quot;Unknown attribute: &quot;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                    <span class="p">)</span> <span class="c1"># from None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">JSONPointerError</span><span class="p">(</span>
                    <span class="s2">&quot;Unknown attribute: &quot;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                    <span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_key</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the resulting key for the pointer. In case</span>
<span class="sd">        of a relative pointer as resulting from the processing</span>
<span class="sd">        of the relative pointer and the starting node.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__isrel</span><span class="p">:</span>  <span class="c1"># pointer in accordance to rfc6901</span>
            <span class="k">if</span> <span class="bp">self</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># data is not initialized at all - basically impossible - anyhow</span>
                <span class="k">return</span> <span class="kc">None</span>

            <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="p">:</span>
                <span class="c1"># whole document - RFC6901</span>
                <span class="k">return</span> <span class="s1">&#39;&#39;</span>

            <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1">#</span>
        <span class="c1"># relative draft-1/2018</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__isrelpathrequest</span><span class="p">:</span>  <span class="c1"># is get relpath request</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="p">:</span>  <span class="c1"># special - whole rel document - integer only</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__start</span><span class="p">:</span>  <span class="c1"># no offset</span>
                    <span class="k">return</span> <span class="kc">None</span>
                <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__start</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># resulting offset only</span>
            <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># a valid pointer</span>

        <span class="k">else</span><span class="p">:</span>  <span class="c1"># is get-key/index - request</span>
            <span class="c1"># self is None in any case</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__start</span><span class="p">:</span>  <span class="c1"># the whole document</span>
                <span class="k">return</span> <span class="kc">None</span>

            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__start</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">__relupidx</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># the whole document - fs-like for index-overflow</span>
                <span class="k">return</span> <span class="kc">None</span>

            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__start</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__start</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">__relupidx</span><span class="p">])</span>

<div class="viewcode-block" id="JSONPointer.get_node_and_child"><a class="viewcode-back" href="../../jsondata_jsonpointer_doc.html#jsondata.jsonpointer.JSONPointer.get_node_and_child">[docs]</a>    <span class="k">def</span> <span class="nf">get_node_and_child</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jsondata</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a tuple containing the parent node and self as the child.</span>

<span class="sd">        Args:</span>
<span class="sd">            **jsondata**:</span>
<span class="sd">                A valid JSON data node.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The the tuple: ::</span>

<span class="sd">               (p, c):</span>
<span class="sd">                  p: Node reference to parent container.</span>
<span class="sd">                  c: Node reference to self as the child.</span>

<span class="sd">        Raises:</span>
<span class="sd">            JSONPointerError:</span>

<span class="sd">            pass=through</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="p">(</span><span class="n">jsondata</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span> <span class="c1"># get parent</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">n</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">n</span><span class="p">,</span> <span class="bp">self</span><span class="p">(</span><span class="n">jsondata</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">IndexError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">n</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">raise</span> <span class="n">JSONPointerError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__raw</span><span class="p">)</span></div>

<div class="viewcode-block" id="JSONPointer.get_node_and_key"><a class="viewcode-back" href="../../jsondata_jsonpointer_doc.html#jsondata.jsonpointer.JSONPointer.get_node_and_key">[docs]</a>    <span class="k">def</span> <span class="nf">get_node_and_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jsondata</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a tuple containing the parent node and the key of current.</span>

<span class="sd">        Args:</span>
<span class="sd">            **jsondata**:</span>
<span class="sd">                A valid JSON data node.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The the tuple: ::</span>

<span class="sd">               (n, k):</span>
<span class="sd">                  n: Node reference to parent container.</span>
<span class="sd">                  k: Key for self as the child entry:</span>

<span class="sd">                     k := (</span>
<span class="sd">                          &lt;list-index&gt;</span>
<span class="sd">                        | &lt;dict-key&gt;</span>
<span class="sd">                        | None</span>
<span class="sd">                     )</span>

<span class="sd">                     list-index: &#39;int&#39;</span>
<span class="sd">                     dict-key: &#39;UTF-8&#39;</span>
<span class="sd">                     None: &quot;for root-node&quot;</span>

<span class="sd">        Raises:</span>
<span class="sd">            JSONPointerError:</span>

<span class="sd">            pass-through</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="p">(</span><span class="n">jsondata</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">n</span><span class="p">,</span> <span class="kc">None</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">n</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">IndexError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">n</span><span class="p">,</span> <span class="kc">None</span>
        <span class="k">raise</span> <span class="n">JSONPointerError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__raw</span><span class="p">)</span></div>

<div class="viewcode-block" id="JSONPointer.get_node_value"><a class="viewcode-back" href="../../jsondata_jsonpointer_doc.html#jsondata.jsonpointer.JSONPointer.get_node_value">[docs]</a>    <span class="k">def</span> <span class="nf">get_node_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jsondata</span><span class="p">,</span> <span class="n">cp</span><span class="o">=</span><span class="n">C_SHALLOW</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets the copy of the corresponding node.</span>
<span class="sd">        Relies on the standard package &#39;json&#39;.</span>

<span class="sd">        Args:</span>
<span class="sd">            **jsondata**:</span>
<span class="sd">                A valid JSON data node.</span>

<span class="sd">            **cp**:</span>
<span class="sd">                Type of returned copy. ::</span>

<span class="sd">                   cp := (</span>
<span class="sd">                        C_DEEP</span>
<span class="sd">                      | C_REF</span>
<span class="sd">                      | C_SHALLOW</span>
<span class="sd">                   )</span>

<span class="sd">            kargs:</span>
<span class="sd">                **valtype**:</span>
<span class="sd">                    Type of requested value.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The copy of the node, see option *copy*.</span>

<span class="sd">        Raises:</span>
<span class="sd">            JSONPointerError</span>

<span class="sd">            pass-through</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">valtype</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;valtype&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="n">_resroot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_pointer</span><span class="p">(</span><span class="n">jsondata</span><span class="p">,</span> <span class="n">superpose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">_resroot</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># basically impossible - anyhow</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">_resroot</span><span class="p">:</span>  <span class="c1"># == [] : special RFC6901, whole document</span>
            <span class="k">return</span> <span class="n">jsondata</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">_resroot</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">jsondata</span>  <span class="c1"># same as previous</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">_resroot</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">_resroot</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">jsondata</span>  <span class="c1"># the whole document</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">jsondata</span><span class="p">[</span><span class="n">_resroot</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>  <span class="c1">#</span>
            <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="ne">IndexError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">V3K</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">JSONPointerError</span><span class="p">(</span>
                        <span class="s2">&quot;Node(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;):&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; of &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                        <span class="c1">#</span>
                        <span class="c1"># TODO: update doctool for python3 introspection</span>
                        <span class="c1">#</span>
                        <span class="p">)</span> <span class="c1"># from None</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">JSONPointerError</span><span class="p">(</span>
                        <span class="s2">&quot;Node(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;):&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; of &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                        <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isvalid_nodetype</span><span class="p">(</span><span class="n">jsondata</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">JSONPointerError</span><span class="p">(</span><span class="s2">&quot;Invalid nodetype parameter:&quot;</span> <span class="o">+</span>
                                       <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">jsondata</span><span class="p">)))</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">_resroot</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">jsondata</span><span class="p">,</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">JSONData</span><span class="p">)):</span>
                    <span class="k">break</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">jsondata</span> <span class="o">=</span> <span class="n">jsondata</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>  <span class="c1"># want the exception</span>
                <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                    <span class="n">jsondata</span> <span class="o">=</span> <span class="n">jsondata</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)]</span>  <span class="c1"># still want the exception</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">V3K</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">JSONPointerError</span><span class="p">(</span>
                    <span class="s2">&quot;Node(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;):&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; of &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                        <span class="c1">#</span>
                        <span class="c1"># TODO: update doctool for python3 introspection</span>
                        <span class="c1">#</span>
                    <span class="p">)</span> <span class="c1"># from None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">JSONPointerError</span><span class="p">(</span>
                    <span class="s2">&quot;Node(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;):&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; of &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                    <span class="p">)</span>

        <span class="k">if</span> <span class="n">valtype</span><span class="p">:</span>  <span class="c1"># requested value type</span>
            <span class="c1"># fix type ambiguity for numeric</span>
            <span class="k">if</span> <span class="n">valtype</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">jsondata</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
                    <span class="n">jsondata</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">jsondata</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">valtype</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">jsondata</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
                    <span class="n">jsondata</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">jsondata</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">(</span><span class="n">jsondata</span><span class="p">)</span> <span class="ow">is</span> <span class="n">valtype</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">JSONPointerError</span><span class="p">(</span><span class="s2">&quot;Invalid path value type:&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                    <span class="nb">type</span><span class="p">(</span><span class="n">valtype</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot; != &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">jsondata</span><span class="p">)))</span>

        <span class="k">else</span><span class="p">:</span>  <span class="c1"># in general valid value types - RFC4729,RFC7951</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">isvalid_nodetype</span><span class="p">(</span><span class="n">jsondata</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">JSONPointerError</span><span class="p">(</span>
                    <span class="s2">&quot;Invalid path nodetype:&quot;</span>
                    <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">jsondata</span><span class="p">)))</span>

        <span class="c1"># self.node = jsondata  # cache for reuse</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">jsondata</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">list</span><span class="p">,):</span>
            <span class="k">if</span> <span class="n">cp</span> <span class="o">==</span> <span class="n">C_SHALLOW</span><span class="p">:</span>  <span class="c1"># default</span>
                <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">jsondata</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">cp</span> <span class="o">==</span> <span class="n">C_DEEP</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">jsondata</span><span class="p">)</span>

        <span class="c1"># C_REF</span>
        <span class="k">return</span> <span class="n">jsondata</span></div>

    <span class="k">def</span> <span class="nf">get_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jsondata</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the existing node for the pointer,</span>
<span class="sd">        calls transparently *JSONPointer.__call__*.</span>

<span class="sd">        Args:</span>
<span class="sd">            **jsondata**:</span>
<span class="sd">                A valid JSON data node.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The node reference.</span>

<span class="sd">        Raises:</span>
<span class="sd">            JSONPointerError:</span>

<span class="sd">            pass-through</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__call__</span><span class="p">(</span><span class="n">jsondata</span><span class="p">)</span>

<div class="viewcode-block" id="JSONPointer.get_node_exist"><a class="viewcode-back" href="../../jsondata_jsonpointer_doc.html#jsondata.jsonpointer.JSONPointer.get_node_exist">[docs]</a>    <span class="k">def</span> <span class="nf">get_node_exist</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jsondata</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns two parts, the exisitng node for valid part of</span>
<span class="sd">        the pointer, and the remaining part of the pointer for</span>
<span class="sd">        the non-existing sub-path.</span>

<span class="sd">        This method works similar to the &#39;evaluate&#39; method, whereas it</span>
<span class="sd">        handles partial valid path pointers, which may also include</span>
<span class="sd">        a &#39;-&#39; in accordance to RFC6902.</span>

<span class="sd">        Therefore the non-ambiguous part of the pointer is resolved,</span>
<span class="sd">        and returned with the remaining part for a newly create.</span>
<span class="sd">        Thus this method is in particular foreseen to support the</span>
<span class="sd">        creation of new sub data structures.</span>

<span class="sd">        The &#39;evaluate&#39; method therefore returns a list of two elements,</span>
<span class="sd">        the first is the node reference, the second the list of the</span>
<span class="sd">        remaining path pointer components. The latter may be empty in</span>
<span class="sd">        case of a fully valid pointer.</span>


<span class="sd">        Args:</span>
<span class="sd">            **jsondata**:</span>
<span class="sd">                A valid JSON data node.</span>

<span class="sd">            **parent**:</span>
<span class="sd">                Return the parent node of the pointed value.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The node reference, and the remaining part.</span>
<span class="sd">            ret:=(node, [&lt;remaining-path-components-list&gt;])</span>

<span class="sd">        Raises:</span>
<span class="sd">            JSONPointerError:</span>
<span class="sd">            forwarded from json</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">super</span><span class="p">(</span><span class="n">JSONPointer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__eq__</span><span class="p">([]):</span>  <span class="c1"># special RFC6901, whole document</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">jsondata</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">super</span><span class="p">(</span><span class="n">JSONPointer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__eq__</span><span class="p">([</span><span class="s1">&#39;&#39;</span><span class="p">]):</span>  <span class="c1"># special RFC6901, &#39;/&#39; empty top-tag</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">jsondata</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">],</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">jsondata</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="n">JSONData</span><span class="p">):</span>
            <span class="c1"># concrete info for debugging for type mismatch</span>
            <span class="k">raise</span> <span class="n">JSONPointerError</span><span class="p">(</span><span class="s2">&quot;Invalid nodetype parameter:&quot;</span> <span class="o">+</span>
                                       <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">jsondata</span><span class="p">)))</span>
        <span class="n">remaining</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">parent</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">remaining</span> <span class="o">=</span> <span class="n">x</span>
                    <span class="c1"># want the exception, the keys within the process has to match</span>
                    <span class="n">jsondata</span> <span class="o">=</span> <span class="n">jsondata</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                    <span class="n">remaining</span> <span class="o">=</span> <span class="n">x</span>
                    <span class="c1"># want the exception, the keys within the process has to match</span>
                    <span class="n">jsondata</span> <span class="o">=</span> <span class="n">jsondata</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">parent</span><span class="p">:</span>
                <span class="n">remaining</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">remaining</span><span class="p">):</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">remaining</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">remaining</span><span class="p">):]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">remaining</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">jsondata</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="c1"># concrete info for debugging for type mismatch</span>
            <span class="k">raise</span> <span class="n">JSONPointerError</span><span class="p">(</span><span class="s2">&quot;Invalid path nodetype:&quot;</span> <span class="o">+</span>
                                       <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">jsondata</span><span class="p">)))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node</span> <span class="o">=</span> <span class="n">jsondata</span>  <span class="c1"># cache for reuse</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">jsondata</span><span class="p">,</span> <span class="n">remaining</span><span class="p">,)</span></div>

<div class="viewcode-block" id="JSONPointer.get_path_list"><a class="viewcode-back" href="../../jsondata_jsonpointer_doc.html#jsondata.jsonpointer.JSONPointer.get_path_list">[docs]</a>    <span class="k">def</span> <span class="nf">get_path_list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets for the corresponding path list of the object pointer for</span>
<span class="sd">        in-memory access on the data of the &#39;json&#39; package.</span>

<span class="sd">        Args:</span>
<span class="sd">            none</span>

<span class="sd">        Returns:</span>
<span class="sd">            The path list.</span>

<span class="sd">        Raises:</span>
<span class="sd">            none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">__debug__</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">debug</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="JSONPointer.get_path_list_and_key"><a class="viewcode-back" href="../../jsondata_jsonpointer_doc.html#jsondata.jsonpointer.JSONPointer.get_path_list_and_key">[docs]</a>    <span class="k">def</span> <span class="nf">get_path_list_and_key</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets for the corresponding path list of the object pointer for in-memory access on the data of the &#39;json&#39; package.</span>

<span class="sd">        Args:</span>
<span class="sd">            none</span>

<span class="sd">        Returns:</span>
<span class="sd">            The path list.</span>

<span class="sd">        Raises:</span>
<span class="sd">            none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[],</span> <span class="bp">self</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[],</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="JSONPointer.get_pointer"><a class="viewcode-back" href="../../jsondata_jsonpointer_doc.html#jsondata.jsonpointer.JSONPointer.get_pointer">[docs]</a>    <span class="k">def</span> <span class="nf">get_pointer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jsondata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets the object pointer in compliance to RFC6901</span>
<span class="sd">        or relative pointer/draft-01/2018.</span>

<span class="sd">        The result is by default the assigned pointer itself without</span>
<span class="sd">        verification. Similar in case of a relative pointer the start</span>
<span class="sd">        offset is ignored by default and no verification is performed.</span>

<span class="sd">        The following options modify this behaviour:</span>

<span class="sd">        * superpose - superposes the *startrel* offset with the pointer</span>
<span class="sd">        * verify - verifies the actual existence of the nodes and/or</span>
<span class="sd">          intermediate nodes</span>

<span class="sd">        The options could be applied combined.</span>

<span class="sd">        Args:</span>
<span class="sd">            kargs:</span>
<span class="sd">                **returntype**:</span>
<span class="sd">                    Defines the return type. ::</span>

<span class="sd">                       returntype := (</span>
<span class="sd">                            RT_DEFAULT     | &#39;default&#39;</span>
<span class="sd">                          | RT_LST         | &#39;list&#39;      | list</span>
<span class="sd">                          | RT_JSONPOINTER | &#39;jpointer&#39;</span>
<span class="sd">                       )</span>

<span class="sd">                **superpose**:</span>
<span class="sd">                    Is only relevant for relative paths. Superposes the offset</span>
<span class="sd">                    *startrel* with the pointer into the resulting final pointer.</span>
<span class="sd">                    By default nodes are not verified, see *verify* parameter.</span>

<span class="sd">                    default := True</span>

<span class="sd">                **verify**:</span>
<span class="sd">                    Verifies the &quot;road&quot; of the superposed pointers. ::</span>

<span class="sd">                       verify := (</span>
<span class="sd">                            V_DEFAULT | &#39;default&#39;</span>
<span class="sd">                          | V_NONE    | &#39;none&#39;    | None    # no checks at all</span>
<span class="sd">                          | V_FINAL   | &#39;final&#39;             # checks final result only</span>
<span class="sd">                          | V_STEPS   | &#39;steps&#39;             # checks each intermediate directory</span>
<span class="sd">                       )</span>

<span class="sd">                    default := None</span>
<span class="sd">        Returns:</span>
<span class="sd">            The new pointer in a choosen format, see *returntype*.</span>

<span class="sd">        Raises:</span>
<span class="sd">            none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">returntype</span> <span class="o">=</span> <span class="n">rtypes2num</span><span class="p">[</span><span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;returntype&#39;</span><span class="p">)]</span>
        <span class="n">verify</span> <span class="o">=</span> <span class="n">verify2num</span><span class="p">[</span><span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;verify&#39;</span><span class="p">)]</span>

        <span class="n">superpose</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;superpose&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

        <span class="c1"># returned pointer</span>
        <span class="n">_ptr</span> <span class="o">=</span> <span class="n">JSONPointer</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__isrel</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">superpose</span><span class="p">:</span>
                <span class="c1">#    - superpose the rfc6901 and the startrel pointers</span>

                <span class="c1">#</span>
                <span class="c1"># first calculate by ignoring jsondata,</span>
                <span class="c1"># but checks consistency of integer-prefix</span>
                <span class="c1"># and start-node-pointer</span>
                <span class="c1">#</span>

                <span class="c1"># depth from pointer root to start with __startrel,</span>
                <span class="c1"># calc whether int-prefix larger than the length of the offset</span>
                <span class="n">ix</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__startrel</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">__relupidx</span>
                <span class="k">if</span> <span class="n">ix</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">JSONPointerError</span><span class="p">(</span>
                        <span class="s2">&quot;offset is shorter than integer-index startrel:</span><span class="si">%s</span><span class="s2"> - int-idx=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__startrel</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">__relupidx</span><span class="p">)</span>
                        <span class="p">)</span>

                <span class="k">if</span> <span class="n">ix</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">_ptr</span> <span class="o">=</span> <span class="bp">self</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">_ptr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__startrel</span><span class="p">[:</span><span class="n">ix</span><span class="p">]</span>
                    <span class="n">_ptr</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

                <span class="c1">#</span>
                <span class="c1"># now perform optional verification</span>
                <span class="c1">#</span>

                <span class="k">if</span> <span class="n">verify</span> <span class="o">&amp;</span> <span class="n">V_FINAL</span><span class="p">:</span>
                    <span class="c1"># check final only</span>
                    <span class="n">_chk</span> <span class="o">=</span> <span class="n">JSONPointer</span><span class="p">(</span><span class="n">_ptr</span><span class="p">)(</span><span class="n">jsondata</span><span class="p">)</span>

                <span class="k">elif</span> <span class="n">verify</span> <span class="o">&amp;</span> <span class="n">V_STEPS</span><span class="p">:</span>
                    <span class="c1">#</span>
                    <span class="c1"># check intermediate anchors by stepwise verification</span>
                    <span class="c1">#</span>

                    <span class="c1"># check offset pointer , and get node</span>
                    <span class="n">_chk</span> <span class="o">=</span> <span class="n">JSONPointer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__startrel</span><span class="p">)(</span><span class="n">jsondata</span><span class="p">)</span>

                    <span class="c1"># check int-prefix ends within document, and get node</span>
                    <span class="n">_chk</span> <span class="o">=</span> <span class="n">JSONPointer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__relupidx</span> <span class="o">+</span> <span class="s1">&#39;#&#39;</span><span class="p">)(</span><span class="n">_chk</span><span class="p">)</span>

                    <span class="c1"># check pointer ends within document, and get node</span>
                    <span class="n">_chk</span> <span class="o">=</span> <span class="n">JSONPointer</span><span class="p">(</span><span class="bp">self</span><span class="p">)(</span><span class="n">_chk</span><span class="p">)</span>

        <span class="c1">#</span>
        <span class="c1"># cast return type</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="n">returntype</span> <span class="o">&amp;</span> <span class="n">RT_JSONPOINTER</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_ptr</span>
        <span class="k">elif</span> <span class="n">returntype</span> <span class="o">&amp;</span> <span class="n">RT_LST</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">_ptr</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">JSONPointerError</span><span class="p">(</span><span class="s2">&quot;Unknown return type: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">returntype</span><span class="p">))</span></div>

<div class="viewcode-block" id="JSONPointer.get_pointer_and_key"><a class="viewcode-back" href="../../jsondata_jsonpointer_doc.html#jsondata.jsonpointer.JSONPointer.get_pointer_and_key">[docs]</a>    <span class="k">def</span> <span class="nf">get_pointer_and_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jsondata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the resulting pointer and key from the processing of</span>
<span class="sd">        the pointer and the optional starting node *stratrel*.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_pointer</span><span class="p">(</span><span class="n">jsondata</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">)</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">ret</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">ret</span><span class="p">,</span> <span class="n">k</span><span class="p">,)</span></div>

<div class="viewcode-block" id="JSONPointer.get_pointer_str"><a class="viewcode-back" href="../../jsondata_jsonpointer_doc.html#jsondata.jsonpointer.JSONPointer.get_pointer_str">[docs]</a>    <span class="k">def</span> <span class="nf">get_pointer_str</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jsondata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets the objects pointer string in compliance to RFC6901</span>
<span class="sd">        or relative pointer/draft-01/2018.</span>

<span class="sd">        The result is by default the assigned pointer itself without</span>
<span class="sd">        verification. Similar in case of a relative pointer the start</span>
<span class="sd">        offset is ignored by default and no verification is performed.</span>

<span class="sd">        The following options modify this behaviour:</span>

<span class="sd">        * superpose - superposes the *startrel* offset with the pointer</span>
<span class="sd">        * verify - verifies the actual existence of the nodes and/or</span>
<span class="sd">          intermediate nodes</span>

<span class="sd">        The options could be applied combined.</span>

<span class="sd">        Args:</span>
<span class="sd">            kargs:</span>
<span class="sd">                **forcenotation**:</span>
<span class="sd">                    Force the output notation for string representation to: ::</span>

<span class="sd">                       forcenotation := (</span>
<span class="sd">                            NOTATION_NATIVE           # original format with unescape</span>
<span class="sd">                          | NOTATION_JSON             # transform to resulting pointer</span>
<span class="sd">                          | NOTATION_HTTP_FRAGMENT    # return a fragment with encoding</span>
<span class="sd">                          | NOTATION_JSON_REL         # resulting relative pointer</span>
<span class="sd">                          | NOTATION_RAW              # raw input</span>
<span class="sd">                       )</span>

<span class="sd">                       default := NOTATION_NATIVE</span>

<span class="sd">                    **REMINDER**: Applicable for return type string only.</span>

<span class="sd">                **superpose**:</span>
<span class="sd">                    Is only relevant for relative paths. Superposes the offset</span>
<span class="sd">                    *startrel* with the pointer into the resulting final pointer.</span>
<span class="sd">                    By default nodes are not verified, see *verify* parameter.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The new pointer in a choosen format, see *returntype*.</span>

<span class="sd">        Raises:</span>
<span class="sd">            none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">forcenotation</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;forcenotation&#39;</span><span class="p">)</span>
        <span class="n">superpose</span> <span class="o">=</span> <span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;superpose&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="c1">#</span>
        <span class="c1"># notation is only relevant for string representation,</span>
        <span class="c1"># while the internal technical representation is almost neutral</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="n">forcenotation</span> <span class="o">==</span> <span class="n">NOTATION_JSON</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__isrel</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__isrelpathrequest</span><span class="p">:</span>
                    <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__start</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__start</span> <span class="o">+</span> <span class="s1">&#39;#&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">super</span><span class="p">(</span><span class="n">JSONPointer</span><span class="p">,</span><span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__eq__</span><span class="p">([]):</span>
                    <span class="k">return</span> <span class="s1">&#39;&quot;&quot;&#39;</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span>

        <span class="k">elif</span> <span class="n">forcenotation</span> <span class="o">==</span> <span class="n">NOTATION_HTTP_FRAGMENT</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__isrel</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__isrelpathrequest</span><span class="p">:</span>
                    <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__start</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__start</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="s1">&#39;/&#39;</span>

        <span class="k">elif</span> <span class="n">forcenotation</span> <span class="o">==</span> <span class="n">NOTATION_JSON_REL</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__isrel</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__isrelpathrequest</span><span class="p">:</span>
                    <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__start</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__start</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="s1">&#39;/&#39;</span>

        <span class="k">else</span><span class="p">:</span>  <span class="c1"># NOTATION_NATIVE</span>
            <span class="c1">#</span>
            <span class="c1"># set the appropriate prefix:</span>
            <span class="c1">#   rfc6901-pointer, rfc6901-uri-fragment-pointer,</span>
            <span class="c1">#   relpath-draft-1</span>
            <span class="c1">#</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__isfragment</span><span class="p">:</span>  <span class="c1"># rfc6901 - uri-fragment</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="p">:</span>  <span class="c1"># special - whole document</span>
                    <span class="n">ret</span> <span class="o">=</span> <span class="s1">&#39;#&#39;</span>
                <span class="k">else</span><span class="p">:</span>  <span class="c1"># a subpath</span>
                    <span class="n">ret</span> <span class="o">=</span> <span class="s1">&#39;#/&#39;</span>

            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">__isrel</span><span class="p">:</span>  <span class="c1"># relpointer</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__isrelpathrequest</span><span class="p">:</span>  <span class="c1"># is get relpath request</span>
                    <span class="k">if</span> <span class="n">superpose</span><span class="p">:</span>
                        <span class="n">ix</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__startrel</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">__relupidx</span>
                        <span class="k">if</span> <span class="n">ix</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="n">JSONPointerError</span><span class="p">(</span>
                                <span class="s2">&quot;offset is shorter than integer-index startrel:</span><span class="si">%s</span><span class="s2"> - int-idx=</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span>
                                <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__startrel</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">__relupidx</span><span class="p">)</span>
                                <span class="p">)</span>

                        <span class="k">if</span> <span class="n">ix</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="n">_ptr</span> <span class="o">=</span> <span class="bp">self</span>

                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">_ptr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__startrel</span><span class="p">[:</span><span class="n">ix</span><span class="p">]</span>
                            <span class="n">_ptr</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">_ptr</span> <span class="o">=</span> <span class="bp">self</span>

                    <span class="k">if</span> <span class="nb">super</span><span class="p">(</span><span class="n">JSONPointer</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__eq__</span><span class="p">([]):</span>
                        <span class="k">if</span> <span class="n">_ptr</span><span class="p">:</span>
                            <span class="k">return</span> <span class="n">unicode</span><span class="p">(</span><span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">unicode</span><span class="p">,</span> <span class="n">_ptr</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">return</span> <span class="n">unicode</span><span class="p">(</span><span class="s1">&#39;&quot;&quot;&#39;</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">return</span> <span class="n">unicode</span><span class="p">(</span><span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">unicode</span><span class="p">,</span> <span class="n">_ptr</span><span class="p">)))</span>

                <span class="k">else</span><span class="p">:</span>  <span class="c1"># is get-key/index - request</span>
                    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__relupidx</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;#&#39;</span>

            <span class="k">else</span><span class="p">:</span>  <span class="c1"># rfc6901 - in-document-absolute pointer</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="p">:</span>  <span class="c1"># ==[] : special RFC6901, whole document</span>
                    <span class="k">return</span> <span class="s1">&#39;&#39;</span>
                <span class="n">ret</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>  <span class="c1"># special RFC6901, &#39;/&#39; empty top-tag</span>
                    <span class="k">return</span> <span class="s1">&#39;/&#39;</span>


        <span class="k">return</span> <span class="n">unicode</span><span class="p">(</span><span class="n">ret</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">unicode</span><span class="p">,</span> <span class="bp">self</span><span class="p">)))</span></div>

<div class="viewcode-block" id="JSONPointer.get_raw"><a class="viewcode-back" href="../../jsondata_jsonpointer_doc.html#jsondata.jsonpointer.JSONPointer.get_raw">[docs]</a>    <span class="k">def</span> <span class="nf">get_raw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets the objects raw 6901-pointer.</span>

<span class="sd">        Args:</span>
<span class="sd">            none</span>

<span class="sd">        Returns:</span>
<span class="sd">            The raw path.</span>

<span class="sd">        Raises:</span>
<span class="sd">            none</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__raw</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="JSONPointer.get_relupidx"><a class="viewcode-back" href="../../jsondata_jsonpointer_doc.html#jsondata.jsonpointer.JSONPointer.get_relupidx">[docs]</a>    <span class="k">def</span> <span class="nf">get_relupidx</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the resulting integer prefix.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__relupidx</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="JSONPointer.get_start"><a class="viewcode-back" href="../../jsondata_jsonpointer_doc.html#jsondata.jsonpointer.JSONPointer.get_start">[docs]</a>    <span class="k">def</span> <span class="nf">get_start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the resulting start pointer after the</span>
<span class="sd">        application of the integer prefix.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__start</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="JSONPointer.get_startrel"><a class="viewcode-back" href="../../jsondata_jsonpointer_doc.html#jsondata.jsonpointer.JSONPointer.get_startrel">[docs]</a>    <span class="k">def</span> <span class="nf">get_startrel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the raw start pointer.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__startrel</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="JSONPointer.evaluate"><a class="viewcode-back" href="../../jsondata_jsonpointer_doc.html#jsondata.jsonpointer.JSONPointer.evaluate">[docs]</a>    <span class="k">def</span> <span class="nf">evaluate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jsondata</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets the value resulting from the current pointer.</span>

<span class="sd">        Args:</span>
<span class="sd">            **jsondata**:</span>
<span class="sd">                A JSON data node. ::</span>

<span class="sd">                   jsondata := (</span>
<span class="sd">                       JSONData</span>
<span class="sd">                       | list</span>
<span class="sd">                       | dict</span>
<span class="sd">                       )</span>

<span class="sd">            **parent**:</span>
<span class="sd">                Return the parent node of the pointed value.</span>
<span class="sd">                When parent is selected, the pointed child node</span>
<span class="sd">                is not verified.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The referenced value.</span>

<span class="sd">        Raises:</span>
<span class="sd">            JSONPointerError:</span>

<span class="sd">            pass-through</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#</span>
        <span class="c1"># calc starting node</span>
        <span class="c1">#</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__isrel</span><span class="p">:</span>
            <span class="c1"># relative draft-1/2018</span>

            <span class="c1"># check whether pointed to a valid node</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__startrel</span><span class="o">.</span><span class="n">check_node_or_value</span><span class="p">(</span><span class="n">jsondata</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">JSONPointerError</span><span class="p">(</span><span class="s1">&#39;node does not exist:&quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__startrel</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span><span class="p">)</span>

            <span class="c1"># pointer is getrelpath request</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__isrelpathrequest</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__start</span><span class="p">:</span>  <span class="c1"># already pre-calculated</span>
                    <span class="n">_startnode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__start</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">jsondata</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">_startnode</span> <span class="o">=</span> <span class="n">jsondata</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="p">:</span>  <span class="c1"># special - whole rel document - integer only</span>
                    <span class="k">return</span> <span class="n">_startnode</span>

            <span class="c1"># pointer is get-key/index - request</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__start</span><span class="o">.</span><span class="n">get_key</span><span class="p">()</span>

        <span class="k">elif</span> <span class="bp">self</span> <span class="o">==</span> <span class="p">[]:</span>
            <span class="c1"># special RFC6901, whole document</span>
            <span class="k">return</span> <span class="n">jsondata</span>

        <span class="c1">#</span>
        <span class="c1"># REMEMBER: special RFC6901, &#39;/&quot;&quot;&#39; empty top-tag</span>
        <span class="c1">#           section 5 / pg. 5</span>
        <span class="c1">#</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="bp">self</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">jsondata</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">JSONPointerError</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;Non-existent node(see RFC6901 - chap 5): &#39;/&quot;&quot;&#39;&quot;&quot;&quot;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># a standard rfc6901 pointer</span>
            <span class="n">_startnode</span> <span class="o">=</span> <span class="n">jsondata</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">_startnode</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">dict</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="n">JSONData</span><span class="p">):</span>
            <span class="c1"># concrete info for debugging for type mismatch</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__isrel</span><span class="p">:</span>

                <span class="k">raise</span> <span class="n">JSONPointerError</span><span class="p">(</span>
                    <span class="s2">&quot;Invalid nodetype parameter: </span><span class="si">%s</span><span class="s2">&quot;</span>
                    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  pointer   = </span><span class="si">%s</span><span class="s2">&quot;</span>
                    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  startrel  = </span><span class="si">%s</span><span class="s2">&quot;</span>
                    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  start     = </span><span class="si">%s</span><span class="s2">&quot;</span>
                    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  jsondata  = </span><span class="si">%s</span><span class="s2">&quot;</span>
                    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  startnode = </span><span class="si">%s</span><span class="s2">&quot;</span>
                    <span class="o">%</span> <span class="p">(</span>
                        <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">_startnode</span><span class="p">)),</span>
                        <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span>
                        <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__startrel</span><span class="p">),</span>
                        <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__start</span><span class="p">),</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">jsondata</span><span class="p">),</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">_startnode</span><span class="p">),</span>
                    <span class="p">))</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">JSONPointerError</span><span class="p">(</span>
                    <span class="s2">&quot;Invalid nodetype parameter:&quot;</span> <span class="o">+</span>
                    <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">_startnode</span><span class="p">)))</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">parent</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="c1"># want the exception, the keys within the process has to match</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">_startnode</span> <span class="o">=</span> <span class="n">_startnode</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
                    <span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s1">&#39;-&#39;</span><span class="p">:</span>
                            <span class="n">_startnode</span> <span class="o">=</span> <span class="n">_startnode</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="c1"># special python - reverse index</span>
                                <span class="n">_startnode</span> <span class="o">=</span> <span class="n">_startnode</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)]</span>
                            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                                <span class="c1"># now safe to give it up</span>
                                <span class="c1"># raise e</span>
                                <span class="k">raise</span> <span class="n">JSONPointerError</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="c1"># standard index 0&lt;=x&lt;infinite</span>
                        <span class="n">_startnode</span> <span class="o">=</span> <span class="n">_startnode</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>

                    <span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="s1">&#39;-&#39;</span><span class="p">:</span>
                            <span class="c1"># special rfc6901</span>
                            <span class="n">_startnode</span> <span class="o">=</span> <span class="n">_startnode</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="c1"># special python - reverse index</span>
                                <span class="n">_startnode</span> <span class="o">=</span> <span class="n">_startnode</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)]</span>
                            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                                <span class="c1"># now safe to give it up</span>
                                <span class="c1"># raise e</span>
                                <span class="k">raise</span> <span class="n">JSONPointerError</span><span class="p">(</span><span class="nb">repr</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">V3K</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">_startnode</span><span class="p">,</span> <span class="n">JSONData</span><span class="p">):</span>
                    <span class="n">_startnode</span> <span class="o">=</span> <span class="n">_startnode</span><span class="o">.</span><span class="n">data</span>

                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">_startnode</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">dict</span><span class="p">:</span>
                    <span class="n">_jdat</span> <span class="o">=</span> <span class="n">_startnode</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
                <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">_startnode</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
                    <span class="n">_jdat</span> <span class="o">=</span> <span class="s1">&#39;[0...&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">_startnode</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">_jdat</span> <span class="o">=</span> <span class="n">_startnode</span>

                <span class="k">raise</span> <span class="n">JSONPointerError</span><span class="p">(</span>
                    <span class="s2">&quot;Requires existing Node(jsondata[&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;]):&quot;</span>
                    <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&quot;:&#39;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;:jsondata(keys/indexes)=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">_jdat</span><span class="p">)</span>
                    <span class="c1">#</span>
                    <span class="c1"># TODO: update doctool for python3 introspection before re-activation</span>
                    <span class="c1">#</span>
                    <span class="p">)</span> <span class="c1"># from None</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">JSONPointerError</span><span class="p">(</span>
                    <span class="s2">&quot;Requires existing Node(jsondata[&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;]):&quot;</span>
                    <span class="o">+</span> <span class="s1">&#39;&quot;&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;&quot;:&#39;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;:jsondata=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">_startnode</span><span class="p">)</span>
                    <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">node</span> <span class="o">=</span> <span class="n">_startnode</span>  <span class="c1"># cache for reuse</span>
        <span class="k">return</span> <span class="n">_startnode</span></div>

<div class="viewcode-block" id="JSONPointer.isfragment"><a class="viewcode-back" href="../../jsondata_jsonpointer_doc.html#jsondata.jsonpointer.JSONPointer.isfragment">[docs]</a>    <span class="k">def</span> <span class="nf">isfragment</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Checks whether a http fragment.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__isfragment</span></div>

<div class="viewcode-block" id="JSONPointer.isrelpathrequest"><a class="viewcode-back" href="../../jsondata_jsonpointer_doc.html#jsondata.jsonpointer.JSONPointer.isrelpathrequest">[docs]</a>    <span class="k">def</span> <span class="nf">isrelpathrequest</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Checks whether a path request.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__isrelpathrequest</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__isrel</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="JSONPointer.isrel"><a class="viewcode-back" href="../../jsondata_jsonpointer_doc.html#jsondata.jsonpointer.JSONPointer.isrel">[docs]</a>    <span class="k">def</span> <span class="nf">isrel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Checks whether a relative pointer.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__isrel</span></div>

<div class="viewcode-block" id="JSONPointer.isvalid_nodetype"><a class="viewcode-back" href="../../jsondata_jsonpointer_doc.html#jsondata.jsonpointer.JSONPointer.isvalid_nodetype">[docs]</a>    <span class="k">def</span> <span class="nf">isvalid_nodetype</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Checks valid node types of in-memory JSON data.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">in</span>  <span class="n">VALID_NODE_TYPE_X</span> <span class="ow">or</span> <span class="n">x</span> <span class="o">==</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="JSONPointer.isvalrequest"><a class="viewcode-back" href="../../jsondata_jsonpointer_doc.html#jsondata.jsonpointer.JSONPointer.isvalrequest">[docs]</a>    <span class="k">def</span> <span class="nf">isvalrequest</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Checks whether a value request.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__isvalrequest</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__isrel</span></div>

<div class="viewcode-block" id="JSONPointer.iter_path"><a class="viewcode-back" href="../../jsondata_jsonpointer_doc.html#jsondata.jsonpointer.JSONPointer.iter_path">[docs]</a>    <span class="k">def</span> <span class="nf">iter_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jsondata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Iterator for the elements of the path pointer itself.</span>

<span class="sd">        Args:</span>
<span class="sd">            **jsondata**:</span>
<span class="sd">                If provided a valid JSON data node, the</span>
<span class="sd">                path components are successively verified on</span>
<span class="sd">                the provided document.</span>

<span class="sd">            kargs:</span>
<span class="sd">                **parent**:</span>
<span class="sd">                    Uses the path pointer to parent node.</span>

<span class="sd">                **rev**:</span>
<span class="sd">                    Reverse the order, start with last.</span>

<span class="sd">                **superpose**:</span>
<span class="sd">                    Is only relevant for relative paths, for *rfc6901* defined</span>
<span class="sd">                    paths the parameter is ignored. When *True* superposes</span>
<span class="sd">                    the offset *startrel* with the pointer into the resulting</span>
<span class="sd">                    final pointer. By default nodes are not verified,</span>
<span class="sd">                    see *verify* parameter. ::</span>

<span class="sd">                       superpose := (</span>
<span class="sd">                            True   # iterates resulting paths from *startrel*</span>
<span class="sd">                          | False  # iterates the path only</span>
<span class="sd">                       )</span>


<span class="sd">                    default := True</span>

<span class="sd">        Returns:</span>
<span class="sd">            Yields the iterator for the current path pointer</span>
<span class="sd">            components.</span>

<span class="sd">        Raises:</span>
<span class="sd">            JSONPointerError:</span>
<span class="sd">            forwarded from json</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">parent</span><span class="o">=</span><span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;parent&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">rev</span><span class="o">=</span><span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;rev&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">superpose</span><span class="o">=</span><span class="n">kargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;superpose&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

        <span class="n">_ptr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_pointer</span><span class="p">(</span><span class="n">jsondata</span><span class="p">,</span> <span class="n">superpose</span><span class="o">=</span><span class="n">superpose</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span> <span class="o">==</span> <span class="p">[]:</span>  <span class="c1"># special RFC6901, whole document</span>
            <span class="k">yield</span> <span class="s1">&#39;&#39;</span>
        <span class="k">elif</span> <span class="bp">self</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]:</span>  <span class="c1"># special RFC6901, &#39;/&#39; empty top-tag</span>
            <span class="k">yield</span> <span class="s1">&#39;/&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">rev</span><span class="p">:</span>  <span class="c1"># reverse</span>
                <span class="k">if</span> <span class="n">parent</span><span class="p">:</span>  <span class="c1"># for parent</span>
                    <span class="n">ptrpath</span> <span class="o">=</span> <span class="n">_ptr</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>  <span class="c1"># full path</span>
                    <span class="n">ptrpath</span> <span class="o">=</span> <span class="n">_ptr</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">parent</span><span class="p">:</span>  <span class="c1"># for parent</span>
                    <span class="n">ptrpath</span> <span class="o">=</span> <span class="n">_ptr</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>  <span class="c1"># full path</span>
                    <span class="n">ptrpath</span> <span class="o">=</span> <span class="n">_ptr</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">ptrpath</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ptrpath</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">jsondata</span><span class="p">:</span>
                        <span class="c1"># want the exception, the keys within the process has to match</span>
                        <span class="n">jsondata</span> <span class="o">=</span> <span class="n">jsondata</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
                    <span class="k">yield</span> <span class="n">x</span>

            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">V3K</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">JSONPointerError</span><span class="p">(</span>
                        <span class="s2">&quot;Node(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ptrpath</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="o">+</span><span class="s2">&quot;):&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; of &quot;</span> <span class="o">+</span>
                        <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                        <span class="c1">#</span>
                        <span class="c1"># TODO: update doctool for python3 introspection</span>
                        <span class="c1">#</span>
                        <span class="p">)</span> <span class="c1"># from None</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">JSONPointerError</span><span class="p">(</span>
                        <span class="s2">&quot;Node(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ptrpath</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="o">+</span><span class="s2">&quot;):&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; of &quot;</span> <span class="o">+</span>
                        <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                        <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">node</span> <span class="o">=</span> <span class="n">jsondata</span>  <span class="c1"># cache for reuse</span></div>

<div class="viewcode-block" id="JSONPointer.iter_path_nodes"><a class="viewcode-back" href="../../jsondata_jsonpointer_doc.html#jsondata.jsonpointer.JSONPointer.iter_path_nodes">[docs]</a>    <span class="k">def</span> <span class="nf">iter_path_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jsondata</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">rev</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Iterator for the elements the path pointer points to.</span>

<span class="sd">        Args:</span>
<span class="sd">            **jsondata**:</span>
<span class="sd">                A valid JSON data node.</span>

<span class="sd">            **parent**:</span>
<span class="sd">                Uses the path pointer to parent node.</span>

<span class="sd">            **rev**:</span>
<span class="sd">                Reverse the order, start with last.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Yields the iterator of the current node reference.</span>

<span class="sd">        Raises:</span>
<span class="sd">            JSONPointerError:</span>
<span class="sd">            forwarded from json</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span> <span class="o">==</span> <span class="p">[]:</span>  <span class="c1"># special RFC6901, whole document</span>
            <span class="k">yield</span> <span class="n">jsondata</span>
        <span class="k">elif</span> <span class="bp">self</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]:</span>  <span class="c1"># special RFC6901, &#39;/&#39; empty top-tag</span>
            <span class="k">yield</span> <span class="n">jsondata</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">rev</span><span class="p">:</span>  <span class="c1"># reverse</span>
                <span class="k">if</span> <span class="n">parent</span><span class="p">:</span>  <span class="c1"># for parent</span>
                    <span class="n">ptrpath</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>  <span class="c1"># full path</span>
                    <span class="n">ptrpath</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">parent</span><span class="p">:</span>  <span class="c1"># for parent</span>
                    <span class="n">ptrpath</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>  <span class="c1"># full path</span>
                    <span class="n">ptrpath</span> <span class="o">=</span> <span class="bp">self</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">ptrpath</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ptrpath</span><span class="p">:</span>
                    <span class="c1"># want the exception, the keys within the process has to match</span>
                    <span class="n">jsondata</span> <span class="o">=</span> <span class="n">jsondata</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
                    <span class="k">yield</span> <span class="n">jsondata</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">V3K</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">JSONPointerError</span><span class="p">(</span>
                        <span class="s2">&quot;Node(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ptrpath</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="o">+</span><span class="s2">&quot;):&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; of &quot;</span> <span class="o">+</span>
                        <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                        <span class="c1">#</span>
                        <span class="c1"># TODO: update doctool for python3 introspection</span>
                        <span class="c1">#</span>
                        <span class="p">)</span> <span class="c1"># from None</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">JSONPointerError</span><span class="p">(</span>
                        <span class="s2">&quot;Node(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ptrpath</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="o">+</span><span class="s2">&quot;):&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; of &quot;</span> <span class="o">+</span>
                        <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                        <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">node</span> <span class="o">=</span> <span class="n">jsondata</span>  <span class="c1"># cache for reuse</span></div>

<div class="viewcode-block" id="JSONPointer.iter_path_subpaths"><a class="viewcode-back" href="../../jsondata_jsonpointer_doc.html#jsondata.jsonpointer.JSONPointer.iter_path_subpaths">[docs]</a>    <span class="k">def</span> <span class="nf">iter_path_subpaths</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jsondata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">rev</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Successive iterator for the resulting sub-paths the</span>
<span class="sd">        path pointer itself.</span>

<span class="sd">        Args:</span>
<span class="sd">            **jsondata**:</span>
<span class="sd">                If provided a valid JSON data node, the</span>
<span class="sd">                path components are successively verified on</span>
<span class="sd">                the provided document.</span>

<span class="sd">            **parent**:</span>
<span class="sd">                Uses the path pointer to parent node.</span>

<span class="sd">            **rev**:</span>
<span class="sd">                Reverse the order, start with last.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Yields the iterator for the copy of the current</span>
<span class="sd">            slice of the path pointer.</span>

<span class="sd">        Raises:</span>
<span class="sd">            JSONPointerError:</span>
<span class="sd">            forwarded from json</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span> <span class="o">==</span> <span class="p">[]:</span>  <span class="c1"># special RFC6901, whole document</span>
            <span class="k">yield</span> <span class="s1">&#39;&#39;</span>
        <span class="k">elif</span> <span class="bp">self</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]:</span>  <span class="c1"># special RFC6901, &#39;/&#39; empty top-tag</span>
            <span class="k">yield</span> <span class="s1">&#39;/&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">curpath</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="n">rev</span><span class="p">:</span>  <span class="c1"># reverse</span>
                <span class="k">if</span> <span class="n">parent</span><span class="p">:</span>  <span class="c1"># for parent</span>
                    <span class="n">ptrpath</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>  <span class="c1"># full path</span>
                    <span class="n">ptrpath</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">parent</span><span class="p">:</span>  <span class="c1"># for parent</span>
                    <span class="n">ptrpath</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>  <span class="c1"># full path</span>
                    <span class="n">ptrpath</span> <span class="o">=</span> <span class="bp">self</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">ptrpath</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ptrpath</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">jsondata</span><span class="p">:</span>
                        <span class="c1"># want the exception, the keys within the process has to match</span>
                        <span class="n">jsondata</span> <span class="o">=</span> <span class="n">jsondata</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
                    <span class="n">curpath</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                    <span class="k">yield</span> <span class="n">curpath</span><span class="p">[:]</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">V3K</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">JSONPointerError</span><span class="p">(</span>
                        <span class="s2">&quot;Node(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ptrpath</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="o">+</span><span class="s2">&quot;):&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; of &quot;</span> <span class="o">+</span>
                        <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                        <span class="c1">#</span>
                        <span class="c1"># TODO: update doctool for python3 introspection</span>
                        <span class="c1">#</span>
                        <span class="p">)</span> <span class="c1"># from None</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">JSONPointerError</span><span class="p">(</span>
                        <span class="s2">&quot;Node(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ptrpath</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="o">+</span><span class="s2">&quot;):&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; of &quot;</span> <span class="o">+</span>
                        <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                        <span class="p">)</span></div>

<div class="viewcode-block" id="JSONPointer.iter_path_subpathdata"><a class="viewcode-back" href="../../jsondata_jsonpointer_doc.html#jsondata.jsonpointer.JSONPointer.iter_path_subpathdata">[docs]</a>    <span class="k">def</span> <span class="nf">iter_path_subpathdata</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">jsondata</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">parent</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">rev</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Successive iterator for the resulting sub-paths and the</span>
<span class="sd">        corresponding nodes.</span>

<span class="sd">        Args:</span>
<span class="sd">            **jsondata**:</span>
<span class="sd">                If provided a valid JSON data node, the</span>
<span class="sd">                path components are successively verified on</span>
<span class="sd">                the provided document.</span>

<span class="sd">            **parent**:</span>
<span class="sd">                Uses the path pointer to parent node.</span>

<span class="sd">            **rev**:</span>
<span class="sd">                Reverse the order, start with last.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Yields the iterator for the tuple of the current</span>
<span class="sd">            slice of the path pointer and the reference of the</span>
<span class="sd">            corresponding node. ::</span>

<span class="sd">               (&lt;path-item&gt;, &lt;sub-path&gt;, &lt;node&gt;)</span>

<span class="sd">               path-item: copy of the item</span>
<span class="sd">               sub-path:  copy of the current subpath</span>
<span class="sd">               node:      reference to the corresponding node</span>

<span class="sd">        Raises:</span>
<span class="sd">            JSONPointerError:</span>
<span class="sd">            forwarded from json</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span> <span class="o">==</span> <span class="p">[]:</span>  <span class="c1"># special RFC6901, whole document</span>
            <span class="k">yield</span> <span class="s1">&#39;&#39;</span>
        <span class="k">elif</span> <span class="bp">self</span> <span class="o">==</span> <span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">]:</span>  <span class="c1"># special RFC6901, &#39;/&#39; empty top-tag</span>
            <span class="k">yield</span> <span class="s1">&#39;/&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">curpath</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="n">rev</span><span class="p">:</span>  <span class="c1"># reverse</span>
                <span class="k">if</span> <span class="n">parent</span><span class="p">:</span>  <span class="c1"># for parent</span>
                    <span class="n">ptrpath</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>  <span class="c1"># full path</span>
                    <span class="n">ptrpath</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">parent</span><span class="p">:</span>  <span class="c1"># for parent</span>
                    <span class="n">ptrpath</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>  <span class="c1"># full path</span>
                    <span class="n">ptrpath</span> <span class="o">=</span> <span class="bp">self</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">ptrpath</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">ptrpath</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">jsondata</span><span class="p">:</span>
                        <span class="c1"># want the exception, the keys within the process has to match</span>
                        <span class="n">jsondata</span> <span class="o">=</span> <span class="n">jsondata</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
                    <span class="n">curpath</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                    <span class="k">yield</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">curpath</span><span class="p">[:],</span> <span class="n">jsondata</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">V3K</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">JSONPointerError</span><span class="p">(</span>
                        <span class="s2">&quot;Node(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ptrpath</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="o">+</span><span class="s2">&quot;):&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; of &quot;</span> <span class="o">+</span>
                        <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                        <span class="c1">#</span>
                        <span class="c1"># TODO: update doctool for python3 introspection</span>
                        <span class="c1">#</span>
                        <span class="p">)</span> <span class="c1"># from None</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">JSONPointerError</span><span class="p">(</span>
                        <span class="s2">&quot;Node(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ptrpath</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="o">+</span><span class="s2">&quot;):&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; of &quot;</span> <span class="o">+</span>
                        <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span> <span class="o">+</span> <span class="nb">repr</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
                        <span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">node</span> <span class="o">=</span> <span class="n">jsondata</span>  <span class="c1"># cache for reuse</span></div></div>

<span class="kn">from</span> <span class="nn">jsondata.jsondata</span> <span class="k">import</span> <span class="n">JSONData</span>
<span class="n">VALID_NODE_TYPE_X</span> <span class="o">=</span> <span class="p">(</span>
    <span class="nb">dict</span><span class="p">,</span>
    <span class="nb">list</span><span class="p">,</span>
    <span class="nb">str</span><span class="p">,</span>
    <span class="n">unicode</span><span class="p">,</span>
    <span class="nb">int</span><span class="p">,</span>
    <span class="nb">float</span><span class="p">,</span>
    <span class="nb">bool</span><span class="p">,</span>
    <span class="kc">None</span><span class="p">,</span>
    <span class="n">JSONData</span><span class="p">,)</span>
<span class="sd">&quot;&quot;&quot;Valid types of in-memory JSON node types for processing.&quot;&quot;&quot;</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/jsondata-64x64.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">jsondata 0.2.22 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &raquo;</li>
          <li class="nav-item nav-item-2"><a href="../jsondata.html" >jsondata</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2018, Arno-Can Uestuensoez.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.5.
    </div>
  </body>
</html>